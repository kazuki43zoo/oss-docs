<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Appendix&nbsp;I.&nbsp;Change History</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Integration Reference Manual"><link rel="up" href="spring-integration-appendices.html" title="Part&nbsp;VI.&nbsp;Appendices"><link rel="prev" href="resources.html" title="Appendix&nbsp;H.&nbsp;Additional Resources"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Appendix&nbsp;I.&nbsp;Change History</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="resources.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;VI.&nbsp;Appendices</th><td width="20%" align="right">&nbsp;</td></tr></table><hr></div><div class="appendix"><div class="titlepage"><div><div><h2 class="title"><a name="history" href="#history"></a>Appendix&nbsp;I.&nbsp;Change History</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="migration-4.3-5.0" href="#migration-4.3-5.0"></a>I.1&nbsp;Changes between 4.3 and 5.0</h2></div></div></div>

<p>See the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki/Spring-Integration-4.3-to-5.0-Migration-Guide" target="_top">Migration Guide</a> for important changes that might affect your applications.
You can find migration guides for all versions back to 2.1 on the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki" target="_top">wiki</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="x5.0-new-components" href="#x5.0-new-components"></a>I.2&nbsp;New Components</h2></div></div></div>

<p>Version 5.0 added a number of new components.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_java_dsl" href="#_java_dsl"></a>I.2.1&nbsp;Java DSL</h3></div></div></div>

<p>The separate <a class="ulink" href="https://github.com/spring-projects/spring-integration-java-dsl" target="_top">Spring Integration Java DSL</a> project has now been merged into the core Spring Integration project.
The <code class="literal">IntegrationComponentSpec</code> implementations for channel adapters and gateways are distributed to their specific modules.
See <a class="xref" href="java-dsl.html" title="11.&nbsp;Java DSL">Chapter&nbsp;11, <i>Java DSL</i></a> for more information about Java DSL support.
See also the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki/Spring-Integration-4.3-to-5.0-Migration-Guide#java-dsl" target="_top">4.3 to 5.0 Migration Guide</a> for the required steps to move to Spring Integration 5.0.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_testing_support" href="#_testing_support"></a>I.2.2&nbsp;Testing Support</h3></div></div></div>

<p>We created a new Spring Integration Test Framework to help with testing Spring Integration applications.
Now, with the <code class="literal">@SpringIntegrationTest</code> annotation on test classes and the <code class="literal">MockIntegration</code> factory, you can make your JUnit tests for integration flows somewhat easier.</p>
<p>See <a class="xref" href="testing.html" title="Appendix&nbsp;F.&nbsp;Testing support">Appendix&nbsp;F, <i>Testing support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_mongodb_outbound_gateway" href="#_mongodb_outbound_gateway"></a>I.2.3&nbsp;MongoDB Outbound Gateway</h3></div></div></div>

<p>The new <code class="literal">MongoDbOutboundGateway</code> lets you make queries to the database on demand by sending a message to its request channel.</p>
<p>See <a class="xref" href="mongodb.html#mongodb-outbound-gateway" title="25.5&nbsp;MongoDB Outbound Gateway">Section&nbsp;25.5, &#8220;MongoDB Outbound Gateway&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_webflux_gateways_and_channel_adapters" href="#_webflux_gateways_and_channel_adapters"></a>I.2.4&nbsp;WebFlux Gateways and Channel Adapters</h3></div></div></div>

<p>We introduced the new WebFlux support module for Spring WebFlux Framework gateways and channel adapters.</p>
<p>See <a class="xref" href="webflux.html" title="35.&nbsp;WebFlux Support">Chapter&nbsp;35, <i>WebFlux Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_content_type_conversion" href="#_content_type_conversion"></a>I.2.5&nbsp;Content Type Conversion</h3></div></div></div>

<p>Now that we use the new <code class="literal">InvocableHandlerMethod</code>-based infrastructure for service method invocations, we can perform <code class="literal">contentType</code> conversion from the payload to a target method argument.</p>
<p>See <a class="xref" href="messaging-endpoints-chapter.html#content-type-conversion" title="10.1.7&nbsp;Content Type Conversion">Section&nbsp;10.1.7, &#8220;Content Type Conversion&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_literal_errormessagepublisher_literal_and_literal_errormessagestrategy_literal" href="#_literal_errormessagepublisher_literal_and_literal_errormessagestrategy_literal"></a>I.2.6&nbsp;<code class="literal">ErrorMessagePublisher</code> and <code class="literal">ErrorMessageStrategy</code></h3></div></div></div>

<p>We added <code class="literal">ErrorMessagePublisher</code> and the <code class="literal">ErrorMessageStrategy</code> for creating <code class="literal">ErrorMessage</code> instances.</p>
<p>See <a class="xref" href="configuration.html#namespace-errorhandler" title="E.3&nbsp;Error Handling">Section&nbsp;E.3, &#8220;Error Handling&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_jdbc_metadata_store" href="#_jdbc_metadata_store"></a>I.2.7&nbsp;JDBC Metadata Store</h3></div></div></div>

<p>We added a JDBC implementation of the <code class="literal">MetadataStore</code> implementation.
This is useful when you need to ensure transactional boundaries for metadata.</p>
<p>See <a class="xref" href="jdbc.html#jdbc-metadata-store" title="21.7&nbsp;JDBC Metadata Store">Section&nbsp;21.7, &#8220;JDBC Metadata Store&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="x5.0-general" href="#x5.0-general"></a>I.3&nbsp;General Changes</h2></div></div></div>

<p>Spring Integration is now fully based on Spring Framework <code class="literal">5.0</code> and Project Reactor <code class="literal">3.1</code>.
Previous Project Reactor versions are no longer supported.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_core_changes" href="#_core_changes"></a>I.3.1&nbsp;Core Changes</h3></div></div></div>

<p>The <code class="literal">@Poller</code> annotation now has the <code class="literal">errorChannel</code> attribute for easier configuration of the underlying <code class="literal">MessagePublishingErrorHandler</code>.
See <a class="xref" href="configuration.html#annotations" title="E.5&nbsp;Annotation Support">Section&nbsp;E.5, &#8220;Annotation Support&#8221;</a> for more information.</p>
<p>All the request-reply endpoints (based on <code class="literal">AbstractReplyProducingMessageHandler</code>) can now start transactions and, therefore, make the whole downstream flow transactional.
See <a class="xref" href="messaging-endpoints-chapter.html#tx-handle-message-advice" title="10.9.5&nbsp;Transaction Support">Section&nbsp;10.9.5, &#8220;Transaction Support&#8221;</a> for more information.</p>
<p>The <code class="literal">SmartLifecycleRoleController</code> now provides methods to obtain status of endpoints in roles.
See <a class="xref" href="messaging-endpoints-chapter.html#endpoint-roles" title="10.2&nbsp;Endpoint Roles">Section&nbsp;10.2, &#8220;Endpoint Roles&#8221;</a> for more information.</p>
<p>By default, POJO methods are now invoked by using an <code class="literal">InvocableHandlerMethod</code>, but you can configure them to use SpEL, as before.
See <a class="xref" href="overview.html#pojo-invocation" title="5.8&nbsp;POJO Method invocation">Section&nbsp;5.8, &#8220;POJO Method invocation&#8221;</a> for more information.</p>
<p>When targeting POJO methods as message handlers, you can now mark one of the service methods with the <code class="literal">@Default</code> annotation to provide a fallback mechanism for non-matched conditions.
See <a class="xref" href="messaging-endpoints-chapter.html#service-activator-namespace" title="10.5.1&nbsp;Configuring Service Activator">Section&nbsp;10.5.1, &#8220;Configuring Service Activator&#8221;</a> for more information.</p>
<p>We added a simple <code class="literal">PassThroughTransactionSynchronizationFactory</code> to always store a polled message in the current transaction context.
That message is used as a <code class="literal">failedMessage</code> property of the <code class="literal">MessagingException</code>, which wraps any raw exception thrown during transaction completion.
See <a class="xref" href="transactions.html#transaction-synchronization" title="C.3&nbsp;Transaction Synchronization">Section&nbsp;C.3, &#8220;Transaction Synchronization&#8221;</a> for more information.</p>
<p>The aggregator expression-based <code class="literal">ReleaseStrategy</code> now evaluates the expression against the <code class="literal">MessageGroup</code> instead of just the collection of <code class="literal">Message&lt;?&gt;</code>.
See <a class="xref" href="messaging-routing-chapter.html#aggregator-spel" title="Aggregators and Spring Expression Language (SpEL)">the section called &#8220;Aggregators and Spring Expression Language (SpEL)&#8221;</a> for more information.</p>
<p>You can now supply the <code class="literal">ObjectToMapTransformer</code> with a customized <code class="literal">JsonObjectMapper</code>.</p>
<p>See <a class="xref" href="messaging-routing-chapter.html#aggregator-spel" title="Aggregators and Spring Expression Language (SpEL)">the section called &#8220;Aggregators and Spring Expression Language (SpEL)&#8221;</a> for more information.</p>
<p>The <code class="literal">@GlobalChannelInterceptor</code> annotation and <code class="literal">&lt;int:channel-interceptor&gt;</code> now support negative patterns (via <code class="literal">!</code> prepending) for component names matching.
See <a class="xref" href="messaging-channels-section.html#global-channel-configuration-interceptors" title="Global Channel Interceptor Configuration">the section called &#8220;Global Channel Interceptor Configuration&#8221;</a> for more information.</p>
<p>When a candidate failed to acquire the lock, the <code class="literal">LockRegistryLeaderInitiator</code> now emits a new <code class="literal">OnFailedToAcquireMutexEvent</code> through <code class="literal">DefaultLeaderEventPublisher</code>.
See <code class="literal">&lt;&lt;leadership-event-handling&gt;&gt;</code> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_gateway_changes" href="#_gateway_changes"></a>I.3.2&nbsp;Gateway Changes</h3></div></div></div>

<p>When the gateway method has a <code class="literal">void</code> return type and an error channel is provided, the gateway now correctly sets the <code class="literal">errorChannel</code> header.
Previously, the header was not populated.
This caused synchronous downstream flows (running on the calling thread) to send the exception to the configured channel, but an exception on an asynchronous downstream flow would be sent to the default <code class="literal">errorChannel</code> instead.</p>
<p>The <code class="literal">RequestReplyExchanger</code> interface now has a <code class="literal">throws MessagingException</code> clause to meet the proposed messages exchange contract.</p>
<p>You can now specify the request and reply timeouts with SpEL expressions.
See <a class="xref" href="messaging-endpoints-chapter.html#gateway" title="10.4&nbsp;Messaging Gateways">Section&nbsp;10.4, &#8220;Messaging Gateways&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_aggregator_performance_changes" href="#_aggregator_performance_changes"></a>I.3.3&nbsp;Aggregator Performance Changes</h3></div></div></div>

<p>By default, aggregators now use a <code class="literal">SimpleSequenceSizeReleaseStrategy</code>, which is more efficient, especially with large groups.
Empty groups are now scheduled for removal after <code class="literal">empty-group-min-timeout</code>.
See <a class="xref" href="messaging-routing-chapter.html#aggregator" title="8.4&nbsp;Aggregator">Section&nbsp;8.4, &#8220;Aggregator&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_splitter_changes" href="#_splitter_changes"></a>I.3.4&nbsp;Splitter Changes</h3></div></div></div>

<p>The splitter component can now handle and split Java <code class="literal">Stream</code> and Reactive Streams <code class="literal">Publisher</code> objects.
If the output channel is a <code class="literal">ReactiveStreamsSubscribableChannel</code>, the <code class="literal">AbstractMessageSplitter</code> builds a <code class="literal">Flux</code> for subsequent iteration instead of a regular <code class="literal">Iterator</code>, independent of the object being split.
In addition, <code class="literal">AbstractMessageSplitter</code> provides <code class="literal">protected obtainSizeIfPossible()</code> methods to allow determination of the size of the <code class="literal">Iterable</code> and <code class="literal">Iterator</code> objects, if that is possible.
See <a class="xref" href="messaging-routing-chapter.html#splitter" title="8.3&nbsp;Splitter">Section&nbsp;8.3, &#8220;Splitter&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_jms_changes" href="#_jms_changes"></a>I.3.5&nbsp;JMS Changes</h3></div></div></div>

<p>Previously, Spring Integration JMS XML configuration used a default bean name of <code class="literal">connectionFactory</code> for the JMS connection factory, letting the property be omitted from component definitions.
We renamed it to <code class="literal">jmsConnectionFactory</code>, which is the bean name used by Spring Boot to auto-configure the JMS connection factory bean.</p>
<p>If your application relies on the previous behavior, you can rename your <code class="literal">connectionFactory</code> bean to <code class="literal">jmsConnectionFactory</code> or specifically configure your components to use your bean by using its current name.
See <a class="xref" href="jms.html" title="23.&nbsp;JMS Support">Chapter&nbsp;23, <i>JMS Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_mail_changes" href="#_mail_changes"></a>I.3.6&nbsp;Mail Changes</h3></div></div></div>

<p>Some inconsistencies with rendering IMAP mail content have been resolved.
See <a class="link" href="mail.html#imap-format-important" title="Important">the note in the "<code class="literal">Mail-receiving Channel Adapter</code>" section</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_feed_changes" href="#_feed_changes"></a>I.3.7&nbsp;Feed Changes</h3></div></div></div>

<p>Instead of the <code class="literal">com.rometools.fetcher.FeedFetcher</code>, which is deprecated in ROME, we introduced a new <code class="literal">Resource</code> property for the <code class="literal">FeedEntryMessageSource</code>.
See <a class="xref" href="feed.html" title="16.&nbsp;Feed Adapter">Chapter&nbsp;16, <i>Feed Adapter</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_file_changes" href="#_file_changes"></a>I.3.8&nbsp;File Changes</h3></div></div></div>

<p>We introduced the new <code class="literal">FileHeaders.RELATIVE_PATH</code> message header to represent relative path in <code class="literal">FileReadingMessageSource</code>.</p>
<p>The tail adapter now supports <code class="literal">idleEventInterval</code> to emit events when there is no data in the file during that period.</p>
<p>The flush predicates for the <code class="literal">FileWritingMessageHandler</code> now have an additional parameter.</p>
<p>The file outbound channel adapter and gateway (<code class="literal">FileWritingMessageHandler</code>) now support the <code class="literal">REPLACE_IF_MODIFIED</code> <code class="literal">FileExistsMode</code>.</p>
<p>They also now support setting file permissions on the newly written file.</p>
<p>A new <code class="literal">FileSystemMarkerFilePresentFileListFilter</code> is now available.
See <a class="xref" href="files.html#file-incomplete" title="17.1.9&nbsp;Dealing With Incomplete Data">Section&nbsp;17.1.9, &#8220;Dealing With Incomplete Data&#8221;</a> for more information.</p>
<p>The <code class="literal">FileSplitter</code> now provides a <code class="literal">firstLineAsHeader</code> option to carry the first line of content as a header in the messages emitted for the remaining lines.</p>
<p>See <a class="xref" href="files.html" title="17.&nbsp;File Support">Chapter&nbsp;17, <i>File Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_ftp_and_sftp_changes" href="#_ftp_and_sftp_changes"></a>I.3.9&nbsp;FTP and SFTP Changes</h3></div></div></div>

<p>The inbound channel adapters now have a property called <code class="literal">max-fetch-size</code>, which is used to limit the number of files fetched during a poll when no files are currently in the local directory.
By default, they also are configured with a <code class="literal">FileSystemPersistentAcceptOnceFileListFilter</code> in the <code class="literal">local-filter</code>.</p>
<p>You can also provide a custom <code class="literal">DirectoryScanner</code> implementation to inbound channel adapters by setting the newly introduced <code class="literal">scanner</code> attribute.</p>
<p>You can now configure the regex and pattern filters to always pass directories.
This can be useful when you use recursion in the outbound gateways.</p>
<p>By default, all the inbound channel adapters (streaming and synchronization-based) now use an appropriate <code class="literal">AbstractPersistentAcceptOnceFileListFilter</code> implementation to prevent duplicate downloads of remote files.</p>
<p>The FTP and SFTP outbound gateways now support the <code class="literal">REPLACE_IF_MODIFIED</code> <code class="literal">FileExistsMode</code> when fetching remote files.</p>
<p>The FTP and SFTP streaming inbound channel adapters now add remote file information in a message header.</p>
<p>The FTP and SFTP outbound channel adapters (as well as the <code class="literal">PUT</code> command for outbound gateways) now support <code class="literal">InputStream</code> as <code class="literal">payload</code>, too.</p>
<p>The inbound channel adapters can now build file trees locally by using a newly introduced <code class="literal">RecursiveDirectoryScanner</code>.
See the <code class="literal">scanner</code> option in the <a class="xref" href="ftp.html#ftp-inbound" title="18.4&nbsp;FTP Inbound Channel Adapter">Section&nbsp;18.4, &#8220;FTP Inbound Channel Adapter&#8221;</a> section for injection.
Also, you can now switch these adapters to the <code class="literal">WatchService</code> instead.</p>
<p>We added The <code class="literal">NLST</code> command to the <code class="literal">AbstractRemoteFileOutboundGateway</code> to perform the list files names remote command.</p>
<p>You can now supply the <code class="literal">FtpOutboundGateway</code> with <code class="literal">workingDirExpression</code> to change the FTP client working directory for the current request message.</p>
<p>The <code class="literal">RemoteFileTemplate</code> is supplied now with the <code class="literal">invoke(OperationsCallback&lt;F, T&gt; action)</code> to perform several <code class="literal">RemoteFileOperations</code> calls in the scope of the same, thread-bounded, <code class="literal">Session</code>.</p>
<p>We added new filters for detecting incomplete remote files.</p>
<p>The <code class="literal">FtpOutboundGateway</code> and <code class="literal">SftpOutboundGateway</code> now support an option to remove the remote file after a successful transfer by using the <code class="literal">GET</code> or <code class="literal">MGET</code> commands.</p>
<p>See <a class="xref" href="ftp.html" title="18.&nbsp;FTP/FTPS Adapters">Chapter&nbsp;18, <i>FTP/FTPS Adapters</i></a> and <a class="xref" href="sftp.html" title="30.&nbsp;SFTP Adapters">Chapter&nbsp;30, <i>SFTP Adapters</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_integration_properties" href="#_integration_properties"></a>I.3.10&nbsp;Integration Properties</h3></div></div></div>

<p>Version 4.3.2 added a new <code class="literal">spring.integration.readOnly.headers</code> global property to let you customize the list of headers that should not be copied to a newly created <code class="literal">Message</code> by the <code class="literal">MessageBuilder</code>.
See <a class="xref" href="configuration.html#global-properties" title="E.4&nbsp;Global Properties">Section&nbsp;E.4, &#8220;Global Properties&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_stream_changes" href="#_stream_changes"></a>I.3.11&nbsp;Stream Changes</h3></div></div></div>

<p>We added a new option on the <code class="literal">CharacterStreamReadingMessageSource</code> to let it be used to "<code class="literal">pipe</code>" stdin and publish an application event when the pipe is closed.
See <a class="xref" href="stream.html#stream-reading" title="32.1&nbsp;Reading from Streams">Section&nbsp;32.1, &#8220;Reading from Streams&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_barrier_changes" href="#_barrier_changes"></a>I.3.12&nbsp;Barrier Changes</h3></div></div></div>

<p>The <code class="literal">BarrierMessageHandler</code> now supports a discard channel to which late-arriving trigger messages are sent.
See <a class="xref" href="messaging-routing-chapter.html#barrier" title="8.8&nbsp;Thread Barrier">Section&nbsp;8.8, &#8220;Thread Barrier&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_amqp_changes" href="#_amqp_changes"></a>I.3.13&nbsp;AMQP Changes</h3></div></div></div>

<p>The AMQP outbound endpoints now support setting a delay expression when you use the RabbitMQ Delayed Message Exchange plugin.</p>
<p>The inbound endpoints now support the Spring AMQP <code class="literal">DirectMessageListenerContainer</code>.</p>
<p>Pollable AMQP-backed channels now block the poller thread for the poller&#8217;s configured <code class="literal">receiveTimeout</code> (default: one second).</p>
<p>Headers, such as <code class="literal">contentType</code>, that are added to message properties by the message converter are now used in the final message.
Previously, it depended on the converter type as to which headers and message properties appeared in the final message.
To override the headers set by the converter, set the <code class="literal">headersMappedLast</code> property to <code class="literal">true</code>.
See <a class="xref" href="amqp.html" title="14.&nbsp;AMQP Support">Chapter&nbsp;14, <i>AMQP Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_http_changes" href="#_http_changes"></a>I.3.14&nbsp;HTTP Changes</h3></div></div></div>

<p>By default, the <code class="literal">DefaultHttpHeaderMapper.userDefinedHeaderPrefix</code> property is now an empty string instead of <code class="literal">X-</code>.
See <a class="xref" href="http.html#http-header-mapping" title="20.7&nbsp;HTTP Header Mappings">Section&nbsp;20.7, &#8220;HTTP Header Mappings&#8221;</a> for more information.</p>
<p>By default, <code class="literal">uriVariablesExpression</code> now uses a <code class="literal">SimpleEvaluationContext</code> (since 5.0.4).</p>
<p>See <a class="xref" href="http.html#mapping-uri-variables" title="20.3.7&nbsp;Mapping URI Variables">Section&nbsp;20.3.7, &#8220;Mapping URI Variables&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_mqtt_changes" href="#_mqtt_changes"></a>I.3.15&nbsp;MQTT Changes</h3></div></div></div>

<p>Inbound messages are now mapped with the <code class="literal">RECEIVED_TOPIC</code>, <code class="literal">RECEIVED_QOS</code>, and <code class="literal">RECEIVED_RETAINED</code> headers to avoid inadvertent propagation to outbound messages when an application relays messages.</p>
<p>The outbound channel adapter now supports expressions for the topic, qos, and retained properties.
The defaults remain the same.
See <a class="xref" href="mqtt.html" title="26.&nbsp;MQTT Support">Chapter&nbsp;26, <i>MQTT Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_stomp_changes" href="#_stomp_changes"></a>I.3.16&nbsp;STOMP Changes</h3></div></div></div>

<p>We changed the STOMP module to use <code class="literal">ReactorNettyTcpStompClient</code>, based on the Project Reactor <code class="literal">3.1</code> and <code class="literal">reactor-netty</code> extension.
We renamed <code class="literal">Reactor2TcpStompSessionManager</code> to <code class="literal">ReactorNettyTcpStompSessionManager</code>, according to the <code class="literal">ReactorNettyTcpStompClient</code> foundation.
See <a class="xref" href="stomp.html" title="31.&nbsp;STOMP Support">Chapter&nbsp;31, <i>STOMP Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_web_services_changes" href="#_web_services_changes"></a>I.3.17&nbsp;Web Services Changes</h3></div></div></div>

<p>You can now supply <code class="literal">WebServiceOutboundGateway</code> instances with an externally configured <code class="literal">WebServiceTemplate</code> instances.</p>
<p><code class="literal">DefaultSoapHeaderMapper</code> can now map a <code class="literal">javax.xml.transform.Source</code> user-defined header to a SOAP header element.</p>
<p>Simple WebService inbound and outbound gateways can now deal with the complete <code class="literal">WebServiceMessage</code> as a <code class="literal">payload</code>, allowing the manipulation of MTOM attachments.</p>
<p>See <a class="xref" href="ws.html" title="37.&nbsp;Web Services Support">Chapter&nbsp;37, <i>Web Services Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_redis_changes" href="#_redis_changes"></a>I.3.18&nbsp;Redis Changes</h3></div></div></div>

<p>The <code class="literal">RedisStoreWritingMessageHandler</code> is supplied now with additional <code class="literal">String</code>-based setters for SpEL expressions (for convenience with Java configuration).
You can now configure the <code class="literal">zsetIncrementExpression</code> on the <code class="literal">RedisStoreWritingMessageHandler</code> as well.
In addition, this property has been changed from <code class="literal">true</code> to <code class="literal">false</code> since the <code class="literal">INCR</code> option on <code class="literal">ZADD</code> Redis command is optional.</p>
<p>You can now supply the <code class="literal">RedisInboundChannelAdapter</code> with an <code class="literal">Executor</code> for executing Redis listener invokers.
In addition, the received messages now contain a <code class="literal">RedisHeaders.MESSAGE_SOURCE</code> header to indicate the source of the message (topic or pattern).</p>
<p>See <a class="xref" href="redis.html" title="27.&nbsp;Redis Support">Chapter&nbsp;27, <i>Redis Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_tcp_changes" href="#_tcp_changes"></a>I.3.19&nbsp;TCP Changes</h3></div></div></div>

<p>We added a new <code class="literal">ThreadAffinityClientConnectionFactory</code> to bind TCP connections to threads.</p>
<p>You can now configure the TCP connection factories to support <code class="literal">PushbackInputStream</code> instances, letting deserializers "<code class="literal">unread</code>" (push back) bytes after "<code class="literal">reading ahead</code>".</p>
<p>We added a <code class="literal">ByteArrayElasticRawDeserializer</code> without <code class="literal">maxMessageSize</code> to control and buffer incoming data as needed.</p>
<p>See <a class="xref" href="ip.html" title="34.&nbsp;TCP and UDP Support">Chapter&nbsp;34, <i>TCP and UDP Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_gemfire_changes" href="#_gemfire_changes"></a>I.3.20&nbsp;Gemfire Changes</h3></div></div></div>

<p>The <code class="literal">GemfireMetadataStore</code> now implements <code class="literal">ListenableMetadataStore</code>, letting you listen to cache events by providing <code class="literal">MetadataStoreListener</code> instances to the store.
See <a class="xref" href="gemfire.html" title="19.&nbsp;Pivotal GemFire and Apache Geode Support">Chapter&nbsp;19, <i>Pivotal GemFire and Apache Geode Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_jdbc_changes" href="#_jdbc_changes"></a>I.3.21&nbsp;JDBC Changes</h3></div></div></div>

<p>The <code class="literal">JdbcMessageChannelStore</code> now provides a setter for <code class="literal">ChannelMessageStorePreparedStatementSetter</code>, letting you customize message insertion in the store.</p>
<p>The <code class="literal">ExpressionEvaluatingSqlParameterSourceFactory</code> now provides a setter for <code class="literal">sqlParameterTypes</code>, letting you customize the SQL types of the parameters.</p>
<p>See <a class="xref" href="jdbc.html" title="21.&nbsp;JDBC Support">Chapter&nbsp;21, <i>JDBC Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_metrics_changes" href="#_metrics_changes"></a>I.3.22&nbsp;Metrics Changes</h3></div></div></div>

<p><a class="ulink" href="http://micrometer.io/" target="_top">Micrometer</a> application monitoring is now supported (since version 5.0.2).
See <a class="xref" href="system-management-chapter.html#micrometer-integration" title="12.1.2&nbsp;Micrometer Integration">Section&nbsp;12.1.2, &#8220;Micrometer Integration&#8221;</a> for more information.</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top">
<p>Changes were made to the Micrometer <code class="literal">Meters</code> in version 5.0.3 to make them more suitable for use in dimensional systems.
Further changes were made in 5.0.4.
If you usie Micrometer, we recommend a minimum of version 5.0.4.</p>
</td></tr></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_literal_endpointid_literal_annotations" href="#_literal_endpointid_literal_annotations"></a>I.3.23&nbsp;<code class="literal">@EndpointId</code> Annotations</h3></div></div></div>

<p>Introduced in version 5.0.4, this annotation provides control over bean naming when you use Java configuration.
See <a class="xref" href="overview.html#endpoint-bean-names" title="5.4.8&nbsp;Endpoint Bean Names">Section&nbsp;5.4.8, &#8220;Endpoint Bean Names&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="migration-4.2-4.3" href="#migration-4.2-4.3"></a>I.4&nbsp;Changes between 4.2 and 4.3</h2></div></div></div>

<p>See the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki/Spring-Integration-4.2-to-4.3-Migration-Guide" target="_top">Migration Guide</a>
for important changes that might affect your applications.
You can find migration guides for all versions back to 2.1 on the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki" target="_top">Wiki</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="x4.3-new-components" href="#x4.3-new-components"></a>I.5&nbsp;New Components</h2></div></div></div>

<p>Version 4.3 added a number of new components.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_amqp_async_outbound_gateway" href="#_amqp_async_outbound_gateway"></a>I.5.1&nbsp;AMQP Async Outbound Gateway</h3></div></div></div>

<p>See <a class="xref" href="amqp.html#amqp-async-outbound-gateway" title="14.7&nbsp;Asynchronous Outbound Gateway">Section&nbsp;14.7, &#8220;Asynchronous Outbound Gateway&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_literal_messagegroupfactory_literal" href="#_literal_messagegroupfactory_literal"></a>I.5.2&nbsp;<code class="literal">MessageGroupFactory</code></h3></div></div></div>

<p>We introduced the <code class="literal">MessageGroupFactory</code> strategy to allow control over <code class="literal">MessageGroup</code> instances in <code class="literal">MessageGroupStore</code> logic.
We added <code class="literal">SimpleMessageGroupFactory</code> implementation for the <code class="literal">SimpleMessageGroup</code>, with the <code class="literal">GroupType.HASH_SET</code> as the default
factory for the standard <code class="literal">MessageGroupStore</code> implementations.
See <a class="xref" href="system-management-chapter.html#message-store" title="12.4&nbsp;Message Store">Section&nbsp;12.4, &#8220;Message Store&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_literal_persistentmessagegroup_literal" href="#_literal_persistentmessagegroup_literal"></a>I.5.3&nbsp;<code class="literal">PersistentMessageGroup</code></h3></div></div></div>

<p>We added the <code class="literal">PersistentMessageGroup</code> (lazy-load proxy) implementation for persistent <code class="literal">MessageGroupStore</code> instances,
which return this instance for the <code class="literal">getMessageGroup()</code> when their <code class="literal">lazyLoadMessageGroups</code> is <code class="literal">true</code> (the default).
See <a class="xref" href="system-management-chapter.html#message-store" title="12.4&nbsp;Message Store">Section&nbsp;12.4, &#8220;Message Store&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_ftp_and_sftp_streaming_inbound_channel_adapters" href="#_ftp_and_sftp_streaming_inbound_channel_adapters"></a>I.5.4&nbsp;FTP and SFTP Streaming Inbound Channel Adapters</h3></div></div></div>

<p>We added inbound channel adapters that return an <code class="literal">InputStream</code> for each file, letting you retrieve remote files without writing them to the local file system.
See <a class="xref" href="ftp.html#ftp-streaming" title="18.5&nbsp;FTP Streaming Inbound Channel Adapter">Section&nbsp;18.5, &#8220;FTP Streaming Inbound Channel Adapter&#8221;</a> and <a class="xref" href="sftp.html#sftp-streaming" title="30.7&nbsp;SFTP Streaming Inbound Channel Adapter">Section&nbsp;30.7, &#8220;SFTP Streaming Inbound Channel Adapter&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_literal_streamtransformer_literal" href="#_literal_streamtransformer_literal"></a>I.5.5&nbsp;<code class="literal">StreamTransformer</code></h3></div></div></div>

<p>We added <code class="literal">StreamTransformer</code> to transform an <code class="literal">InputStream</code> payload to either a <code class="literal">byte[]</code> or a <code class="literal">String</code>.
See <a class="xref" href="messaging-transformation-chapter.html#stream-transformer" title="Stream Transformer">the section called &#8220;Stream Transformer&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_integration_graph" href="#_integration_graph"></a>I.5.6&nbsp;Integration Graph</h3></div></div></div>

<p>We added <code class="literal">IntegrationGraphServer</code>, together with the <code class="literal">IntegrationGraphController</code> REST service, to expose the runtime model of a Spring Integration application as a graph.
See <a class="xref" href="system-management-chapter.html#integration-graph" title="12.8&nbsp;Integration Graph">Section&nbsp;12.8, &#8220;Integration Graph&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_jdbc_lock_registry" href="#_jdbc_lock_registry"></a>I.5.7&nbsp;JDBC Lock Registry</h3></div></div></div>

<p>We added <code class="literal">JdbcLockRegistry</code> for distributed locks shared through a database table.
See <a class="xref" href="jdbc.html#jdbc-lock-registry" title="21.6&nbsp;JDBC Lock Registry">Section&nbsp;21.6, &#8220;JDBC Lock Registry&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_literal_leaderinitiator_literal_for_literal_lockregistry_literal" href="#_literal_leaderinitiator_literal_for_literal_lockregistry_literal"></a>I.5.8&nbsp;<code class="literal">LeaderInitiator</code> for <code class="literal">LockRegistry</code></h3></div></div></div>

<p>We added <code class="literal">LeaderInitiator</code> implementation based on the <code class="literal">LockRegistry</code> strategy.
See <a class="xref" href="messaging-endpoints-chapter.html#leadership-event-handling" title="10.3&nbsp;Leadership Event Handling">Section&nbsp;10.3, &#8220;Leadership Event Handling&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="x4.3-general" href="#x4.3-general"></a>I.6&nbsp;General Changes</h2></div></div></div>

<p>This section describes general changes that version 4.3 brought to Spring Integration.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_core_changes_2" href="#_core_changes_2"></a>I.6.1&nbsp;Core Changes</h3></div></div></div>

<p>This section describes general changes to the core of Spring Integration.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_outbound_gateway_within_a_chain" href="#_outbound_gateway_within_a_chain"></a>Outbound Gateway within a Chain</h4></div></div></div>

<p>Previously, you could specify a <code class="literal">reply-channel</code> on an outbound gateway within a chain.
It was completely ignored.
The gateway&#8217;s reply goes to the next chain element or, if the gateway is the last element, to the chain&#8217;s output channel.
This condition is now detected and disallowed.
If you have such a configuration, remove the <code class="literal">reply-channel</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_asynchronous_service_activator" href="#_asynchronous_service_activator"></a>Asynchronous Service Activator</h4></div></div></div>

<p>We added an option to make the service activator be synchronous.
See <a class="xref" href="messaging-endpoints-chapter.html#async-service-activator" title="10.5.2&nbsp;Asynchronous Service Activator">Section&nbsp;10.5.2, &#8220;Asynchronous Service Activator&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_messaging_annotation_support_changes" href="#_messaging_annotation_support_changes"></a>Messaging Annotation Support changes</h4></div></div></div>

<p>The messaging annotation support does not require a <code class="literal">@MessageEndpoint</code> (or any other <code class="literal">@Component</code>) annotation declaration on the class level.
To restore the previous behavior, set the <code class="literal">spring.integration.messagingAnnotations.require.componentAnnotation</code> of
<code class="literal">spring.integration.properties</code> to <code class="literal">true</code>.
See <a class="xref" href="configuration.html#global-properties" title="E.4&nbsp;Global Properties">Section&nbsp;E.4, &#8220;Global Properties&#8221;</a> and <a class="xref" href="configuration.html#annotations" title="E.5&nbsp;Annotation Support">Section&nbsp;E.5, &#8220;Annotation Support&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_mail_changes_2" href="#_mail_changes_2"></a>I.6.2&nbsp;Mail Changes</h3></div></div></div>

<p>This section describes general changes to the Spring Integration Mail functionality.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_customizable_user_flag" href="#_customizable_user_flag"></a>Customizable User Flag</h4></div></div></div>

<p>The customizable <code class="literal">userFlag</code> (added in 4.2.2 to provide customization of the flag used to denote that the mail has been
seen) is now available in the XML namespace.
See <a class="xref" href="mail.html#imap-seen" title="24.5&nbsp;Marking IMAP Messages When \Recent Is Not Supported">Section&nbsp;24.5, &#8220;Marking IMAP Messages When <code class="literal">\Recent</code> Is Not Supported&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_mail_message_mapping" href="#_mail_message_mapping"></a>Mail Message Mapping</h4></div></div></div>

<p>You can now map inbound mail messages with the <code class="literal">MessageHeaders</code> containing the mail headers and the payload containing the email content.
Previously, the payload was always the raw <code class="literal">MimeMessage</code>.
See <a class="xref" href="mail.html#mail-mapping" title="24.3&nbsp;Inbound Mail Message Mapping">Section&nbsp;24.3, &#8220;Inbound Mail Message Mapping&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_jms_changes_2" href="#_jms_changes_2"></a>I.6.3&nbsp;JMS Changes</h3></div></div></div>

<p>This section describes general changes to the Spring Integration JMS functionality.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_header_mapper" href="#_header_mapper"></a>Header Mapper</h4></div></div></div>

<p>The <code class="literal">DefaultJmsHeaderMapper</code> now maps the standard <code class="literal">correlationId</code> header as a message property by invoking its <code class="literal">toString()</code> method.
See <a class="xref" href="jms.html#jms-header-mapping" title="23.6&nbsp;Mapping Message Headers to and from JMS Message">Section&nbsp;23.6, &#8220;Mapping Message Headers to and from JMS Message&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_asynchronous_gateway" href="#_asynchronous_gateway"></a>Asynchronous Gateway</h4></div></div></div>

<p>The JMS outbound gateway now has an <code class="literal">async</code> property.
See <a class="xref" href="jms.html#jms-async-gateway" title="23.5.4&nbsp;Async Gateway">Section&nbsp;23.5.4, &#8220;Async Gateway&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_aggregator_changes" href="#_aggregator_changes"></a>I.6.4&nbsp;Aggregator Changes</h3></div></div></div>

<p>There is a change in behavior when a POJO aggregator releases a collection of <code class="literal">Message&lt;?&gt;</code> objects.
This is rare, but, if your application does that, you need to make a small change to your POJO.
See this <a class="xref" href="messaging-routing-chapter.html#agg-message-collection" title="Important">Important</a> note for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_tcp_udp_changes" href="#_tcp_udp_changes"></a>I.6.5&nbsp;TCP/UDP Changes</h3></div></div></div>

<p>This section describes general changes to the Spring Integration TCP/UDP functionality.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_events" href="#_events"></a>Events</h4></div></div></div>

<p>A new <code class="literal">TcpConnectionServerListeningEvent</code> is emitted when a server connection factory is started.
See <a class="xref" href="ip.html#tcp-events" title="34.5&nbsp;TCP Connection Events">Section&nbsp;34.5, &#8220;TCP Connection Events&#8221;</a> for more information.</p>
<p>You can now use the <code class="literal">destination-expression</code> and <code class="literal">socket-expression</code> attributes on <code class="literal">&lt;int-ip:udp-outbound-channel-adapter&gt;</code>.
See <a class="xref" href="ip.html#udp-adapters" title="34.2&nbsp;UDP Adapters">Section&nbsp;34.2, &#8220;UDP Adapters&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_stream_deserializers" href="#_stream_deserializers"></a>Stream Deserializers</h4></div></div></div>

<p>The various deserializers that cannot allocate the final buffer until the whole message has been assembled now support pooling the raw buffer into which the data is received rather than creating and discarding a buffer for each message.
See <a class="xref" href="ip.html#tcp-connection-factories" title="34.3&nbsp;TCP Connection Factories">Section&nbsp;34.3, &#8220;TCP Connection Factories&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_tcp_message_mapper" href="#_tcp_message_mapper"></a>TCP Message Mapper</h4></div></div></div>

<p>The message mapper now, optionally, sets a configured content type header.
See <a class="xref" href="ip.html#ip-msg-headers" title="34.13&nbsp;IP Message Headers">Section&nbsp;34.13, &#8220;IP Message Headers&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_file_changes_2" href="#_file_changes_2"></a>I.6.6&nbsp;File Changes</h3></div></div></div>

<p>This section describes general changes to the Spring Integration File functionality.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_destination_directory_creation" href="#_destination_directory_creation"></a>Destination Directory Creation</h4></div></div></div>

<p>The generated file name for the <code class="literal">FileWritingMessageHandler</code> can represent a sub-path to save the desired directory structure for a file in the target directory.
See <a class="xref" href="files.html#file-writing-file-names" title="17.2.1&nbsp;Generating File Names">Section&nbsp;17.2.1, &#8220;Generating File Names&#8221;</a> for more information.</p>
<p>The <code class="literal">FileReadingMessageSource</code> now hides the <code class="literal">WatchService</code> directory scanning logic in the inner class.
We added the <code class="literal">use-watch-service</code> and <code class="literal">watch-events</code> options to enable this behavior.
We deprecated the top-level <code class="literal">WatchServiceDirectoryScanner</code> because of inconsistency around the API.
See <a class="xref" href="files.html#watch-service-directory-scanner" title="17.1.4&nbsp;WatchServiceDirectoryScanner">Section&nbsp;17.1.4, &#8220;<code class="literal">WatchServiceDirectoryScanner</code>&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_buffer_size" href="#_buffer_size"></a>Buffer Size</h4></div></div></div>

<p>When writing files, you can now specify the buffer size.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_appending_and_flushing" href="#_appending_and_flushing"></a>Appending and Flushing</h4></div></div></div>

<p>You can now avoid flushing files when appending and use a number of strategies to flush the data during idle periods.
See <a class="xref" href="files.html#file-flushing" title="17.2.4&nbsp;Flushing Files When Using APPEND_NO_FLUSH">Section&nbsp;17.2.4, &#8220;Flushing Files When Using <code class="literal">APPEND_NO_FLUSH</code>&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_preserving_timestamps" href="#_preserving_timestamps"></a>Preserving Timestamps</h4></div></div></div>

<p>You can now configure the outbound channel adapter to set the destination file&#8217;s <code class="literal">lastmodified</code> timestamp.
See <a class="xref" href="files.html#file-timestamps" title="17.2.5&nbsp;File Timestamps">Section&nbsp;17.2.5, &#8220;File Timestamps&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_splitter_changes_2" href="#_splitter_changes_2"></a>Splitter Changes</h4></div></div></div>

<p>The <code class="literal">FileSplitter</code> now automatically closes an FTP or SFTP session when the file is completely read.
This applies when the outbound gateway returns an <code class="literal">InputStream</code> or when you use the new FTP or SFTP streaming channel adapters.
We also introduced a new <code class="literal">markers-json</code> option to convert <code class="literal">FileSplitter.FileMarker</code> to JSON <code class="literal">String</code> for relaxed downstream network interaction.
See <a class="xref" href="files.html#file-splitter" title="17.4&nbsp;File Splitter">Section&nbsp;17.4, &#8220;File Splitter&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_file_filters" href="#_file_filters"></a>File Filters</h4></div></div></div>

<p>We added <code class="literal">ChainFileListFilter</code> as an alternative to <code class="literal">CompositeFileListFilter</code>.
See <a class="xref" href="files.html#file-reading" title="17.1&nbsp;Reading Files">Section&nbsp;17.1, &#8220;Reading Files&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_amqp_changes_2" href="#_amqp_changes_2"></a>I.6.7&nbsp;AMQP Changes</h3></div></div></div>

<p>This section describes general changes to the Spring Integration AMQP functionality.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_content_type_message_converter" href="#_content_type_message_converter"></a>Content Type Message Converter</h4></div></div></div>

<p>The outbound endpoints now support a <code class="literal">RabbitTemplate</code> configured with a <code class="literal">ContentTypeDelegatingMessageConverter</code> such
that you can choose the converter based on the message content type.
See <a class="xref" href="amqp.html#content-type-conversion-outbound" title="14.8&nbsp;Outbound Message Conversion">Section&nbsp;14.8, &#8220;Outbound Message Conversion&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_headers_for_delayed_message_handling" href="#_headers_for_delayed_message_handling"></a>Headers for Delayed Message Handling</h4></div></div></div>

<p>Spring AMQP 1.6 adds support for <a class="ulink" href="https://www.rabbitmq.com/blog/2015/04/16/scheduling-messages-with-rabbitmq/" target="_top">delayed message exchanges</a>.
Header mapping now supports the headers (<code class="literal">amqp_delay</code> and <code class="literal">amqp_receivedDelay</code>) used by this feature.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_amqp_backed_channels" href="#_amqp_backed_channels"></a>AMQP-Backed Channels</h4></div></div></div>

<p>AMQP-backed channels now support message mapping.
See <a class="xref" href="amqp.html#amqp-channels" title="14.11&nbsp;AMQP-backed Message Channels">Section&nbsp;14.11, &#8220;AMQP-backed Message Channels&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_redis_changes_2" href="#_redis_changes_2"></a>I.6.8&nbsp;Redis Changes</h3></div></div></div>

<p>This section describes general changes to the Spring Integration Redis functionality.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_list_push_pop_direction" href="#_list_push_pop_direction"></a>List Push/Pop Direction</h4></div></div></div>

<p>Previously, the queue channel adapters always used the Redis list in a fixed direction, pushing to the left end and reading from the right end.
You can now configure the reading and writing direction with the <code class="literal">rightPop</code> and <code class="literal">leftPush</code> options for the
<code class="literal">RedisQueueMessageDrivenEndpoint</code> and <code class="literal">RedisQueueOutboundChannelAdapter</code>, respectively.
See <a class="xref" href="redis.html#redis-queue-inbound-channel-adapter" title="27.2.4&nbsp;Redis Queue Inbound Channel Adapter">Section&nbsp;27.2.4, &#8220;Redis Queue Inbound Channel Adapter&#8221;</a> and <a class="xref" href="redis.html#redis-queue-outbound-channel-adapter" title="27.2.5&nbsp;Redis Queue Outbound Channel Adapter">Section&nbsp;27.2.5, &#8220;Redis Queue Outbound Channel Adapter&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_queue_inbound_gateway_default_serializer" href="#_queue_inbound_gateway_default_serializer"></a>Queue Inbound Gateway Default Serializer</h4></div></div></div>

<p>The default serializer in the inbound gateway has been changed to a <code class="literal">JdkSerializationRedisSerializer</code> for compatibility with the outbound gateway.
See <a class="xref" href="redis.html#redis-queue-inbound-gateway" title="27.9&nbsp;Redis Queue Inbound Gateway">Section&nbsp;27.9, &#8220;Redis Queue Inbound Gateway&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_http_changes_2" href="#_http_changes_2"></a>I.6.9&nbsp;HTTP Changes</h3></div></div></div>

<p>Previously, with requests that had a body (such as <code class="literal">POST</code>) that had no <code class="literal">content-type</code> header, the body was ignored.
With this release, the content type of such requests is considered to be <code class="literal">application/octet-stream</code> as recommended
by RFC 2616.
See <a class="xref" href="http.html#http-inbound" title="20.1&nbsp;Http Inbound Components">Section&nbsp;20.1, &#8220;Http Inbound Components&#8221;</a> for more information.</p>
<p><code class="literal">uriVariablesExpression</code> now uses a <code class="literal">SimpleEvaluationContext</code> by default (since 4.3.15).
See <a class="xref" href="http.html#mapping-uri-variables" title="20.3.7&nbsp;Mapping URI Variables">Section&nbsp;20.3.7, &#8220;Mapping URI Variables&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_sftp_changes" href="#_sftp_changes"></a>I.6.10&nbsp;SFTP Changes</h3></div></div></div>

<p>This section describes general changes to the Spring Integration SFTP functionality.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_factory_bean" href="#_factory_bean"></a>Factory Bean</h4></div></div></div>

<p>We added a new factory bean to simplify the configuration of Jsch proxies for SFTP.
See <a class="xref" href="sftp.html#sftp-proxy-factory-bean" title="30.2&nbsp;Proxy Factory Bean">Section&nbsp;30.2, &#8220;Proxy Factory Bean&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_literal_chmod_literal_changes" href="#_literal_chmod_literal_changes"></a><code class="literal">chmod</code> Changes</h4></div></div></div>

<p>The SFTP outbound gateway (for <code class="literal">put</code> and <code class="literal">mput</code> commands) and the SFTP outbound channel adapter now support the <code class="literal">chmod</code> attribute to change the remote file permissions after uploading.
See <code class="literal">&lt;&lt;sftp-outbound&gt;&gt;</code> and <code class="literal">&lt;&lt;sftp-outbound-gateway&gt;&gt;</code> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_ftp_changes" href="#_ftp_changes"></a>I.6.11&nbsp;FTP Changes</h3></div></div></div>

<p>This section describes general changes to the Spring Integration FTP functionality.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_session_changes" href="#_session_changes"></a>Session Changes</h4></div></div></div>

<p>The <code class="literal">FtpSession</code> now supports <code class="literal">null</code> for the <code class="literal">list()</code> and <code class="literal">listNames()</code> methods, since underlying FTP Client can use it.
With that, you can now configure the <code class="literal">FtpOutboundGateway</code> without the <code class="literal">remoteDirectory</code> expression.
You can also configure the <code class="literal">&lt;int-ftp:inbound-channel-adapter&gt;</code> without <code class="literal">remote-directory</code> or <code class="literal">remote-directory-expression</code>.
See <a class="xref" href="ftp.html" title="18.&nbsp;FTP/FTPS Adapters">Chapter&nbsp;18, <i>FTP/FTPS Adapters</i></a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_router_changes" href="#_router_changes"></a>I.6.12&nbsp;Router Changes</h3></div></div></div>

<p>The <code class="literal">ErrorMessageExceptionTypeRouter</code> now supports the <code class="literal">Exception</code> superclass mappings to avoid duplication for the same channel in case of multiple inheritors.
For this purpose, the <code class="literal">ErrorMessageExceptionTypeRouter</code> loads mapping classes during initialization to fail-fast for a <code class="literal">ClassNotFoundException</code>.</p>
<p>See <a class="xref" href="messaging-routing-chapter.html#router" title="8.1&nbsp;Routers">Section&nbsp;8.1, &#8220;Routers&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_header_mapping" href="#_header_mapping"></a>I.6.13&nbsp;Header Mapping</h3></div></div></div>

<p>This section describes the changes to header mapping between version 4.2 and 4.3.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_general" href="#_general"></a>General</h4></div></div></div>

<p>AMQP, WS, and XMPP header mappings (such as <code class="literal">request-header-mapping</code> and <code class="literal">reply-header-mapping</code>) now support negated patterns.
See <a class="xref" href="amqp.html#amqp-message-headers" title="14.12&nbsp;AMQP Message Headers">Section&nbsp;14.12, &#8220;AMQP Message Headers&#8221;</a>, <a class="xref" href="ws.html#ws-message-headers" title="37.5&nbsp;WS Message Headers">Section&nbsp;37.5, &#8220;WS Message Headers&#8221;</a>, and <a class="xref" href="xmpp.html#xmpp-message-headers" title="39.5&nbsp;XMPP Message Headers">Section&nbsp;39.5, &#8220;XMPP Message Headers&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_amqp_header_mapping" href="#_amqp_header_mapping"></a>AMQP Header Mapping</h4></div></div></div>

<p>Previously, only standard AMQP headers were mapped by default.
You had to explicitly enable mapping of user-defined headers.
With this release, all headers are mapped by default.
In addition, the inbound <code class="literal">amqp_deliveryMode</code> header is no longer mapped by default.
See <a class="xref" href="amqp.html#amqp-message-headers" title="14.12&nbsp;AMQP Message Headers">Section&nbsp;14.12, &#8220;AMQP Message Headers&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_groovy_scripts" href="#_groovy_scripts"></a>I.6.14&nbsp;Groovy Scripts</h3></div></div></div>

<p>You can now configure groovy scripts with the <code class="literal">compile-static</code> hint or any other <code class="literal">CompilerConfiguration</code> options.
See <a class="xref" href="messaging-endpoints-chapter.html#groovy-config" title="10.8.1&nbsp;Groovy Configuration">Section&nbsp;10.8.1, &#8220;Groovy Configuration&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_literal_inboundchanneladapter_literal_changes" href="#_literal_inboundchanneladapter_literal_changes"></a>I.6.15&nbsp;<code class="literal">@InboundChannelAdapter</code> Changes</h3></div></div></div>

<p>The <code class="literal">@InboundChannelAdapter</code> now has an alias <code class="literal">channel</code> attribute for the regular <code class="literal">value</code>.
In addition, the target <code class="literal">SourcePollingChannelAdapter</code> components can now resolve the target <code class="literal">outputChannel</code> bean from its provided name (<code class="literal">outputChannelName</code> options) in a late-binding manner.
See <a class="xref" href="configuration.html#annotations" title="E.5&nbsp;Annotation Support">Section&nbsp;E.5, &#8220;Annotation Support&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_xmpp_changes" href="#_xmpp_changes"></a>I.6.16&nbsp;XMPP Changes</h3></div></div></div>

<p>The XMPP channel adapters now support the XMPP Extensions (XEP).
See <a class="xref" href="xmpp.html#xmpp-extensions" title="39.6&nbsp;XMPP Extensions">Section&nbsp;39.6, &#8220;XMPP Extensions&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_wiretap_late_binding" href="#_wiretap_late_binding"></a>I.6.17&nbsp;WireTap Late Binding</h3></div></div></div>

<p>The <code class="literal">WireTap</code> <code class="literal">ChannelInterceptor</code> now can accept a <code class="literal">channelName</code> that is resolved to the target <code class="literal">MessageChannel</code>
later, during the first active interceptor operation.
See <a class="xref" href="messaging-channels-section.html#channel-wiretap" title="Wire Tap">the section called &#8220;Wire Tap&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_literal_channelmessagestorequeryprovider_literal_changes" href="#_literal_channelmessagestorequeryprovider_literal_changes"></a>I.6.18&nbsp;<code class="literal">ChannelMessageStoreQueryProvider</code> Changes</h3></div></div></div>

<p>The <code class="literal">ChannelMessageStoreQueryProvider</code> now supports H2 databases.
See <a class="xref" href="jdbc.html#jdbc-message-store-channels" title="21.4.3&nbsp;Backing Message Channels">Section&nbsp;21.4.3, &#8220;Backing Message Channels&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_websocket_changes" href="#_websocket_changes"></a>I.6.19&nbsp;WebSocket Changes</h3></div></div></div>

<p>The <code class="literal">ServerWebSocketContainer</code> now exposes an <code class="literal">allowedOrigins</code> option, and <code class="literal">SockJsServiceOptions</code> exposes a <code class="literal">suppressCors</code> option.
See <a class="xref" href="web-sockets.html" title="36.&nbsp;WebSockets Support">Chapter&nbsp;36, <i>WebSockets Support</i></a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="migration-4.1-4.2" href="#migration-4.1-4.2"></a>I.7&nbsp;Changes between 4.1 and 4.2</h2></div></div></div>

<p>See the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki/Spring-Integration-4.1-to-4.2-Migration-Guide" target="_top">Migration Guide</a> for important changes that might affect your applications.
You can find migration guides for all versions back to 2.1 on the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki" target="_top">wiki</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="x4.2-new-components" href="#x4.2-new-components"></a>I.8&nbsp;New Components</h2></div></div></div>

<p>Version 4.2 added a number of new components.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-JMX" href="#x4.2-JMX"></a>I.8.1&nbsp;Major Management/JMX Rework</h3></div></div></div>

<p>We added a new <code class="literal">MetricsFactory</code> strategy interface.
This change, together with other changes in the JMX and management infrastructure, provides much more control over management configuration and runtime performance.</p>
<p>However, this has some important implications for (some) user environments.</p>
<p>For complete details, see <a class="xref" href="system-management-chapter.html#metrics-management" title="12.1&nbsp;Metrics and Management">Section&nbsp;12.1, &#8220;Metrics and Management&#8221;</a> and <a class="xref" href="system-management-chapter.html#jmx-42-improvements" title="JMX Improvements">the section called &#8220;JMX Improvements&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-mongodb-metadata-store" href="#x4.2-mongodb-metadata-store"></a>I.8.2&nbsp;MongoDB Metadata Store</h3></div></div></div>

<p>The <code class="literal">MongoDbMetadataStore</code> is now available.
For more information, see <a class="xref" href="mongodb.html#mongodb-metadata-store" title="25.2.2&nbsp;MongoDB Metadata Store">Section&nbsp;25.2.2, &#8220;MongoDB Metadata Store&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-secured-channel-annotation" href="#x4.2-secured-channel-annotation"></a>I.8.3&nbsp;SecuredChannel Annotation</h3></div></div></div>

<p>We introduced the <code class="literal">@SecuredChannel</code> annotation, replacing the deprecated <code class="literal">ChannelSecurityInterceptorFactoryBean</code>.
For more information, see <a class="xref" href="security.html" title="Appendix&nbsp;D.&nbsp;Security in Spring Integration">Appendix&nbsp;D, <i>Security in Spring Integration</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-security-context-propagation" href="#x4.2-security-context-propagation"></a>I.8.4&nbsp;<code class="literal">SecurityContext</code> Propagation</h3></div></div></div>

<p>We introduced the <code class="literal">SecurityContextPropagationChannelInterceptor</code> for the <code class="literal">SecurityContext</code> propagation from one message flow&#8217;s thread to another.
For more information, see <a class="xref" href="security.html" title="Appendix&nbsp;D.&nbsp;Security in Spring Integration">Appendix&nbsp;D, <i>Security in Spring Integration</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-file-splitter" href="#x4.2-file-splitter"></a>I.8.5&nbsp;FileSplitter</h3></div></div></div>

<p>In 4.1.2, we added <code class="literal">FileSplitter</code>, which splits text files into lines.
It now has full support in the <code class="literal">int-file:</code> namespace.
See <a class="xref" href="files.html#file-splitter" title="17.4&nbsp;File Splitter">Section&nbsp;17.4, &#8220;File Splitter&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-zk" href="#x4.2-zk"></a>I.8.6&nbsp;Zookeeper Support</h3></div></div></div>

<p>We added Zookeeper support to the framework to assist when running on a clustered or multi-host environment.
The change impacts the following features:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">ZookeeperMetadataStore</code>
</li><li class="listitem">
<code class="literal">ZookeeperLockRegistry</code>
</li><li class="listitem">
Zookeeper Leadership
</li></ul></div>
<p>See <a class="xref" href="zookeeper.html" title="40.&nbsp;Zookeeper Support">Chapter&nbsp;40, <i>Zookeeper Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-barrier" href="#x4.2-barrier"></a>I.8.7&nbsp;Thread Barrier</h3></div></div></div>

<p>A new thread <code class="literal">&lt;int:barrier/&gt;</code> component is available, letting a thread be suspended until some asynchronous event occurs.
See <a class="xref" href="messaging-routing-chapter.html#barrier" title="8.8&nbsp;Thread Barrier">Section&nbsp;8.8, &#8220;Thread Barrier&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-stomp" href="#x4.2-stomp"></a>I.8.8&nbsp;STOMP Support</h3></div></div></div>

<p>We added STOMP support to the framework as an inbound and outbound channel adapters pair.
See <a class="xref" href="stomp.html" title="31.&nbsp;STOMP Support">Chapter&nbsp;31, <i>STOMP Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-codec" href="#x4.2-codec"></a>I.8.9&nbsp;Codec</h3></div></div></div>

<p>A new <code class="literal">Codec</code> abstraction has been introduced, to encode and decode objects to and from <code class="literal">byte[]</code>.
We added an implementation that uses Kryo.
We also added codec-based transformers and message converters.
See <a class="xref" href="messaging-transformation-chapter.html#codec" title="9.4&nbsp;Codec">Section&nbsp;9.4, &#8220;Codec&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-prepared-statement-setter" href="#x4.2-prepared-statement-setter"></a>I.8.10&nbsp;Message PreparedStatement Setter</h3></div></div></div>

<p>A new <code class="literal">MessagePreparedStatementSetter</code> functional interface callback is available for the <code class="literal">JdbcMessageHandler</code> (<code class="literal">&lt;int-jdbc:outbound-gateway&gt;</code> and <code class="literal">&lt;int-jdbc:outbound-channel-adapter&gt;</code>) as an alternative to using <code class="literal">SqlParameterSourceFactory</code> to populate parameters on the <code class="literal">PreparedStatement</code> with the <code class="literal">requestMessage</code> context.
See <a class="xref" href="jdbc.html#jdbc-outbound-channel-adapter" title="21.2&nbsp;Outbound Channel Adapter">Section&nbsp;21.2, &#8220;Outbound Channel Adapter&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="x4.2-general" href="#x4.2-general"></a>I.9&nbsp;General Changes</h2></div></div></div>

<p>This section describes general changes from version 4.1 to version 4.2.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-wire-tap" href="#x4.2-wire-tap"></a>I.9.1&nbsp;WireTap</h3></div></div></div>

<p>As an alternative to the existing <code class="literal">selector</code> attribute, the <code class="literal">&lt;wire-tap/&gt;</code> element now supports the <code class="literal">selector-expression</code> attribute.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-file-changes" href="#x4.2-file-changes"></a>I.9.2&nbsp;File Changes</h3></div></div></div>

<p>See <a class="xref" href="files.html" title="17.&nbsp;File Support">Chapter&nbsp;17, <i>File Support</i></a> for more information about these changes.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_appending_new_lines" href="#_appending_new_lines"></a>Appending New Lines</h4></div></div></div>

<p>The <code class="literal">&lt;int-file:outbound-channel-adapter&gt;</code> and <code class="literal">&lt;int-file:outbound-gateway&gt;</code> now support an <code class="literal">append-new-line</code> attribute.
If set to <code class="literal">true</code>, a new line is appended to the file after a message is written.
The default attribute value is <code class="literal">false</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_ignoring_hidden_files" href="#_ignoring_hidden_files"></a>Ignoring Hidden Files</h4></div></div></div>

<p>We added the <code class="literal">ignore-hidden</code> attribute for the <code class="literal">&lt;int-file:inbound-channel-adapter&gt;</code> to let you set whether to pick up hidden files from the source directory.
It defaults to <code class="literal">true</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_writing_literal_inputstream_literal_payloads" href="#_writing_literal_inputstream_literal_payloads"></a>Writing <code class="literal">InputStream</code> Payloads</h4></div></div></div>

<p>The <code class="literal">FileWritingMessageHandler</code> now also accepts <code class="literal">InputStream</code> as a valid message payload type.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_literal_headdirectoryscanner_literal" href="#_literal_headdirectoryscanner_literal"></a><code class="literal">HeadDirectoryScanner</code></h4></div></div></div>

<p>You can now use the <code class="literal">HeadDirectoryScanner</code> with other <code class="literal">FileListFilter</code> implementations.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_last_modified_filter" href="#_last_modified_filter"></a>Last Modified Filter</h4></div></div></div>

<p>We added the <code class="literal">LastModifiedFileListFilter</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_watch_service_directory_scanner" href="#_watch_service_directory_scanner"></a>Watch Service Directory Scanner</h4></div></div></div>

<p>We added the <code class="literal">WatchServiceDirectoryScanner</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_persistent_file_list_filter_changes" href="#_persistent_file_list_filter_changes"></a>Persistent File List Filter Changes</h4></div></div></div>

<p>The <code class="literal">AbstractPersistentFileListFilter</code> has a new property (<code class="literal">flushOnUpdate</code>) which, when set to <code class="literal">true</code>, calls <code class="literal">flush()</code> on the metadata store if it implements <code class="literal">Flushable</code> (for example, <code class="literal">PropertiesPersistingMetadataStore</code>).</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-class-package-change" href="#x4.2-class-package-change"></a>I.9.3&nbsp;Class Package Change</h3></div></div></div>

<p>We moved the <code class="literal">ScatterGatherHandler</code> class from the <code class="literal">org.springframework.integration.handler</code> to the <code class="literal">org.springframework.integration.scattergather</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_tcp_changes_2" href="#_tcp_changes_2"></a>I.9.4&nbsp;TCP Changes</h3></div></div></div>

<p>This section describes general changes to the Spring Integration TCP functionality.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.2-tcp-serializers" href="#x4.2-tcp-serializers"></a>TCP Serializers</h4></div></div></div>

<p>The TCP <code class="literal">Serializers</code> no longer <code class="literal">flush()</code> the <code class="literal">OutputStream</code>.
This is now done by the <code class="literal">TcpNxxConnection</code> classes.
If you use the serializers directly within your code, you may have to <code class="literal">flush()</code> the <code class="literal">OutputStream</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.2-tcp-server-exceptions" href="#x4.2-tcp-server-exceptions"></a>Server Socket Exceptions</h4></div></div></div>

<p><code class="literal">TcpConnectionServerExceptionEvent</code> instances are now published whenever an unexpected exception occurs on a TCP server socket (also added to 4.1.3 and 4.0.7).
See <a class="xref" href="ip.html#tcp-events" title="34.5&nbsp;TCP Connection Events">Section&nbsp;34.5, &#8220;TCP Connection Events&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.2-tcp-server-port" href="#x4.2-tcp-server-port"></a>TCP Server Port</h4></div></div></div>

<p>If you configure a TCP server socket factory to listen on a random port, you can now obtain the actual port chosen by the OS by using <code class="literal">getPort()</code>.
<code class="literal">getServerSocketAddress()</code> is also available.</p>
<p>See "<a class="xref" href="ip.html#tcp-connection-factories" title="34.3&nbsp;TCP Connection Factories">Section&nbsp;34.3, &#8220;TCP Connection Factories&#8221;</a>" for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.2-tcp-gw-rto" href="#x4.2-tcp-gw-rto"></a>TCP Gateway Remote Timeout</h4></div></div></div>

<p>The <code class="literal">TcpOutboundGateway</code> now supports <code class="literal">remote-timeout-expression</code> as an alternative to the existing <code class="literal">remote-timeout</code> attribute.
This allows setting the timeout based on each message.</p>
<p>Also, the <code class="literal">remote-timeout</code> no longer defaults to the same value as <code class="literal">reply-timeout</code>, which has a completely different meaning.</p>
<p>See <a class="xref" href="ip.html#tcp-ob-gateway-attributes" title="Table&nbsp;34.7.&nbsp;TCP Outbound Gateway Attributes">Table&nbsp;34.7, &#8220;TCP Outbound Gateway Attributes&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.2-tcp-ssl" href="#x4.2-tcp-ssl"></a>TCP SSLSession Available for Header Mapping</h4></div></div></div>

<p><code class="literal">TcpConnection</code> implementations now support <code class="literal">getSslSession()</code> to let you extract information from the session to add to message headers.
See <a class="xref" href="ip.html#ip-msg-headers" title="34.13&nbsp;IP Message Headers">Section&nbsp;34.13, &#8220;IP Message Headers&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.2-tcp-events" href="#x4.2-tcp-events"></a>TCP Events</h4></div></div></div>

<p>New events are now published whenever a correlation exception occurs&#8201;&#8212;&#8201;such as sending a message to a non-existent socket.</p>
<p>The <code class="literal">TcpConnectionEventListeningMessageProducer</code> is deprecated.
Use the generic event adapter instead.</p>
<p>See <a class="xref" href="ip.html#tcp-events" title="34.5&nbsp;TCP Connection Events">Section&nbsp;34.5, &#8220;TCP Connection Events&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-inbound-channel-adapter-annotation" href="#x4.2-inbound-channel-adapter-annotation"></a>I.9.5&nbsp;<code class="literal">@InboundChannelAdapter</code> Changes</h3></div></div></div>

<p>Previously, the <code class="literal">@Poller</code> on an inbound channel adapter defaulted the <code class="literal">maxMessagesPerPoll</code> attribute to <code class="literal">-1</code> (infinity).
This was inconsistent with the XML configuration of <code class="literal">&lt;inbound-channel-adapter/&gt;</code>, which defaults to <code class="literal">1</code>.
The annotation now defaults this attribute to <code class="literal">1</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-api-changes" href="#x4.2-api-changes"></a>I.9.6&nbsp;API Changes</h3></div></div></div>

<p><code class="literal">o.s.integration.util.FunctionIterator</code> now requires a <code class="literal">o.s.integration.util.Function</code> instead of a <code class="literal">reactor.function.Function</code>.
This was done to remove an unnecessary hard dependency on Reactor.
Any uses of this iterator need to change the import.</p>
<p>Reactor is still supported for functionality such as the <code class="literal">Promise</code> gateway.
The dependency was removed for those users who do not need it.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-jms-changes" href="#x4.2-jms-changes"></a>I.9.7&nbsp;JMS Changes</h3></div></div></div>

<p>This section describes general changes to the Spring Integration TCP functionality.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_reply_listener_lazy_initialization" href="#_reply_listener_lazy_initialization"></a>Reply Listener Lazy Initialization</h4></div></div></div>

<p>You can now configure the reply listener in JMS outbound gateways to be initialized on-demand and stopped after an idle period, instead of being controlled by the gateway&#8217;s lifecycle.
See <a class="xref" href="jms.html#jms-outbound-gateway" title="23.5&nbsp;Outbound Gateway">Section&nbsp;23.5, &#8220;Outbound Gateway&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_conversion_errors_in_message_driven_endpoints" href="#_conversion_errors_in_message_driven_endpoints"></a>Conversion Errors in Message-Driven Endpoints</h4></div></div></div>

<p>The <code class="literal">error-channel</code> is now used for the conversion errors. In previous versions, they caused transaction rollback and message redelivery.</p>
<p>See <a class="xref" href="jms.html#jms-message-driven-channel-adapter" title="23.2&nbsp;Message-driven Channel Adapter">Section&nbsp;23.2, &#8220;Message-driven Channel Adapter&#8221;</a> and <a class="xref" href="jms.html#jms-inbound-gateway" title="23.4&nbsp;Inbound Gateway">Section&nbsp;23.4, &#8220;Inbound Gateway&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_default_acknowledge_mode" href="#_default_acknowledge_mode"></a>Default Acknowledge Mode</h4></div></div></div>

<p>When using an implicitly defined <code class="literal">DefaultMessageListenerContainer</code>, the default <code class="literal">acknowledge</code> is now <code class="literal">transacted</code>.
We recommend using <code class="literal">transacted</code> when using this container, to avoid message loss.
This default now applies to the message-driven inbound adapter and the inbound gateway.
It was already the default for JMS-backed channels.</p>
<p>See <a class="xref" href="jms.html#jms-message-driven-channel-adapter" title="23.2&nbsp;Message-driven Channel Adapter">Section&nbsp;23.2, &#8220;Message-driven Channel Adapter&#8221;</a> and <a class="xref" href="jms.html#jms-inbound-gateway" title="23.4&nbsp;Inbound Gateway">Section&nbsp;23.4, &#8220;Inbound Gateway&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_shared_subscriptions" href="#_shared_subscriptions"></a>Shared Subscriptions</h4></div></div></div>

<p>We added Namespace support for shared subscriptions (JMS 2.0) to message-driven endpoints and the <code class="literal">&lt;int-jms:publish-subscribe-channel&gt;</code>.
Previously, you had to wire up listener containers as <code class="literal">&lt;bean/&gt;</code> declarations to use shared connections.</p>
<p>See <a class="xref" href="jms.html" title="23.&nbsp;JMS Support">Chapter&nbsp;23, <i>JMS Support</i></a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-conditional-pollers" href="#x4.2-conditional-pollers"></a>I.9.8&nbsp;Conditional Pollers</h3></div></div></div>

<p>We now provide much more flexibility for dynamic polling.</p>
<p>See <a class="xref" href="messaging-channels-section.html#conditional-pollers" title="6.2.4&nbsp;Conditional Pollers for Message Sources">Section&nbsp;6.2.4, &#8220;Conditional Pollers for Message Sources&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-amqp-changes" href="#x4.2-amqp-changes"></a>I.9.9&nbsp;AMQP Changes</h3></div></div></div>

<p>This section describes general changes to the Spring Integration AMQP functionality.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_publisher_confirmations" href="#_publisher_confirmations"></a>Publisher Confirmations</h4></div></div></div>

<p>The <code class="literal">&lt;int-amqp:outbound-gateway&gt;</code> now supports <code class="literal">confirm-correlation-expression</code>, <code class="literal">confirm-ack-channel</code>, and <code class="literal">confirm-nack-channel</code> attributes (which have a purpose similar to that of <code class="literal">&lt;int-amqp:outbound-channel-adapter&gt;</code>).</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_correlation_data" href="#_correlation_data"></a>Correlation Data</h4></div></div></div>

<p>For both the outbound channel adapter and the inbound gateway, if the correlation data is a <code class="literal">Message&lt;?&gt;</code>, it becomes the basis of the message on the ack or nack channel, with the additional header(s) added.
Previously, any correlation data (including <code class="literal">Message&lt;?&gt;</code>) was returned as the payload of the ack or nack message.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_inbound_gateway_properties" href="#_inbound_gateway_properties"></a>Inbound Gateway Properties</h4></div></div></div>

<p>The <code class="literal">&lt;int-amqp:inbound-gateway&gt;</code> now exposes the <code class="literal">amqp-template</code> attribute to allow more control over an external bean for the reply <code class="literal">RabbitTemplate</code>.
You can also provide your own <code class="literal">AmqpTemplate</code> implementation.
In addition, you can use <code class="literal">default-reply-to</code> if the request message does not have a <code class="literal">replyTo</code> property.</p>
<p>See <a class="xref" href="amqp.html" title="14.&nbsp;AMQP Support">Chapter&nbsp;14, <i>AMQP Support</i></a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-xpath-splitter" href="#x4.2-xpath-splitter"></a>I.9.10&nbsp;XPath Splitter Improvements</h3></div></div></div>

<p>The <code class="literal">XPathMessageSplitter</code> (<code class="literal">&lt;int-xml:xpath-splitter&gt;</code>) now allows the configuration of <code class="literal">output-properties</code> for the internal <code class="literal">javax.xml.transform.Transformer</code> and supports an <code class="literal">Iterator</code> mode (defaults to <code class="literal">true</code>) for the XPath evaluation <code class="literal">org.w3c.dom.NodeList</code> result.</p>
<p>See <a class="xref" href="xml.html#xml-xpath-splitting" title="38.4&nbsp;Splitting XML Messages">Section&nbsp;38.4, &#8220;Splitting XML Messages&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-http-changes" href="#x4.2-http-changes"></a>I.9.11&nbsp;HTTP Changes</h3></div></div></div>

<p>This section describes general changes to the Spring Integration HTTP functionality.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_cors" href="#_cors"></a>CORS</h4></div></div></div>

<p>The HTTP inbound endpoints (<code class="literal">&lt;int-http:inbound-channel-adapter&gt;</code> and <code class="literal">&lt;int-http:inbound-gateway&gt;</code>) now allow the
configuration of Cross-origin Resource Sharing (CORS).</p>
<p>See <a class="xref" href="http.html#http-cors" title="20.3.3&nbsp;Cross-origin Resource Sharing (CORS) Support">Section&nbsp;20.3.3, &#8220;Cross-origin Resource Sharing (CORS) Support&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_inbound_gateway_timeout" href="#_inbound_gateway_timeout"></a>Inbound Gateway Timeout</h4></div></div></div>

<p>You can configure the HTTP inbound gate way to return a status code that you specify when a request times out.
The default is now <code class="literal">500 Internal Server Error</code> instead of <code class="literal">200 OK</code>.</p>
<p>See <a class="xref" href="http.html#http-response-statuscode" title="20.3.4&nbsp;Response Status Code">Section&nbsp;20.3.4, &#8220;Response Status Code&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_form_data" href="#_form_data"></a>Form Data</h4></div></div></div>

<p>We added documentation for proxying <code class="literal">multipart/form-data</code> requests.
See <a class="xref" href="http.html" title="20.&nbsp;HTTP Support">Chapter&nbsp;20, <i>HTTP Support</i></a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-gw" href="#x4.2-gw"></a>I.9.12&nbsp;Gateway Changes</h3></div></div></div>

<p>This section describes general changes to the Spring Integration Gateway functionality.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_gateway_methods_can_return_literal_completablefuture_literal" href="#_gateway_methods_can_return_literal_completablefuture_literal"></a>Gateway Methods can Return <code class="literal">CompletableFuture&lt;?&gt;</code></h4></div></div></div>

<p>When using Java 8, gateway methods can now return <code class="literal">CompletableFuture&lt;?&gt;</code>.
See <a class="xref" href="messaging-endpoints-chapter.html#gw-completable-future" title="CompletableFuture">the section called &#8220;<code class="literal">CompletableFuture</code>&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_messaginggateway_annotation" href="#_messaginggateway_annotation"></a>MessagingGateway Annotation</h4></div></div></div>

<p>The request and reply timeout properties are now <code class="literal">String</code> instead of <code class="literal">Long</code> to allow configuration with property placeholders or SpEL.
See <a class="xref" href="messaging-endpoints-chapter.html#messaging-gateway-annotation" title="10.4.6&nbsp;@MessagingGateway Annotation">Section&nbsp;10.4.6, &#8220;<code class="literal">@MessagingGateway</code> Annotation&#8221;</a>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-aggregator-changes" href="#x4.2-aggregator-changes"></a>I.9.13&nbsp;Aggregator Changes</h3></div></div></div>

<p>This section describes general changes to the Spring Integration aggregator functionality.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_aggregator_performance" href="#_aggregator_performance"></a>Aggregator Performance</h4></div></div></div>

<p>This release includes some performance improvements for aggregating components (aggregator, resequencer, and others), by more efficiently removing messages from groups when they are released.
New methods (<code class="literal">removeMessagesFromGroup</code>) have been added to the message store.
Set the <code class="literal">removeBatchSize</code> property (default: <code class="literal">100</code>) to adjust the number of messages deleted in each operation.
Currently, the JDBC, Redis, and MongoDB message stores support this property.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_output_message_group_processor" href="#_output_message_group_processor"></a>Output Message Group Processor</h4></div></div></div>

<p>When using a <code class="literal">ref</code> or inner bean for the aggregator, you can now directly bind a <code class="literal">MessageGroupProcessor</code>.
In addition, we added a <code class="literal">SimpleMessageGroupProcessor</code> that returns the collection of messages in the group.
When an output processor produces a collection of <code class="literal">Message&lt;?&gt;</code>, the aggregator releases those messages individually.
Configuring the <code class="literal">SimpleMessageGroupProcessor</code> makes the aggregator a message barrier, where messages are held up until they all arrive and are then released individually.
See <a class="xref" href="messaging-routing-chapter.html#aggregator" title="8.4&nbsp;Aggregator">Section&nbsp;8.4, &#8220;Aggregator&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_ftp_and_sftp_changes_2" href="#_ftp_and_sftp_changes_2"></a>I.9.14&nbsp;FTP and SFTP Changes</h3></div></div></div>

<p>This section describes general changes to the Spring Integration FTP and SFTP functionality.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_inbound_channel_adapters" href="#_inbound_channel_adapters"></a>Inbound Channel Adapters</h4></div></div></div>

<p>You can now specify a <code class="literal">remote-directory-expression</code> on the inbound channel adapters, to determine the directory at runtime.
See <a class="xref" href="ftp.html" title="18.&nbsp;FTP/FTPS Adapters">Chapter&nbsp;18, <i>FTP/FTPS Adapters</i></a> and <a class="xref" href="sftp.html" title="30.&nbsp;SFTP Adapters">Chapter&nbsp;30, <i>SFTP Adapters</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_gateway_partial_results" href="#_gateway_partial_results"></a>Gateway Partial Results</h4></div></div></div>

<p>When you use FTP or SFTP outbound gateways to operate on multiple files (with <code class="literal">mget</code> and <code class="literal">mput</code>), an exception can
occur after part of the request is completed.
If such a condition occurs, a <code class="literal">PartialSuccessException</code> that contains the partial results is thrown.
See <a class="xref" href="ftp.html#ftp-outbound-gateway" title="18.9&nbsp;FTP Outbound Gateway">Section&nbsp;18.9, &#8220;FTP Outbound Gateway&#8221;</a> and <a class="xref" href="sftp.html#sftp-outbound-gateway" title="30.11&nbsp;SFTP Outbound Gateway">Section&nbsp;30.11, &#8220;SFTP Outbound Gateway&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_delegating_session_factory" href="#_delegating_session_factory"></a>Delegating Session Factory</h4></div></div></div>

<p>We added a delegating session factory, enabling the selection of a particular session factory based on some thread context value.</p>
<p>See <a class="xref" href="ftp.html#ftp-dsf" title="18.3&nbsp;Delegating Session Factory">Section&nbsp;18.3, &#8220;Delegating Session Factory&#8221;</a> and <a class="xref" href="sftp.html#sftp-dsf" title="30.3&nbsp;Delegating Session Factory">Section&nbsp;30.3, &#8220;Delegating Session Factory&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_default_sftp_session_factory" href="#_default_sftp_session_factory"></a>Default Sftp Session Factory</h4></div></div></div>

<p>Previously, the <code class="literal">DefaultSftpSessionFactory</code> unconditionally allowed connections to unknown hosts.
This is now configurable (default: <code class="literal">false</code>).</p>
<p>The factory now requires a configured <code class="literal">knownHosts</code>, file unless the <code class="literal">allowUnknownKeys</code> property is <code class="literal">true</code> (default: <code class="literal">false</code>).</p>
<p>See <a class="xref" href="sftp.html#sftp-unk-keys">Section&nbsp;30.1.1, &#8220;Configuration Properties&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_message_session_callback" href="#_message_session_callback"></a>Message Session Callback</h4></div></div></div>

<p>We introduced the <code class="literal">MessageSessionCallback&lt;F, T&gt;</code> to perform any custom <code class="literal">Session</code> operations with the <code class="literal">requestMessage</code> context in the <code class="literal">&lt;int-(s)ftp:outbound-gateway/&gt;</code>.</p>
<p>See <a class="xref" href="ftp.html#ftp-session-callback" title="18.12&nbsp;Using MessageSessionCallback">Section&nbsp;18.12, &#8220;Using <code class="literal">MessageSessionCallback</code>&#8221;</a> and <a class="xref" href="sftp.html#sftp-session-callback" title="30.13&nbsp;MessageSessionCallback">Section&nbsp;30.13, &#8220;MessageSessionCallback&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_websocket_changes_2" href="#_websocket_changes_2"></a>I.9.15&nbsp;Websocket Changes</h3></div></div></div>

<p>We added <code class="literal">WebSocketHandlerDecoratorFactory</code> support to the <code class="literal">ServerWebSocketContainer</code> to allow chained customization for the internal <code class="literal">WebSocketHandler</code>.
See <a class="xref" href="web-sockets.html#web-sockets-namespace" title="36.4&nbsp;WebSockets Namespace Support">Section&nbsp;36.4, &#8220;WebSockets Namespace Support&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_application_event_adapters_changes" href="#_application_event_adapters_changes"></a>I.9.16&nbsp;Application Event Adapters changes</h3></div></div></div>

<p>The <code class="literal">ApplicationEvent</code> adapters can now operate with <code class="literal">payload</code> as an <code class="literal">event</code> to directly allow omitting custom <code class="literal">ApplicationEvent</code> extensions.
For this purpose, we introduced the <code class="literal">publish-payload</code> boolean attribute has been introduced on the <code class="literal">&lt;int-event:outbound-channel-adapter&gt;</code>.
See <a class="xref" href="applicationevent.html" title="15.&nbsp;Spring ApplicationEvent Support">Chapter&nbsp;15, <i>Spring <code class="literal">ApplicationEvent</code> Support</i></a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="migration-4.0-4.1" href="#migration-4.0-4.1"></a>I.10&nbsp;Changes between 4.0 and 4.1</h2></div></div></div>

<p>See the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki/Spring-Integration-4.0-to-4.1-Migration-Guide" target="_top">Migration Guide</a> for important changes that might affect your applications.
You can find migration guides for all versions back to 2.1 on the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki" target="_top">wiki</a>.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_new_components" href="#_new_components"></a>I.10.1&nbsp;New Components</h3></div></div></div>

<p>Version 4.1 added a number of new components.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-promise-gateway" href="#x4.1-promise-gateway"></a>Promise&lt;?&gt; Gateway</h4></div></div></div>

<p>The messaging gateway methods now support a Reactor <code class="literal">Promise</code> return type.
See <a class="xref" href="messaging-endpoints-chapter.html#async-gateway" title="10.4.10&nbsp;Asynchronous Gateway">Section&nbsp;10.4.10, &#8220;Asynchronous Gateway&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-web-socket-adapters" href="#x4.1-web-socket-adapters"></a>WebSocket support</h4></div></div></div>

<p>The <code class="literal">WebSocket</code> module is now available.
It is fully based on the Spring WebSocket and Spring Messaging modules and provides an <code class="literal">&lt;inbound-channel-adapter&gt;</code> and an <code class="literal">&lt;outbound-channel-adapter&gt;</code>.
See <a class="xref" href="web-sockets.html" title="36.&nbsp;WebSockets Support">Chapter&nbsp;36, <i>WebSockets Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-scatter-gather" href="#x4.1-scatter-gather"></a>Scatter-Gather Enterprise Integration Pattern</h4></div></div></div>

<p>We implemented the scatter-gather enterprise integration pattern.
See <a class="xref" href="messaging-routing-chapter.html#scatter-gather" title="8.7&nbsp;Scatter-Gather">Section&nbsp;8.7, &#8220;Scatter-Gather&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-Routing-Slip" href="#x4.1-Routing-Slip"></a>Routing Slip Pattern</h4></div></div></div>

<p>We added the routing slip EIP pattern implementation.
See <a class="xref" href="messaging-routing-chapter.html#routing-slip" title="Routing Slip">the section called &#8220;Routing Slip&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-idempotent-receiver" href="#x4.1-idempotent-receiver"></a>Idempotent Receiver Pattern</h4></div></div></div>

<p>We added the idempotent receiver enterprise integration pattern implementation by adding the <code class="literal">&lt;idempotent-receiver&gt;</code> component in XML or the <code class="literal">IdempotentReceiverInterceptor</code> and <code class="literal">IdempotentReceiver</code> annotations for Java configuration.
See <a class="xref" href="messaging-endpoints-chapter.html#idempotent-receiver" title="10.9.10&nbsp;Idempotent Receiver Enterprise Integration Pattern">Section&nbsp;10.9.10, &#8220;Idempotent Receiver Enterprise Integration Pattern&#8221;</a> and the <a class="ulink" href="https://docs.spring.io/spring-integration/api/index.html" target="_top">Javadoc</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-BoonJsonObjectMapper" href="#x4.1-BoonJsonObjectMapper"></a>Boon <code class="literal">JsonObjectMapper</code></h4></div></div></div>

<p>We added the Boon <code class="literal">JsonObjectMapper</code> for the JSON transformers.
See <a class="xref" href="messaging-transformation-chapter.html#transformer" title="9.1&nbsp;Transformer">Section&nbsp;9.1, &#8220;Transformer&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-redis-queue-gateways" href="#x4.1-redis-queue-gateways"></a>Redis Queue Gateways</h4></div></div></div>

<p>We added the <code class="literal">&lt;redis-queue-inbound-gateway&gt;</code> and <code class="literal">&lt;redis-queue-outbound-gateway&gt;</code> components.
See <a class="xref" href="redis.html#redis-queue-inbound-gateway" title="27.9&nbsp;Redis Queue Inbound Gateway">Section&nbsp;27.9, &#8220;Redis Queue Inbound Gateway&#8221;</a> and <a class="xref" href="redis.html#redis-queue-outbound-gateway" title="27.8&nbsp;Redis Queue Outbound Gateway">Section&nbsp;27.8, &#8220;Redis Queue Outbound Gateway&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-PollSkipAdvice" href="#x4.1-PollSkipAdvice"></a><code class="literal">PollSkipAdvice</code></h4></div></div></div>

<p>We added the <code class="literal">PollSkipAdvice</code>, which you can use within the <code class="literal">&lt;advice-chain&gt;</code> of the <code class="literal">&lt;poller&gt;</code> to determine if the current poll should be suppressed (skipped) by some condition that you implement with <code class="literal">PollSkipStrategy</code>.
See <a class="xref" href="messaging-channels-section.html#polling-consumer" title="6.2&nbsp;Poller">Section&nbsp;6.2, &#8220;Poller&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.1-general" href="#x4.1-general"></a>I.10.2&nbsp;General Changes</h3></div></div></div>

<p>This section describes general changes from version 4.0 to version 4.1.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-amqp-inbound-missing-queues" href="#x4.1-amqp-inbound-missing-queues"></a>AMQP Inbound Endpoints, Channel</h4></div></div></div>

<p>Elements that use a message listener container (inbound endpoints and channel) now support the <code class="literal">missing-queues-fatal</code> attribute.
See <a class="xref" href="amqp.html" title="14.&nbsp;AMQP Support">Chapter&nbsp;14, <i>AMQP Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-amqp-outbound-lazy-connect" href="#x4.1-amqp-outbound-lazy-connect"></a>AMQP Outbound Endpoints</h4></div></div></div>

<p>The AMQP outbound endpoints support a new property called <code class="literal">lazy-connect</code> (default: <code class="literal">true</code>).
When <code class="literal">true</code>, the connection to the broker is not established until the first message arrives (assuming there are no inbound endpoints, which always try to establish the connection during startup).
When set to <code class="literal">false</code>, an attempt to establish the connection is made during application startup.
See <a class="xref" href="amqp.html" title="14.&nbsp;AMQP Support">Chapter&nbsp;14, <i>AMQP Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-sms-copy-on-get" href="#x4.1-sms-copy-on-get"></a>SimpleMessageStore</h4></div></div></div>

<p>The <code class="literal">SimpleMessageStore</code> no longer makes a copy of the group when calling <code class="literal">getMessageGroup()</code>.
See <a class="xref" href="system-management-chapter.html#sms-caution" title="Caution about SimpleMessageStore">Caution about <code class="literal">SimpleMessageStore</code></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-ws-encode-uri" href="#x4.1-ws-encode-uri"></a>Web Service Outbound Gateway: <code class="literal">encode-uri</code></h4></div></div></div>

<p>The <code class="literal">&lt;ws:outbound-gateway/&gt;</code> now provides an <code class="literal">encode-uri</code> attribute to allow disabling the encoding of the URI object before sending the request.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-http-status-code" href="#x4.1-http-status-code"></a>Http Inbound Channel Adapter and Status Code</h4></div></div></div>

<p>The <code class="literal">&lt;http:inbound-channel-adapter&gt;</code> can now be configured with a <code class="literal">status-code-expression</code> to override the default <code class="literal">200 OK</code> status.
See <a class="xref" href="http.html#http-namespace" title="20.3&nbsp;HTTP Namespace Support">Section&nbsp;20.3, &#8220;HTTP Namespace Support&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-mqtt" href="#x4.1-mqtt"></a>MQTT Adapter Changes</h4></div></div></div>

<p>You can now configure the MQTT channel adapters to connect to multiple servers&#8201;&#8212;&#8201;for example, to support High Availability (HA).
See <a class="xref" href="mqtt.html" title="26.&nbsp;MQTT Support">Chapter&nbsp;26, <i>MQTT Support</i></a> for more information.</p>
<p>The MQTT message-driven channel adapter now supports specifying the QoS setting for each subscription.
See <a class="xref" href="mqtt.html#mqtt-inbound" title="26.1&nbsp;Inbound (Message-driven) Channel Adapter">Section&nbsp;26.1, &#8220;Inbound (Message-driven) Channel Adapter&#8221;</a> for more information.</p>
<p>The MQTT outbound channel adapter now supports asynchronous sends, avoiding blocking until delivery is confirmed.
See <a class="xref" href="mqtt.html#mqtt-outbound" title="26.2&nbsp;Outbound Channel Adapter">Section&nbsp;26.2, &#8220;Outbound Channel Adapter&#8221;</a> for more information.</p>
<p>It is now possible to programmatically subscribe to and unsubscribe from topics at runtime.
See <a class="xref" href="mqtt.html#mqtt-inbound" title="26.1&nbsp;Inbound (Message-driven) Channel Adapter">Section&nbsp;26.1, &#8220;Inbound (Message-driven) Channel Adapter&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-sftp" href="#x4.1-sftp"></a>FTP and SFTP Adapter Changes</h4></div></div></div>

<p>The FTP and SFTP outbound channel adapters now support appending to remote files and taking specific actions when a remote file already exists.
The remote file templates now also supports this, as well as <code class="literal">rmdir()</code> and <code class="literal">exists()</code>.
In addition, the remote file templates provide access to the underlying client object, enabling access to low-level APIs.</p>
<p>See <a class="xref" href="ftp.html" title="18.&nbsp;FTP/FTPS Adapters">Chapter&nbsp;18, <i>FTP/FTPS Adapters</i></a> and <a class="xref" href="sftp.html" title="30.&nbsp;SFTP Adapters">Chapter&nbsp;30, <i>SFTP Adapters</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-splitter-iterator" href="#x4.1-splitter-iterator"></a>Splitter and Iterator</h4></div></div></div>

<p><code class="literal">Splitter</code> components now support an <code class="literal">Iterator</code> as the result object for producing output messages.
See <a class="xref" href="messaging-routing-chapter.html#splitter" title="8.3&nbsp;Splitter">Section&nbsp;8.3, &#8220;Splitter&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-aggregator" href="#x4.1-aggregator"></a>Aggregator</h4></div></div></div>

<p><code class="literal">Aggregator</code> instancess now support a new attribute <code class="literal">expire-groups-upon-timeout</code>.
See <a class="xref" href="messaging-routing-chapter.html#aggregator" title="8.4&nbsp;Aggregator">Section&nbsp;8.4, &#8220;Aggregator&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-content-enricher-improvement" href="#x4.1-content-enricher-improvement"></a>Content Enricher Improvements</h4></div></div></div>

<p>We added a <code class="literal">null-result-expression</code> attribute, which is evaluated and returned if <code class="literal">&lt;enricher&gt;</code> returns <code class="literal">null</code>.
You can add it in <code class="literal">&lt;header&gt;</code> and <code class="literal">&lt;property&gt;</code>.
See <a class="xref" href="messaging-transformation-chapter.html#content-enricher" title="9.2&nbsp;Content Enricher">Section&nbsp;9.2, &#8220;Content Enricher&#8221;</a> for more information.</p>
<p>We added an <code class="literal">error-channel</code> attribute, which is used to handle an error flow if an <code class="literal">Exception</code> occurs downstream of the <code class="literal">request-channel</code>.
This lets you return an alternative object to use for enrichment.
See <a class="xref" href="messaging-transformation-chapter.html#content-enricher" title="9.2&nbsp;Content Enricher">Section&nbsp;9.2, &#8220;Content Enricher&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-header-channel-registry" href="#x4.1-header-channel-registry"></a>Header Channel Registry</h4></div></div></div>

<p>The <code class="literal">&lt;header-enricher/&gt;</code> element&#8217;s <code class="literal">&lt;header-channels-to-string/&gt;</code> child element can now override the header channel registry&#8217;s default time for retaining channel mappings.
See <a class="xref" href="messaging-transformation-chapter.html#header-channel-registry" title="Header Channel Registry">the section called &#8220;Header Channel Registry&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-orderly-shutdown" href="#x4.1-orderly-shutdown"></a>Orderly Shutdown</h4></div></div></div>

<p>We made improvements to the orderly shutdown algorithm.
See <a class="xref" href="system-management-chapter.html#jmx-shutdown" title="12.7&nbsp;Orderly Shutdown">Section&nbsp;12.7, &#8220;Orderly Shutdown&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-recipientListRouter" href="#x4.1-recipientListRouter"></a>Management for <code class="literal">RecipientListRouter</code></h4></div></div></div>

<p>The <code class="literal">RecipientListRouter</code> now provides several management operations to configure recipients at runtime.
With that, you can now configure the <code class="literal">&lt;recipient-list-router&gt;</code> without any <code class="literal">&lt;recipient&gt;</code> from the start.
See <a class="xref" href="messaging-routing-chapter.html#recipient-list-router-management" title="RecipientListRouterManagement">the section called &#8220;<code class="literal">RecipientListRouterManagement</code>&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-AbstractHeaderMapper-changes" href="#x4.1-AbstractHeaderMapper-changes"></a>AbstractHeaderMapper: NON_STANDARD_HEADERS token</h4></div></div></div>

<p>The <code class="literal">AbstractHeaderMapper</code> implementation now provides the additional <code class="literal">NON_STANDARD_HEADERS</code> token to map any user-defined headers, which are not mapped by default.
See <a class="xref" href="amqp.html#amqp-message-headers" title="14.12&nbsp;AMQP Message Headers">Section&nbsp;14.12, &#8220;AMQP Message Headers&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-amqp-channels" href="#x4.1-amqp-channels"></a>AMQP Channels: <code class="literal">template-channel-transacted</code></h4></div></div></div>

<p>We introduced the <code class="literal">template-channel-transacted</code> attribute for AMQP <code class="literal">MessageChannel</code> instances.
See <a class="xref" href="amqp.html#amqp-channels" title="14.11&nbsp;AMQP-backed Message Channels">Section&nbsp;14.11, &#8220;AMQP-backed Message Channels&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-syslog" href="#x4.1-syslog"></a>Syslog Adapter</h4></div></div></div>

<p>The default syslog message converter now has an option to retain the original message in the payload while still setting the headers.
See <a class="xref" href="syslog.html#syslog-inbound-adapter" title="33.1&nbsp;Syslog Inbound Channel Adapter">Section&nbsp;33.1, &#8220;Syslog Inbound Channel Adapter&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-async-gateway" href="#x4.1-async-gateway"></a>Asynchronous Gateway</h4></div></div></div>

<p>In addition to the <code class="literal">Promise</code> return type <a class="link" href="history.html#x4.1-promise-gateway" title="Promise<?&gt; Gateway">mentioned earlier</a>, gateway methods may now return a <code class="literal">ListenableFuture</code>, introduced in Spring Framework 4.0.
You can also disable asynchronous processing in the gateway, letting a downstream flow directly return a <code class="literal">Future</code>.
See <a class="xref" href="messaging-endpoints-chapter.html#async-gateway" title="10.4.10&nbsp;Asynchronous Gateway">Section&nbsp;10.4.10, &#8220;Asynchronous Gateway&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-aggregator-advice-chain" href="#x4.1-aggregator-advice-chain"></a>Aggregator Advice Chain</h4></div></div></div>

<p><code class="literal">Aggregator</code> and <code class="literal">Resequencer</code> now support <code class="literal">&lt;expire-advice-chain/&gt;</code> and <code class="literal">&lt;expire-transactional/&gt;</code> child elements to advise the <code class="literal">forceComplete</code> operation.
See <a class="xref" href="">???</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-script-outbound-channel-adapter" href="#x4.1-script-outbound-channel-adapter"></a>Outbound Channel Adapter and Scripts</h4></div></div></div>

<p>The <code class="literal">&lt;int:outbound-channel-adapter/&gt;</code> now supports the <code class="literal">&lt;script/&gt;</code> child element.
The underlying script must have a <code class="literal">void</code> return type or return <code class="literal">null</code>.
See <a class="xref" href="messaging-endpoints-chapter.html#groovy" title="10.8&nbsp;Groovy support">Section&nbsp;10.8, &#8220;Groovy support&#8221;</a> and <a class="xref" href="messaging-endpoints-chapter.html#scripting" title="10.7&nbsp;Scripting Support">Section&nbsp;10.7, &#8220;Scripting Support&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-reseq" href="#x4.1-reseq"></a>Resequencer Changes</h4></div></div></div>

<p>When a message group in a resequencer times out (using <code class="literal">group-timeout</code> or a <code class="literal">MessageGroupStoreReaper</code>), late arriving messages are now, by default, discarded immediately.
See <a class="xref" href="messaging-routing-chapter.html#resequencer" title="8.5&nbsp;Resequencer">Section&nbsp;8.5, &#8220;Resequencer&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-Optional-Parameter" href="#x4.1-Optional-Parameter"></a>Optional POJO method parameter</h4></div></div></div>

<p>Spring Integration now consistently handles the Java 8&#8217;s <code class="literal">Optional</code> type.
See <a class="xref" href="messaging-endpoints-chapter.html#service-activator-namespace" title="10.5.1&nbsp;Configuring Service Activator">Section&nbsp;10.5.1, &#8220;Configuring Service Activator&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-queue-channel-queue.typ" href="#x4.1-queue-channel-queue.typ"></a><code class="literal">QueueChannel</code> backed Queue type</h4></div></div></div>

<p>The <code class="literal">QueueChannel</code> backed <code class="literal">Queue type</code> has been changed from <code class="literal">BlockingQueue</code> to the more generic <code class="literal">Queue</code>.
This change allows the use of any external <code class="literal">Queue</code> implementation (for example, Reactor&#8217;s <code class="literal">PersistentQueue</code>).
See <a class="xref" href="messaging-channels-section.html#channel-configuration-queuechannel" title="QueueChannel Configuration">the section called &#8220;<code class="literal">QueueChannel</code> Configuration&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-channel-interceptor" href="#x4.1-channel-interceptor"></a><code class="literal">ChannelInterceptor</code> Changes</h4></div></div></div>

<p>The <code class="literal">ChannelInterceptor</code> now supports additional <code class="literal">afterSendCompletion()</code> and <code class="literal">afterReceiveCompletion()</code> methods.
See <a class="xref" href="messaging-channels-section.html#channel-interceptors" title="6.1.3&nbsp;Channel Interceptors">Section&nbsp;6.1.3, &#8220;Channel Interceptors&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-mail-peek" href="#x4.1-mail-peek"></a>IMAP PEEK</h4></div></div></div>

<p>Since version 4.1.1 there is a change of behavior if you explicitly set the <code class="literal">mail.[protocol].peek</code> JavaMail property to <code class="literal">false</code> (where <code class="literal">[protocol]</code> is <code class="literal">imap</code> or <code class="literal">imaps</code>).
See <a class="xref" href="mail.html#imap-peek" title="Important: IMAP PEEK">Important: IMAP PEEK</a>.</p>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="migration-3.0-4.0" href="#migration-3.0-4.0"></a>I.11&nbsp;Changes between 3.0 and 4.0</h2></div></div></div>

<p>See the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki/Spring-Integration-3.0-to-4.0-Migration-Guide" target="_top">Migration Guide</a> for important changes that might affect your applications.
You can find migration guides for all versions back to 2.1 on the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki" target="_top">wiki</a>.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.0-new-components" href="#x4.0-new-components"></a>I.11.1&nbsp;New Components</h3></div></div></div>

<p>Version 4.0 added a number of new components.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-mqtt" href="#x4.0-mqtt"></a>MQTT Channel Adapters</h4></div></div></div>

<p>The MQTT channel adapters (previously available in the Spring Integration Extensions repository) are now available as part of the normal Spring Integration distribution.
See <a class="xref" href="mqtt.html" title="26.&nbsp;MQTT Support">Chapter&nbsp;26, <i>MQTT Support</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-enable-configuration" href="#x4.0-enable-configuration"></a><code class="literal">@EnableIntegration</code></h4></div></div></div>

<p>We added the <code class="literal">@EnableIntegration</code> annotation to permit declaration of standard Spring Integration beans when using <code class="literal">@Configuration</code> classes.
See <a class="xref" href="configuration.html#annotations" title="E.5&nbsp;Annotation Support">Section&nbsp;E.5, &#8220;Annotation Support&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-component-scan" href="#x4.0-component-scan"></a><code class="literal">@IntegrationComponentScan</code></h4></div></div></div>

<p>We added the <code class="literal">@IntegrationComponentScan</code> annotation to permit classpath scanning for Spring Integration-specific components.
See <a class="xref" href="configuration.html#annotations" title="E.5&nbsp;Annotation Support">Section&nbsp;E.5, &#8220;Annotation Support&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-message-history" href="#x4.0-message-history"></a>"<code class="literal">@EnableMessageHistory</code>"</h4></div></div></div>

<p>You can now enable message history with the <code class="literal">@EnableMessageHistory</code> annotation in a <code class="literal">@Configuration</code> class.
In addition, a JMX MBean can modify the message history settings.
Also, <code class="literal">MessageHistory</code> can track auto-created <code class="literal">MessageHandler</code> instances for annotated endpoints (such as <code class="literal">@ServiceActivator</code>, <code class="literal">@Splitter</code>, and others).
For more information, see <a class="xref" href="system-management-chapter.html#message-history" title="12.3&nbsp;Message History">Section&nbsp;12.3, &#8220;Message History&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-messaging-gateway" href="#x4.0-messaging-gateway"></a><code class="literal">@MessagingGateway</code></h4></div></div></div>

<p>You can now configure messaging gateway interfaces with the <code class="literal">@MessagingGateway</code> annotation.
It is an analogue of the <code class="literal">&lt;int:gateway/&gt;</code> XML element.
For more information, see <a class="xref" href="messaging-endpoints-chapter.html#messaging-gateway-annotation" title="10.4.6&nbsp;@MessagingGateway Annotation">Section&nbsp;10.4.6, &#8220;<code class="literal">@MessagingGateway</code> Annotation&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-boot" href="#x4.0-boot"></a>Spring Boot <code class="literal">@EnableAutoConfiguration</code></h4></div></div></div>

<p>As well as the <code class="literal">@EnableIntegration</code> annotation mentioned earlier, we introduced a hook to allow the Spring Integration infrastructure beans to be configured with Spring Boot&#8217;s <code class="literal">@EnableAutoConfiguration</code> annotation.
For more information, see <a class="ulink" href="http://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-auto-configuration.html" target="_top">"<code class="literal">Auto-configuration</code>"</a> in the Spring Boot Reference Guide.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-global-channel-interceptor" href="#x4.0-global-channel-interceptor"></a><code class="literal">@GlobalChannelInterceptor</code></h4></div></div></div>

<p>As well as the <code class="literal">@EnableIntegration</code> annotation mentioned above, we introduced the <code class="literal">@GlobalChannelInterceptor</code> annotation.
For more information, see <a class="xref" href="configuration.html#annotations" title="E.5&nbsp;Annotation Support">Section&nbsp;E.5, &#8220;Annotation Support&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-integration-converter" href="#x4.0-integration-converter"></a><code class="literal">@IntegrationConverter</code></h4></div></div></div>

<p>We introduced the <code class="literal">@IntegrationConverter</code> annotation as an analogue of the <code class="literal">&lt;int:converter/&gt;</code> component.
For more information, see <a class="xref" href="configuration.html#annotations" title="E.5&nbsp;Annotation Support">Section&nbsp;E.5, &#8220;Annotation Support&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-enable-publisher" href="#x4.0-enable-publisher"></a><code class="literal">@EnablePublisher</code></h4></div></div></div>

<p>We added the <code class="literal">@EnablePublisher</code> annotation to allow the specification of a <code class="literal">default-publisher-channel</code> for <code class="literal">@Publisher</code> annotations.
See <a class="xref" href="configuration.html#annotations" title="E.5&nbsp;Annotation Support">Section&nbsp;E.5, &#8220;Annotation Support&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-redis-cms" href="#x4.0-redis-cms"></a>Redis Channel Message Stores</h4></div></div></div>

<p>We added a Redis <code class="literal">MessageGroupStore</code> that is optimized for use when backing a <code class="literal">QueueChannel</code> for persistence.
For more information, see <a class="xref" href="redis.html#redis-cms" title="27.3.1&nbsp;Redis Channel Message Stores">Section&nbsp;27.3.1, &#8220;Redis Channel Message Stores&#8221;</a>.</p>
<p>We added a Redis <code class="literal">ChannelPriorityMessageStore</code>.
You can use it to retrieve messages by priority.
For more information, see <a class="xref" href="redis.html#redis-cms" title="27.3.1&nbsp;Redis Channel Message Stores">Section&nbsp;27.3.1, &#8220;Redis Channel Message Stores&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-priority-channel-mondodb" href="#x4.0-priority-channel-mondodb"></a>MongodDB Channel Message Store</h4></div></div></div>

<p>The MongoDB support now provides the <code class="literal">MongoDbChannelMessageStore</code>, which is a channel-specific <code class="literal">MessageStore</code> implementation.
With <code class="literal">priorityEnabled = true</code>, you can use it in <code class="literal">&lt;int:priority-queue&gt;</code> elements to achieve priority order polling of persisted messages.
For more information see <a class="xref" href="mongodb.html#mongodb-priority-channel-message-store" title="25.2.1&nbsp;MongoDB Channel Message Store">Section&nbsp;25.2.1, &#8220;MongoDB Channel Message Store&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-MBeanExport-annotation" href="#x4.0-MBeanExport-annotation"></a><code class="literal">@EnableIntegrationMBeanExport</code></h4></div></div></div>

<p>You can now enable the <code class="literal">IntegrationMBeanExporter</code> with the <code class="literal">@EnableIntegrationMBeanExport</code> annotation in a <code class="literal">@Configuration</code> class.
For more information, see <a class="xref" href="system-management-chapter.html#jmx-mbean-exporter" title="12.2.7&nbsp;MBean Exporter">Section&nbsp;12.2.7, &#8220;MBean Exporter&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-channel-security-interceptor" href="#x4.0-channel-security-interceptor"></a><code class="literal">ChannelSecurityInterceptorFactoryBean</code></h4></div></div></div>

<p><code class="literal">ChannelSecurityInterceptorFactoryBean</code> now supports configuration of Spring Security for message channels that use <code class="literal">@Configuration</code> classes.
For more information, see <a class="xref" href="security.html" title="Appendix&nbsp;D.&nbsp;Security in Spring Integration">Appendix&nbsp;D, <i>Security in Spring Integration</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-redis-outbound-gateway" href="#x4.0-redis-outbound-gateway"></a>Redis Command Gateway</h4></div></div></div>

<p>The Redis support now provides the <code class="literal">&lt;outbound-gateway&gt;</code> component to perform generic Redis commands by using the <code class="literal">RedisConnection#execute</code> method.
For more information, see <a class="xref" href="redis.html#redis-outbound-gateway" title="27.7&nbsp;Redis Outbound Command Gateway">Section&nbsp;27.7, &#8220;Redis Outbound Command Gateway&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-redis-gemfire-lock-registry" href="#x4.0-redis-gemfire-lock-registry"></a><code class="literal">RedisLockRegistry</code> and <code class="literal">GemfireLockRegistry</code></h4></div></div></div>

<p>The <code class="literal">RedisLockRegistry</code> and <code class="literal">GemfireLockRegistry</code> are now available to support global locks visible to multiple application instances and servers.
These can be used with aggregating message handlers across multiple application instances such that group release occurs on only one instance.
For more information, see <a class="xref" href="redis.html#redis-lock-registry" title="27.10&nbsp;Redis Lock Registry">Section&nbsp;27.10, &#8220;Redis Lock Registry&#8221;</a>, <a class="xref" href="gemfire.html#gemfire-lock-registry" title="19.5&nbsp;Gemfire Lock Registry">Section&nbsp;19.5, &#8220;Gemfire Lock Registry&#8221;</a>, and <a class="xref" href="messaging-routing-chapter.html#aggregator" title="8.4&nbsp;Aggregator">Section&nbsp;8.4, &#8220;Aggregator&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-poller-annotation" href="#x4.0-poller-annotation"></a><code class="literal">@Poller</code></h4></div></div></div>

<p>Annotation-based messaging configuration can now have a <code class="literal">poller</code> attribute.
This means that methods annotated with <code class="literal">@ServiceActivator</code>, <code class="literal">@Aggregator</code>, and similar annotations can now use an <code class="literal">inputChannel</code> that is a reference to a <code class="literal">PollableChannel</code>.
For more information, see <a class="xref" href="configuration.html#annotations" title="E.5&nbsp;Annotation Support">Section&nbsp;E.5, &#8220;Annotation Support&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-inbound-channel-adapter-annotation" href="#x4.0-inbound-channel-adapter-annotation"></a><code class="literal">@InboundChannelAdapter</code> and <code class="literal">SmartLifecycle</code> for Annotated Endpoints</h4></div></div></div>

<p>We added the <code class="literal">@InboundChannelAdapter</code> method annotation.
It is an analogue of the <code class="literal">&lt;int:inbound-channel-adapter&gt;</code> XML component.
In addition, all messaging annotations now provide <code class="literal">SmartLifecycle</code> options.
For more information, see <a class="xref" href="configuration.html#annotations" title="E.5&nbsp;Annotation Support">Section&nbsp;E.5, &#8220;Annotation Support&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-twitter-sog" href="#x4.0-twitter-sog"></a>Twitter Search Outbound Gateway</h4></div></div></div>

<p>We added a new twitter endpoint: <code class="literal">&lt;int-twitter-search-outbound-gateway/&gt;</code>.
Unlike the search inbound adapter, which polls by using the same search query each time, the outbound gateway allows on-demand customized queries.
For more information, see <a class="ulink" href="https://github.com/spring-projects/spring-integration-extensions/tree/master/spring-integration-social-twitter" target="_top">Spring Integration Social Twitter</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-gemfire-metadata" href="#x4.0-gemfire-metadata"></a>Gemfire Metadata Store</h4></div></div></div>

<p>We added the <code class="literal">GemfireMetadataStore</code>, letting it be used, for example, in an <code class="literal">AbstractPersistentAcceptOnceFileListFilter</code> implementation in a multiple application instance or server environment.
For more information, see <a class="xref" href="system-management-chapter.html#metadata-store" title="12.5&nbsp;Metadata Store">Section&nbsp;12.5, &#8220;Metadata Store&#8221;</a>, <a class="xref" href="files.html#file-reading" title="17.1&nbsp;Reading Files">Section&nbsp;17.1, &#8220;Reading Files&#8221;</a>, <a class="xref" href="ftp.html#ftp-inbound" title="18.4&nbsp;FTP Inbound Channel Adapter">Section&nbsp;18.4, &#8220;FTP Inbound Channel Adapter&#8221;</a>, and <a class="xref" href="sftp.html#sftp-inbound" title="30.6&nbsp;SFTP Inbound Channel Adapter">Section&nbsp;30.6, &#8220;SFTP Inbound Channel Adapter&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-bridge-annotations" href="#x4.0-bridge-annotations"></a><code class="literal">@BridgeFrom</code> and <code class="literal">@BridgeTo</code> Annotations</h4></div></div></div>

<p>We introduced <code class="literal">@BridgeFrom</code> and <code class="literal">@BridgeTo</code> <code class="literal">@Bean</code> method annotations to mark <code class="literal">MessageChannel</code> beans in <code class="literal">@Configuration</code> classes.
For more information, see <a class="xref" href="configuration.html#annotations" title="E.5&nbsp;Annotation Support">Section&nbsp;E.5, &#8220;Annotation Support&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-meta-messaging-annotations" href="#x4.0-meta-messaging-annotations"></a>Meta-messaging Annotations</h4></div></div></div>

<p>Messaging annotations (<code class="literal">@ServiceActivator</code>, <code class="literal">@Router</code>, <code class="literal">@MessagingGateway</code>, and others) can now be configured as meta-annotations for user-defined messaging annotations.
In addition, the user-defined annotations can have the same attributes (<code class="literal">inputChannel</code>, <code class="literal">@Poller</code>, <code class="literal">autoStartup</code>, and others).
For more information, see <a class="xref" href="configuration.html#annotations" title="E.5&nbsp;Annotation Support">Section&nbsp;E.5, &#8220;Annotation Support&#8221;</a>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.0-general" href="#x4.0-general"></a>I.11.2&nbsp;General Changes</h3></div></div></div>

<p>This section describes general changes from version 3.0 to version 4.0.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_requires_spring_framework_4_0" href="#_requires_spring_framework_4_0"></a>Requires Spring Framework 4.0</h4></div></div></div>

<p>We moved the core messaging abstractions (<code class="literal">Message</code>, <code class="literal">MessageChannel</code>, and others) to the Spring Framework <code class="literal">spring-messaging</code> module.
Developers who reference these classes directly in their code need to make changes, as described in the first section of the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki/Spring-Integration-3.0-to-4.0-Migration-Guide" target="_top">3.0 to 4.0 Migration Guide</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-xpath-header-enricher-header-type" href="#x4.0-xpath-header-enricher-header-type"></a>Header Type for XPath Header Enricher</h4></div></div></div>

<p>We introduced the <code class="literal">header-type</code> attribute for the <code class="literal">header</code> child element of the <code class="literal">&lt;int-xml:xpath-header-enricher&gt;</code>.
This attribute provides the target type for the header value (to which the result of the XPath expression evaluation is converted).
For more information see <a class="xref" href="xml.html#xml-xpath-header-enricher" title="38.6&nbsp;XPath Header Enricher">Section&nbsp;38.6, &#8220;XPath Header Enricher&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-object-to-json-transformer-result-type" href="#x4.0-object-to-json-transformer-result-type"></a>Object To JSON Transformer: Node Result</h4></div></div></div>

<p>We introduced the <code class="literal">result-type</code> attribute for the <code class="literal">&lt;int:object-to-json-transformer&gt;</code>.
This attribute provides the target type for the result of mapping an object to JSON.
It supports <code class="literal">STRING</code> (the default) and <code class="literal">NODE</code>.
For more information see <a class="xref" href="messaging-transformation-chapter.html#transformer-xpath-spel-function">the section called &#8220;JSON Transformers&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-jms-header-mapping" href="#x4.0-jms-header-mapping"></a>JMS Header Mapping</h4></div></div></div>

<p>The <code class="literal">DefaultJmsHeaderMapper</code> now maps an incoming <code class="literal">JMSPriority</code> header to the Spring Integration <code class="literal">priority</code> header.
Previously, <code class="literal">priority</code> was only considered for outbound messages.
For more information, see <a class="xref" href="jms.html#jms-header-mapping" title="23.6&nbsp;Mapping Message Headers to and from JMS Message">Section&nbsp;23.6, &#8220;Mapping Message Headers to and from JMS Message&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-jms-ob" href="#x4.0-jms-ob"></a>JMS Outbound Channel Adapter</h4></div></div></div>

<p>The JMS outbound channel adapter now supports the <code class="literal">session-transacted</code> attribute (default: <code class="literal">false</code>).
Previously, you had to inject a customized <code class="literal">JmsTemplate</code> to use transactions.
See <a class="xref" href="jms.html#jms-outbound-channel-adapter" title="23.3&nbsp;Outbound Channel Adapter">Section&nbsp;23.3, &#8220;Outbound Channel Adapter&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-jms-ib" href="#x4.0-jms-ib"></a>JMS Inbound Channel Adapter</h4></div></div></div>

<p>The JMS inbound channel adapter now supports the <code class="literal">session-transacted</code> attribute (default: <code class="literal">false</code>).
Previously, you had to inject a customized <code class="literal">JmsTemplate</code> to use transactions.
The adapter allowed <span class="emphasis"><em>transacted</em></span> in the <code class="literal">acknowledgeMode</code>, which was incorrect and didn&#8217;t work.
This value is no longer allowed.
See <a class="xref" href="jms.html#jms-inbound-channel-adapter" title="23.1&nbsp;Inbound Channel Adapter">Section&nbsp;23.1, &#8220;Inbound Channel Adapter&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-datatype-channel" href="#x4.0-datatype-channel"></a>Datatype Channels</h4></div></div></div>

<p>You can now specify a <code class="literal">MessageConverter</code> to be used when converting (if necessary) payloads to one of the accepted <code class="literal">datatype</code> instances in a Datatype channel.
For more information, see <a class="xref" href="messaging-channels-section.html#channel-datatype-channel" title="Datatype Channel Configuration">the section called &#8220;Datatype Channel Configuration&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-retry-config" href="#x4.0-retry-config"></a>Simpler Retry Advice Configuration</h4></div></div></div>

<p>We added simplified namespace support to configure a <code class="literal">RequestHandlerRetryAdvice</code>.
For more information, see <a class="xref" href="messaging-endpoints-chapter.html#retry-config" title="Configuring the Retry Advice">the section called &#8220;Configuring the Retry Advice&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-release-strategy-group-timeout" href="#x4.0-release-strategy-group-timeout"></a>Correlation Endpoint: Time-based Release Strategy</h4></div></div></div>

<p>We added the mutually exclusive <code class="literal">group-timeout</code> and <code class="literal">group-timeout-expression</code> attributes to <code class="literal">&lt;int:aggregator&gt;</code> and <code class="literal">&lt;int:resequencer&gt;</code>.
These attributes allow forced completion of a partial <code class="literal">MessageGroup</code>, provided the <code class="literal">ReleaseStrategy</code> does not release a group and no further messages arrive within the time specified.
For more information, see <a class="xref" href="">???</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-redis-metadata" href="#x4.0-redis-metadata"></a>Redis Metadata Store</h4></div></div></div>

<p>The <code class="literal">RedisMetadataStore</code> now implements <code class="literal">ConcurrentMetadataStore</code>, letting it be used, for example, in an <code class="literal">AbstractPersistentAcceptOnceFileListFilter</code> implementation in a multiple application instance or server environment.
For more information, see <a class="xref" href="redis.html#redis-metadata-store" title="27.4&nbsp;Redis Metadata Store">Section&nbsp;27.4, &#8220;Redis Metadata Store&#8221;</a>, <a class="xref" href="files.html#file-reading" title="17.1&nbsp;Reading Files">Section&nbsp;17.1, &#8220;Reading Files&#8221;</a>, <a class="xref" href="ftp.html#ftp-inbound" title="18.4&nbsp;FTP Inbound Channel Adapter">Section&nbsp;18.4, &#8220;FTP Inbound Channel Adapter&#8221;</a>, and <a class="xref" href="sftp.html#sftp-inbound" title="30.6&nbsp;SFTP Inbound Channel Adapter">Section&nbsp;30.6, &#8220;SFTP Inbound Channel Adapter&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-jdbc-cs" href="#x4.0-jdbc-cs"></a><code class="literal">JdbcChannelMessageStore</code> and <code class="literal">PriorityChannel</code></h4></div></div></div>

<p>T`JdbcChannelMessageStore` now implements <code class="literal">PriorityCapableChannelMessageStore</code>, letting it be used as a <code class="literal">message-store</code> reference for <code class="literal">priority-queue</code> instances.
For more information, see <a class="xref" href="jdbc.html#jdbc-message-store-channels" title="21.4.3&nbsp;Backing Message Channels">Section&nbsp;21.4.3, &#8220;Backing Message Channels&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-amqp" href="#x4.0-amqp"></a>AMQP Endpoints Delivery Mode</h4></div></div></div>

<p>Spring AMQP, by default, creates persistent messages on the broker.
You can override this behavior by setting the <code class="literal">amqp_deliveryMode</code> header or customizing the mappers.
We added a convenient <code class="literal">default-delivery-mode</code> attribute to the adapters to provide easier configuration of this important setting.
For more information, see <a class="xref" href="amqp.html#amqp-outbound-channel-adapter" title="14.5&nbsp;Outbound Channel Adapter">Section&nbsp;14.5, &#8220;Outbound Channel Adapter&#8221;</a> and <a class="xref" href="amqp.html#amqp-outbound-gateway" title="14.6&nbsp;Outbound Gateway">Section&nbsp;14.6, &#8220;Outbound Gateway&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-ftp" href="#x4.0-ftp"></a>FTP Timeouts</h4></div></div></div>

<p>The <code class="literal">DefaultFtpSessionFactory</code> now exposes the <code class="literal">connectTimeout</code>, <code class="literal">defaultTimeout</code>, and <code class="literal">dataTimeout</code> properties, avoiding the need to subclass the factory to set these common properties.
The <code class="literal">postProcess*</code> methods are still available for more advanced configuration.
See <a class="xref" href="ftp.html#ftp-session-factory" title="18.1&nbsp;FTP Session Factory">Section&nbsp;18.1, &#8220;FTP Session Factory&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-twitter-status-updating" href="#x4.0-twitter-status-updating"></a>Twitter: <code class="literal">StatusUpdatingMessageHandler</code></h4></div></div></div>

<p>The <code class="literal">StatusUpdatingMessageHandler</code> (<code class="literal">&lt;int-twitter:outbound-channel-adapter&gt;</code>) now supports the <code class="literal">tweet-data-expression</code> attribute to build a <code class="literal">org.springframework.social.twitter.api.TweetData</code> object for updating the timeline status.
This feature allows, for example, attaching an image.
See <a class="ulink" href="https://github.com/spring-projects/spring-integration-extensions/tree/master/spring-integration-social-twitter" target="_top">Spring Integration Social Twitter</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-jpa-id-expression" href="#x4.0-jpa-id-expression"></a>JPA Retrieving Gateway: <code class="literal">id-expression</code></h4></div></div></div>

<p>We introduced the <code class="literal">id-expression</code> attribute for <code class="literal">&lt;int-jpa:retrieving-outbound-gateway&gt;</code> to perform <code class="literal">EntityManager.find(Class entityClass, Object primaryKey)</code>.
See <a class="xref" href="jpa.html#jpa-retrieving-outbound-gateway" title="22.7.5&nbsp;Retrieving Outbound Gateway">Section&nbsp;22.7.5, &#8220;Retrieving Outbound Gateway&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-tcp-deserializer-events" href="#x4.0-tcp-deserializer-events"></a>TCP Deserialization Events</h4></div></div></div>

<p>When one of the standard deserializers encounters a problem decoding the input stream to a message, it now emits a <code class="literal">TcpDeserializationExceptionEvent</code>, letting applications examine the data at the point at which the exception occurred.
See <a class="xref" href="ip.html#tcp-events" title="34.5&nbsp;TCP Connection Events">Section&nbsp;34.5, &#8220;TCP Connection Events&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-bean-messaging-annotations" href="#x4.0-bean-messaging-annotations"></a>Messaging Annotations on <code class="literal">@Bean</code> Definitions</h4></div></div></div>

<p>You can now configure messaging annotations (<code class="literal">@ServiceActivator</code>, <code class="literal">@Router</code>, <code class="literal">@InboundChannelAdapter</code>, and others) on <code class="literal">@Bean</code> definitions in <code class="literal">@Configuration</code> classes.
For more information, see <a class="xref" href="configuration.html#annotations" title="E.5&nbsp;Annotation Support">Section&nbsp;E.5, &#8220;Annotation Support&#8221;</a>.</p>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="migration-2.2-3.0" href="#migration-2.2-3.0"></a>I.12&nbsp;Changes Between 2.2 and 3.0</h2></div></div></div>

<p>See the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki/Spring-Integration-2.2-to-3.0-Migration-Guide" target="_top">Migration Guide</a> for important changes that might affect your applications.
You can find migration guides for all versions back to 2.1 on the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki" target="_top">wiki</a>.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x3.0-new-components" href="#x3.0-new-components"></a>I.12.1&nbsp;New Components</h3></div></div></div>

<p>Version 3.0 added a number of new components.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-request-mapping" href="#x3.0-request-mapping"></a>HTTP Request Mapping</h4></div></div></div>

<p>The HTTP module now provides powerful request mapping support for inbound endpoints.
We replaced the <code class="literal">UriPathHandlerMapping</code> class with <code class="literal">IntegrationRequestMappingHandlerMapping</code>, which is registered under the bean name of <code class="literal">integrationRequestMappingHandlerMapping</code> in the application context.
Upon parsing of the HTTP inbound endpoint, either a new <code class="literal">IntegrationRequestMappingHandlerMapping</code> bean is registered or an existing bean is reused.
To achieve flexible request mapping configuration, Spring Integration provides the <code class="literal">&lt;request-mapping/&gt;</code> child element for <code class="literal">&lt;http:inbound-channel-adapter/&gt;</code> and the <code class="literal">&lt;http:inbound-gateway/&gt;</code>.
Both HTTP inbound endpoints are now fully based on the request mapping infrastructure that was introduced with Spring MVC 3.1.
For example, multiple paths are supported on a single inbound endpoint.
For more information see <a class="xref" href="http.html#http-namespace" title="20.3&nbsp;HTTP Namespace Support">Section&nbsp;20.3, &#8220;HTTP Namespace Support&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-spel-customization" href="#x3.0-spel-customization"></a>Spring Expression Language (SpEL) Configuration</h4></div></div></div>

<p>We added a new <code class="literal">IntegrationEvaluationContextFactoryBean</code> to allow configuration of custom <code class="literal">PropertyAccessor</code> implementations and functions for use in SpEL expressions throughout the framework.
For more information, see <a class="xref" href="spel.html" title="Appendix&nbsp;A.&nbsp;Spring Expression Language (SpEL)">Appendix&nbsp;A, <i>Spring Expression Language (SpEL)</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-spel-functions" href="#x3.0-spel-functions"></a>SpEL Functions Support</h4></div></div></div>

<p>To customize the SpEL <code class="literal">EvaluationContext</code> with static <code class="literal">Method</code> functions, we introduced the <code class="literal">&lt;spel-function/&gt;</code> component.
We also added two built-in functions: <code class="literal">#jsonPath</code> and <code class="literal">#xpath</code>.
For more information, see <a class="xref" href="spel.html#spel-functions" title="A.2&nbsp;SpEL Functions">Section&nbsp;A.2, &#8220;SpEL Functions&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-spel-property-accessors" href="#x3.0-spel-property-accessors"></a>SpEL PropertyAccessors Support</h4></div></div></div>

<p>To customize the SpEL <code class="literal">EvaluationContext</code> with <code class="literal">PropertyAccessor</code> implementations, we added the <code class="literal">&lt;spel-property-accessors/&gt;</code> component.
For more information, see <a class="xref" href="spel.html#spel-property-accessors" title="A.3&nbsp;Property Accessors">Section&nbsp;A.3, &#8220;Property Accessors&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-redis-new-components" href="#x3.0-redis-new-components"></a>Redis: New Components</h4></div></div></div>

<p>We added a new Redis-based <a class="ulink" href="http://docs.spring.io/spring-integration/docs/latest-ga/api/org/springframework/integration/store/MetadataStore.html" target="_top"><code class="literal">MetadataStore</code></a> implementation.
You can use the <code class="literal">RedisMetadataStore</code> to maintain the state of a <code class="literal">MetadataStore</code> across application restarts.
This new <code class="literal">MetadataStore</code> implementation can be used with adapters, such as:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Twitter inbound adapters
</li><li class="listitem">
Feed inbound channel adapter
</li></ul></div>
<p>We added new queue-based components.
We added the <code class="literal">&lt;int-redis:queue-inbound-channel-adapter/&gt;</code> and <code class="literal">&lt;int-redis:queue-outbound-channel-adapter/&gt;</code> components to perform <span class="emphasis"><em>right pop</em></span> and <span class="emphasis"><em>left push</em></span> operations, respectively, on a Redis List.</p>
<p>For more information, "<code class="literal">see &lt;&lt;redis&gt;&gt;</code>".</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-hcr" href="#x3.0-hcr"></a>Header Channel Registry</h4></div></div></div>

<p>You can now instruct the framework to store reply channels and error channels in a registry for later resolution.
This is useful for cases where the <code class="literal">replyChannel</code> or <code class="literal">errorChannel</code> might be lost (for example, when serializing a message).
See <a class="xref" href="messaging-transformation-chapter.html#header-enricher" title="9.2.1&nbsp;Header Enricher">Section&nbsp;9.2.1, &#8220;Header Enricher&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-configurable-mongo-MS" href="#x3.0-configurable-mongo-MS"></a>MongoDB support: New <code class="literal">ConfigurableMongoDbMessageStore</code></h4></div></div></div>

<p>In addition to the existing <code class="literal">eMongoDbMessageStore</code>, we introduced a new <code class="literal">ConfigurableMongoDbMessageStore</code>.
This provides a more robust and flexible implementation of <code class="literal">MessageStore</code> for MongoDB.
It does not have backward compatibility with the existing store, but we recommend using it for new applications.
Existing applications can use it, but messages in the old store are not available.
See <a class="xref" href="mongodb.html" title="25.&nbsp;MongoDb Support">Chapter&nbsp;25, <i>MongoDb Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-syslog" href="#x3.0-syslog"></a>Syslog Support</h4></div></div></div>

<p>Building on the 2.2 <code class="literal">SyslogToMapTransformer</code>, Spring Integration 3.0 introduces <code class="literal">UDP</code> and <code class="literal">TCP</code> inbound channel adapters especially tailored for receiving SYSLOG messages.
For more information, see <a class="xref" href="syslog.html" title="33.&nbsp;Syslog Support">Chapter&nbsp;33, <i>Syslog Support</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-tail" href="#x3.0-tail"></a><code class="literal">tail</code> Support</h4></div></div></div>

<p>We added file inbound channel adapters that use the <code class="literal">tail</code> command to generate messages when lines are added to the end of text files.
See <a class="xref" href="files.html#file-tailing" title="17.1.8&nbsp;'tail&#8217;ing Files">Section&nbsp;17.1.8, &#8220;'tail&#8217;ing Files&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-jmx" href="#x3.0-jmx"></a>JMX Support</h4></div></div></div>

<p>We added <code class="literal">&lt;int-jmx:tree-polling-channel-adapter/&gt;</code>.
This adapter queries the JMX MBean tree and sends a message with a payload that is the graph of objects that match the query.
By default, the MBeans are mapped to primitives and simple Objects (such as <code class="literal">Map</code>, <code class="literal">List</code>, and arrays).
It permits simple transformation to, for example, JSON.</p>
<p>The <code class="literal">IntegrationMBeanExporter</code> now allows the configuration of a custom <code class="literal">ObjectNamingStrategy</code> by using the <code class="literal">naming-strategy</code> attribute.</p>
<p>For more information, see <a class="xref" href="system-management-chapter.html#jmx" title="12.2&nbsp;JMX Support">Section&nbsp;12.2, &#8220;JMX Support&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-tcp-events" href="#x3.0-tcp-events"></a>TCP/IP Connection Events and Connection Management</h4></div></div></div>

<p><code class="literal">TcpConnection</code> instances now emit <code class="literal">ApplicationEvent</code> instances (specifically <code class="literal">TcpConnectionEvent</code> instances) when connections are opened or closed or when an exception occurs.
This change lets applications be informed of changes to TCP connections by using the normal Spring <code class="literal">ApplicationListener</code> mechanism.</p>
<p>We renamed <code class="literal">AbstractTcpConnection</code> to <code class="literal">TcpConnectionSupport</code>.
Custom connections that are subclasses of this class can use its methods to publish events.
Similarly, we renamed <code class="literal">AbstractTcpConnectionInterceptor</code> to <code class="literal">TcpConnectionInterceptorSupport</code>.</p>
<p>In addition, we added <code class="literal">&lt;int-ip:tcp-connection-event-inbound-channel-adapter/&gt;</code>.
By default, this adapter sends all <code class="literal">TcpConnectionEvent</code> instances to a <code class="literal">Channel</code>.</p>
<p>Further, the TCP connection factories now provide a new method called <code class="literal">getOpenConnectionIds()</code>, which returns a list of identifiers for all open connections.
It lets applications broadcast to all open connections, among other uses.</p>
<p>Finally, the connection factories also provide a new method called <code class="literal">closeConnection(String connectionId)</code>, which lets applications explicitly close a connection by using its ID.</p>
<p>For more information see <a class="xref" href="ip.html#tcp-events" title="34.5&nbsp;TCP Connection Events">Section&nbsp;34.5, &#8220;TCP Connection Events&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-inbound-script" href="#x3.0-inbound-script"></a>Inbound Channel Adapter Script Support</h4></div></div></div>

<p>The <code class="literal">&lt;int:inbound-channel-adapter/&gt;</code> now supports using <code class="literal">&lt;expression/&gt;</code> and <code class="literal">&lt;script/&gt;</code> child elements to create a <code class="literal">MessageSource</code>.
See <a class="xref" href="messaging-channels-section.html#channel-adapter-expressions-and-scripts" title="6.3.3&nbsp;Channel Adapter Expressions and Scripts">Section&nbsp;6.3.3, &#8220;Channel Adapter Expressions and Scripts&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-content-enricher-headers" href="#x3.0-content-enricher-headers"></a>Content Enricher: Headers Enrichment Support</h4></div></div></div>

<p>The content enricher now provides configuration for <code class="literal">&lt;header/&gt;</code> child elements, to enrich the outbound message with headers based on the reply message from the underlying message flow.
For more information see <a class="xref" href="messaging-transformation-chapter.html#payload-enricher" title="9.2.2&nbsp;Payload Enricher">Section&nbsp;9.2.2, &#8220;Payload Enricher&#8221;</a>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x3.0-general" href="#x3.0-general"></a>I.12.2&nbsp;General Changes</h3></div></div></div>

<p>This section describes general changes from version 2.2 to version 3.0.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-message-id" href="#x3.0-message-id"></a>Message ID Generation</h4></div></div></div>

<p>Previously, message IDs were generated by using the JDK <code class="literal">UUID.randomUUID()</code> method.
With this release, the default mechanism has been changed to use a more efficient and significantly faster algorithm.
In addition, we added the ability to change the strategy used to generate message IDs.
For more information see <a class="xref" href="message.html#message-id-generation" title="7.2.2&nbsp;Message ID Generation">Section&nbsp;7.2.2, &#8220;Message ID Generation&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-gateway" href="#x3.0-gateway"></a>"<code class="literal">&lt;gateway&gt;</code>" Changes</h4></div></div></div>

<p>You can now set common headers across all gateway methods, and we added more options for adding information to the message about which method was invoked.</p>
<p>You can now entirely customize the way that gateway method calls are mapped to messages.</p>
<p>The <code class="literal">GatewayMethodMetadata</code> is now a public class.
It lets you programmatically configure the <code class="literal">GatewayProxyFactoryBean</code> from Java.</p>
<p>For more information, see <a class="xref" href="messaging-endpoints-chapter.html#gateway" title="10.4&nbsp;Messaging Gateways">Section&nbsp;10.4, &#8220;Messaging Gateways&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-http-endpointss" href="#x3.0-http-endpointss"></a>HTTP Endpoint Changes</h4></div></div></div>

<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<span class="strong"><strong>Outbound Endpoint <code class="literal">encode-uri</code></strong></span>: <code class="literal">&lt;http:outbound-gateway/&gt;</code> and <code class="literal">&lt;http:outbound-channel-adapter/&gt;</code> now provide an <code class="literal">encode-uri</code> attribute to allow disabling the encoding of the URI object before sending the request.
</li><li class="listitem">
<span class="strong"><strong>Inbound Endpoint <code class="literal">merge-with-default-converters</code></strong></span>: <code class="literal">&lt;http:inbound-gateway/&gt;</code> and <code class="literal">&lt;http:inbound-channel-adapter/&gt;</code> now have a <code class="literal">merge-with-default-converters</code> attribute to include the list of default <code class="literal">HttpMessageConverter</code> instances after the custom message converters.
</li><li class="listitem">
<span class="strong"><strong><code class="literal">If-Modified-Since</code> and <code class="literal">If-Unmodified-Since</code> HTTP Headers</strong></span>: Previously, the <code class="literal">If-Modified-Since</code> and <code class="literal">If-Unmodified-Since</code> HTTP headers were incorrectly processed within from and to HTTP headers mapped in the <code class="literal">DefaultHttpHeaderMapper</code>.
Now, in addition to correcting that issue, <code class="literal">DefaultHttpHeaderMapper</code> provides date parsing from formatted strings for any HTTP headers that accept date-time values.
</li><li class="listitem">
<span class="strong"><strong>Inbound Endpoint Expression Variables</strong></span>: In addition to the existing <code class="literal">#requestParams</code> and <code class="literal">#pathVariables</code>, the <code class="literal">&lt;http:inbound-gateway/&gt;</code> and <code class="literal">&lt;http:inbound-channel-adapter/&gt;</code> now support additional useful variables: <code class="literal">#matrixVariables</code>, <code class="literal">#requestAttributes</code>, <code class="literal">#requestHeaders</code>, and <code class="literal">#cookies</code>.
These variables are available in both payload and header expressions.
</li><li class="listitem">
<span class="strong"><strong>Outbound Endpoint <span class="emphasis"><em>uri-variables-expression</em></span></strong></span>: HTTP outbound endpoints now support the <code class="literal">uri-variables-expression</code> attribute to specify an <code class="literal">Expression</code> to evaluate a <code class="literal">Map</code> for all URI variable placeholders within URL template.
This allows selection of a different map of expressions based on the outgoing message.
</li></ul></div>
<p>For more information, see <a class="xref" href="http.html" title="20.&nbsp;HTTP Support">Chapter&nbsp;20, <i>HTTP Support</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-json-transformers" href="#x3.0-json-transformers"></a>Jackson Support (JSON)</h4></div></div></div>

<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
A new abstraction for JSON conversion has been introduced.
Implementations for Jackson 1.x and Jackson 2 are currently provided, with the version being determined by presence on the classpath.
Previously, only Jackson 1.x was supported.
</li><li class="listitem">
The <code class="literal">ObjectToJsonTransformer</code> and <code class="literal">JsonToObjectTransformer</code> now emit/consume headers containing type information.
</li></ul></div>
<p>For more information, see "<code class="literal">JSON Transformers</code>" in <a class="xref" href="messaging-transformation-chapter.html#transformer" title="9.1&nbsp;Transformer">Section&nbsp;9.1, &#8220;Transformer&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-id-for-chain-sub-components" href="#x3.0-id-for-chain-sub-components"></a>Chain Elements <code class="literal">id</code> Attribute</h4></div></div></div>

<p>Previously, the <code class="literal">id</code> attribute for elements within a <code class="literal">&lt;chain&gt;</code> was ignored and, in some cases, disallowed.
Now, the <code class="literal">id</code> attribute is allowed for all elements within a <code class="literal">&lt;chain&gt;</code>.
The bean names of chain elements is a combination of the surrounding chain&#8217;s <code class="literal">id</code> and the <code class="literal">id</code> of the element itself.
For example: <span class="emphasis"><em>myChain$child.myTransformer.handler</em></span>.
For more information see, <a class="xref" href="messaging-routing-chapter.html#chain" title="8.6&nbsp;Message Handler Chain">Section&nbsp;8.6, &#8220;Message Handler Chain&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-corr-endpoint-empty-groups" href="#x3.0-corr-endpoint-empty-groups"></a>Aggregator <span class="emphasis"><em>empty-group-min-timeout</em></span> property</h4></div></div></div>

<p>The <code class="literal">AbstractCorrelatingMessageHandler</code> provides a new property called <code class="literal">empty-group-min-timeout</code> to allow empty group expiry to run on a longer schedule than expiring partial groups.
Empty groups are not removed from the <code class="literal">MessageStore</code> until they have not been modified for at least this number of milliseconds.
For more information, see <a class="xref" href="">???</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-filelistfilter" href="#x3.0-filelistfilter"></a>Persistent File List Filters (file, (S)FTP)</h4></div></div></div>

<p>New <code class="literal">FileListFilter</code> implementations that use a persistent <code class="literal">MetadataStore</code> are now available.
You can use these to prevent duplicate files after a system restart.
See <a class="xref" href="files.html#file-reading" title="17.1&nbsp;Reading Files">Section&nbsp;17.1, &#8220;Reading Files&#8221;</a>, <a class="xref" href="ftp.html#ftp-inbound" title="18.4&nbsp;FTP Inbound Channel Adapter">Section&nbsp;18.4, &#8220;FTP Inbound Channel Adapter&#8221;</a>, and <a class="xref" href="sftp.html#sftp-inbound" title="30.6&nbsp;SFTP Inbound Channel Adapter">Section&nbsp;30.6, &#8220;SFTP Inbound Channel Adapter&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-scripting-variables" href="#x3.0-scripting-variables"></a>Scripting Support: Variables Changes</h4></div></div></div>

<p>We introduced a new <code class="literal">variables</code> attribute for scripting components.
In addition, variable bindings are now allowed for inline scripts.
See <a class="xref" href="messaging-endpoints-chapter.html#groovy" title="10.8&nbsp;Groovy support">Section&nbsp;10.8, &#8220;Groovy support&#8221;</a> and <a class="xref" href="messaging-endpoints-chapter.html#scripting" title="10.7&nbsp;Scripting Support">Section&nbsp;10.7, &#8220;Scripting Support&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-direct-channel-lb-ref" href="#x3.0-direct-channel-lb-ref"></a>Direct Channel Load Balancing configuration</h4></div></div></div>

<p>Previously, when configuring <code class="literal">LoadBalancingStrategy</code> on the channel&#8217;s <code class="literal">dispatcher</code> child element, the only available option was to use a pre-defined enumeration of values which did not let developers set a custom implementation of the <code class="literal">LoadBalancingStrategy</code>.
You can now use <code class="literal">load-balancer-ref</code> to provide a reference to a custom implementation of the <code class="literal">LoadBalancingStrategy</code>.
For more information, see <a class="xref" href="messaging-channels-section.html#channel-implementations-directchannel" title="DirectChannel">the section called &#8220;<code class="literal">DirectChannel</code>&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-pub-sub" href="#x3.0-pub-sub"></a>PublishSubscribeChannel Behavior</h4></div></div></div>

<p>Previously, sending to a &lt;publish-subscribe-channel/&gt; that had no subscribers would return a <code class="literal">false</code> result.
If used in conjunction with a <code class="literal">MessagingTemplate</code>, this would result in an exception being thrown.
Now, the <code class="literal">PublishSubscribeChannel</code> has a property called <code class="literal">minSubscribers</code> (default: <code class="literal">0</code>).
If the message is sent to at least the minimum number of subscribers, the send operation is deemed to be successful (even if the number is zero).
If an application expects to get an exception under these conditions, set the minimum subscribers to at least 1.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0--s-ftp-changes" href="#x3.0--s-ftp-changes"></a>FTP, SFTP and FTPS Changes</h4></div></div></div>

<p>The FTP, SFTP and FTPS endpoints no longer cache sessions by default.</p>
<p>We removed the deprecated <code class="literal">cached-sessions</code> attribute from all endpoints.
Previously, the embedded caching mechanism controlled by this attribute&#8217;s value did not provide a way to limit the size of the cache, which could grow indefinitely.
Release 2.1 introduced <code class="literal">CachingConnectionFactory</code>, and it became the preferred (and is now the only) way to cache sessions.</p>
<p><code class="literal">CachingConnectionFactory</code> now provides a new method: <code class="literal">resetCache()</code>.
This method immediately closes idle sessions and causes in-use sessions to be closed as and when they are returned to the cache.</p>
<p>The <code class="literal">DefaultSftpSessionFactory</code> (in conjunction with a <code class="literal">CachingSessionFactory</code>) now supports multiplexing channels over a single SSH connection (SFTP Only).</p>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_ftp_sftp_and_ftps_inbound_adapters" href="#_ftp_sftp_and_ftps_inbound_adapters"></a>FTP, SFTP and FTPS Inbound Adapters</h5></div></div></div>

<p>Previously, there was no way to override the default filter used to process files retrieved from a remote server.
The <code class="literal">filter</code> attribute determines which files are retrieved, but the <code class="literal">FileReadingMessageSource</code> uses an <code class="literal">AcceptOnceFileListFilter</code>.
This means that, if a new copy of a file is retrieved with the same name as a previously copied file, no message was sent from the adapter.</p>
<p>With this release, a new attribute <code class="literal">local-filter</code> lets you override the default filter (for example, with an <code class="literal">AcceptAllFileListFilter</code> or some other custom filter).</p>
<p>If you want the behavior of the <code class="literal">AcceptOnceFileListFilter</code> to be maintained across JVM executions, you can now configure a custom filter that retains state, perhaps on the file system.</p>
<p>Inbound channel adapters now support the <code class="literal">preserve-timestamp</code> attribute, which sets the local file modified timestamp to the timestamp from the server (default: <code class="literal">false</code>).</p>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_ftp_sftp_and_ftps_gateways" href="#_ftp_sftp_and_ftps_gateways"></a>FTP, SFTP, and FTPS Gateways</h5></div></div></div>

<p>The gateways now support the <code class="literal">mv</code> command, enabling the renaming of remote files.</p>
<p>The gateways now support recursive <code class="literal">ls</code> and <code class="literal">mget</code> commands, enabling the retrieval of a remote file tree.</p>
<p>The gateways now support <code class="literal">put</code> and <code class="literal">mput</code> commands, enabling sending files to the remote server.</p>
<p>The <code class="literal">local-filename-generator-expression</code> attribute is now supported, enabling the naming of local files during retrieval.
By default, the same name as the remote file is used.</p>
<p>The <code class="literal">local-directory-expression</code> attribute is now supported, enabling the naming of local directories during retrieval (based on the remote directory).</p>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_remote_file_template" href="#_remote_file_template"></a>Remote File Template</h5></div></div></div>

<p>A new higher-level abstraction (<code class="literal">RemoteFileTemplate</code>) is provided over the <code class="literal">Session</code> implementations used by the FTP and SFTP modules.
While it is used internally by endpoints, you can also use this abstraction programmatically.
Like all Spring <code class="literal">*Template</code> implementations, it reliably closes the underlying session while allowing low level access to the session.</p>
<p>For more information, see <a class="xref" href="ftp.html" title="18.&nbsp;FTP/FTPS Adapters">Chapter&nbsp;18, <i>FTP/FTPS Adapters</i></a> and <a class="xref" href="sftp.html" title="30.&nbsp;SFTP Adapters">Chapter&nbsp;30, <i>SFTP Adapters</i></a>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-outbound-gateway-requires-reply" href="#x3.0-outbound-gateway-requires-reply"></a><span class="emphasis"><em>requires-reply</em></span> Attribute for Outbound Gateways</h4></div></div></div>

<p>All outbound gateways (such as <code class="literal">&lt;jdbc:outbound-gateway/&gt;</code> or <code class="literal">&lt;jms:outbound-gateway/&gt;</code>) are designed for <span class="emphasis"><em>request-reply</em></span> scenarios.
A response is expected from the external service and is published to the <code class="literal">reply-channel</code> or the <code class="literal">replyChannel</code> message header.
However, there are some cases where the external system might not always return a result (for example,
a <code class="literal">&lt;jdbc:outbound-gateway/&gt;</code> when a SELECT ends with an empty <code class="literal">ResultSet</code> or perhaps a one-way web service).
Consequently, developers needed an option to configure whether or not a reply is required.
For this purpose, we introduced the <code class="literal">requires-reply</code> attribute for outbound gateway components.
In most cases, the default value for <code class="literal">requires-reply</code> is <code class="literal">true</code>.
If there is no result, a <code class="literal">ReplyRequiredException</code> is thrown.
Changing the value to <code class="literal">false</code> means that, if an external service does not return anything, the message flow ends at that point, similar to an outbound channel adapter.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The WebService outbound gateway has an additional attribute called <code class="literal">ignore-empty-responses</code>.
It is used to treat an empty <code class="literal">String</code> response as if no response were received.
By default, it is <code class="literal">true</code>, but you can set it to <code class="literal">false</code> to allow the application to receive an empty <code class="literal">String</code> in the reply message payload.
When the attribute is <code class="literal">true</code>, an empty string is treated as no response for the purposes of the <code class="literal">requires-reply</code> attribute.
By default, <code class="literal">requires-reply</code> is false for the WebService outbound gateway.</p>
</td></tr></table></div>
<p>Note that the <code class="literal">requiresReply</code> property was previously present but set to <code class="literal">false</code> in the <code class="literal">AbstractReplyProducingMessageHandler</code>, and there was no way to configure it on outbound gateways by using the XML namespace.</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top">
<p>Previously, a gateway receiving no reply would silently end the flow (with a DEBUG log message).
By default, with this change, an exception is now thrown by most gateways.
To revert to the previous behavior, set <code class="literal">requires-reply</code> to <code class="literal">false</code>.</p>
</td></tr></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-amqp-mapping" href="#x3.0-amqp-mapping"></a>AMQP Outbound Gateway Header Mapping</h4></div></div></div>

<p>Previously, the &lt;int-amqp:outbound-gateway/&gt; mapped headers before invoking the message converter, and the converter could overwrite headers such as <code class="literal">content-type</code>.
The outbound adapter maps the headers after the conversion, which means headers like <code class="literal">content-type</code> from the outbound <code class="literal">Message</code> (if present) are used.</p>
<p>Starting with this release, the gateway now maps the headers after the message conversion, consistent with the adapter.
If your application relies on the previous behavior (where the converter&#8217;s headers overrode the mapped headers), you either need to filter those headers (before the message reaches the gateway) or set them appropriately.
The headers affected by the <code class="literal">SimpleMessageConverter</code> are <code class="literal">content-type</code> and <code class="literal">content-encoding</code>.
Custom message converters may set other headers.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-stored-proc-sql-return-type" href="#x3.0-stored-proc-sql-return-type"></a>Stored Procedure Components Improvements</h4></div></div></div>

<p>For more complex database-specific types not supported by the standard <code class="literal">CallableStatement.getObject</code> method, we introduced two new additional attributes to the <code class="literal">&lt;sql-parameter-definition/&gt;</code> element with OUT-direction:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">type-name</code>
</li><li class="listitem">
<code class="literal">return-type</code>
</li></ul></div>
<p>The <code class="literal">row-mapper</code> attribute of the stored procedure inbound channel adapter <code class="literal">&lt;returning-resultset/&gt;</code> child element now supports a reference to a <code class="literal">RowMapper</code> bean definition.
Previously, it contained only a class name (which is still supported).</p>
<p>For more information, see <a class="xref" href="jdbc.html#stored-procedures" title="21.5&nbsp;Stored Procedures">Section&nbsp;21.5, &#8220;Stored Procedures&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-ws-outbound-uri-substitution" href="#x3.0-ws-outbound-uri-substitution"></a>Web Service Outbound URI Configuration</h4></div></div></div>

<p>The web service outbound gateway <span class="emphasis"><em>uri</em></span> attribute now supports <code class="literal">&lt;uri-variable/&gt;</code> substitution for all URI schemes supported by Spring Web Services.
For more information, see <a class="xref" href="ws.html#outbound-uri" title="37.4&nbsp;Outbound URI Configuration">Section&nbsp;37.4, &#8220;Outbound URI Configuration&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-redis" href="#x3.0-redis"></a>Redis Adapter Changes</h4></div></div></div>

<p>The Redis inbound channel adapter can now use a <code class="literal">null</code> value for the <code class="literal">serializer</code> property, with the raw data being the message payload.</p>
<p>The Redis outbound channel adapter now has the <code class="literal">topic-expression</code> property to determine the Redis topic for the <code class="literal">Message</code> at runtime.</p>
<p>The Redis inbound channel adapter, in addition to the existing <code class="literal">topics</code> attribute, now has the <code class="literal">topic-patterns</code> attribute.</p>
<p>For more information, see <a class="xref" href="redis.html" title="27.&nbsp;Redis Support">Chapter&nbsp;27, <i>Redis Support</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-advising-filters" href="#x3.0-advising-filters"></a>Advising Filters</h4></div></div></div>

<p>Previously, when a <code class="literal">&lt;filter/&gt;</code> had a <code class="literal">&lt;request-handler-advice-chain/&gt;</code>, the discard action was all performed within the scope of the advice chain (including any downstream flow on the <code class="literal">discard-channel</code>).
The filter element now has an attribute called <code class="literal">discard-within-advice</code> (default: <code class="literal">true</code>) to allow the discard action to be performed after the advice chain completes.
See <a class="xref" href="messaging-endpoints-chapter.html#advising-filters" title="10.9.6&nbsp;Advising Filters">Section&nbsp;10.9.6, &#8220;Advising Filters&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-annotation-advice" href="#x3.0-annotation-advice"></a>Advising Endpoints using Annotations</h4></div></div></div>

<p>Request handler advice chains can now be configured using annotations.
See <a class="xref" href="messaging-endpoints-chapter.html#advising-with-annotations" title="10.9.7&nbsp;Advising Endpoints Using Annotations">Section&nbsp;10.9.7, &#8220;Advising Endpoints Using Annotations&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-o-t-s-t" href="#x3.0-o-t-s-t"></a>ObjectToStringTransformer Improvements</h4></div></div></div>

<p>This transformer now correctly transforms <code class="literal">byte[]</code> and <code class="literal">char[]</code> payloads to <code class="literal">String</code>.
For more information, see <a class="xref" href="messaging-transformation-chapter.html#transformer" title="9.1&nbsp;Transformer">Section&nbsp;9.1, &#8220;Transformer&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-jpa-changes" href="#x3.0-jpa-changes"></a>JPA Support Changes</h4></div></div></div>

<p>Payloads to persist or merge can now be of type <code class="literal">http://docs.oracle.com/javase/7/docs/api/java/lang/Iterable.html[java.lang.Iterable]</code>.</p>
<p>In that case, each object returned by the <code class="literal">Iterable</code> is treated as an entity and persisted or merged by using the underlying <code class="literal">EntityManager</code>.
Null values returned by the iterator are ignored.</p>
<p>The JPA adapters now have additional attributes to optionally flush and clear entities from the associated persistence context after performing persistence operations.</p>
<p>Retrieving gateways had no mechanism to specify the first record to be retrieved, which is a common use case.
The retrieving gateways now support specifying this parameter by adding the <code class="literal">first-result</code> and <code class="literal">first-result-expression</code> attributes to the gateway definition.
For more information, see <a class="xref" href="jpa.html#jpa-retrieving-outbound-gateway" title="22.7.5&nbsp;Retrieving Outbound Gateway">Section&nbsp;22.7.5, &#8220;Retrieving Outbound Gateway&#8221;</a>.</p>
<p>The JPA retrieving gateway and inbound adapter now have an attribute to specify the maximum number of results in a result set as an expression.
In addition, we introduced the <code class="literal">max-results</code> attribute to replace <code class="literal">max-number-of-results</code>, which has been deprecated.
<code class="literal">max-results</code> and <code class="literal">max-results-expression</code> are used to provide the maximum number of results or an expression to compute the maximum number of results, respectively, in the result set.</p>
<p>For more information, see <a class="xref" href="jpa.html" title="22.&nbsp;JPA Support">Chapter&nbsp;22, <i>JPA Support</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-dalay-expression" href="#x3.0-dalay-expression"></a>Delayer: delay expression</h4></div></div></div>

<p>Previously, the <code class="literal">&lt;delayer&gt;</code> provided a <code class="literal">delay-header-name</code> attribute to determine the delay value at runtime.
In complex cases, the <code class="literal">&lt;delayer&gt;</code> had to be preceded with a <code class="literal">&lt;header-enricher&gt;</code>.
Spring Integration 3.0 introduced the <code class="literal">expression</code> attribute and <code class="literal">expression</code> child element for dynamic delay determination.
The <code class="literal">delay-header-name</code> attribute is now deprecated, because you can specify the header evaluation in the <code class="literal">expression</code>.
In addition, we introduced the <code class="literal">ignore-expression-failures</code> to control the behavior when an expression evaluation fails.
For more information, see <a class="xref" href="messaging-endpoints-chapter.html#delayer" title="10.6&nbsp;Delayer">Section&nbsp;10.6, &#8220;Delayer&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-jdbc-mysql-v5_6_4" href="#x3.0-jdbc-mysql-v5_6_4"></a>JDBC Message Store Improvements</h4></div></div></div>

<p>Spring Integration 3.0 adds a new set of DDL scripts for MySQL version 5.6.4 and higher.
Now MySQL supports fractional seconds and is thus improving the FIFO ordering when polling from a MySQL-based message store.
For more information, see <a class="xref" href="jdbc.html#jdbc-message-store-generic" title="21.4.2&nbsp;The Generic JDBC Message Store">Section&nbsp;21.4.2, &#8220;The Generic JDBC Message Store&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-event-for-imap-idle" href="#x3.0-event-for-imap-idle"></a>IMAP Idle Connection Exceptions</h4></div></div></div>

<p>Previously, if an IMAP idle connection failed, it was logged, but there was no mechanism to inform an application.
Such exceptions now generate <code class="literal">ApplicationEvent</code> instances.
Applications can obtain these events by using an <code class="literal">&lt;int-event:inbound-channel-adapter&gt;</code> or any <code class="literal">ApplicationListener</code> configured to receive an <code class="literal">ImapIdleExceptionEvent</code> (or one of its super classes).</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-tcp-headers" href="#x3.0-tcp-headers"></a>Message Headers and TCP</h4></div></div></div>

<p>The TCP connection factories now enable the configuration of a flexible mechanism to transfer selected headers (as well as the payload) over TCP.
A new <code class="literal">TcpMessageMapper</code> enables the selection of the headers, and you need to configure an appropriate serializer or deserializer to write the resulting <code class="literal">Map</code> to the TCP stream.
We added a <code class="literal">MapJsonSerializer</code> as a convenient mechanism to transfer headers and payload over TCP.
For more information, see <a class="xref" href="ip.html#ip-headers" title="34.8.3&nbsp;Transferring Headers">Section&nbsp;34.8.3, &#8220;Transferring Headers&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-jms-mdca-te" href="#x3.0-jms-mdca-te"></a>JMS Message Driven Channel Adapter</h4></div></div></div>

<p>Previously, when configuring a <code class="literal">&lt;message-driven-channel-adapter/&gt;</code>, if you wished to use a specific <code class="literal">TaskExecutor</code>, you had to declare a container bean and provide it to the adapter by setting the <code class="literal">container</code> attribute.
We added the <code class="literal">task-executor</code>, letting it be set directly on the adapter.
This is in addition to several other container attributes that were already available.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-rmi-ec" href="#x3.0-rmi-ec"></a>RMI Inbound Gateway</h4></div></div></div>

<p>The RMI Inbound Gateway now supports an <code class="literal">error-channel</code> attribute.
See <a class="xref" href="rmi.html#rmi-inbound" title="29.2&nbsp;Inbound RMI">Section&nbsp;29.2, &#8220;Inbound RMI&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-xslt-transformer" href="#x3.0-xslt-transformer"></a><code class="literal">XsltPayloadTransformer</code></h4></div></div></div>

<p>You can now specify the transformer factory class name by setting the <code class="literal">transformer-factory-class</code> attribute.
See <code class="literal">&lt;&lt;xml-xslt-payload-transformers&gt;&gt;</code>.</p>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="migration-2.1-2.2" href="#migration-2.1-2.2"></a>I.13&nbsp;Changes between 2.1 and 2.2</h2></div></div></div>

<p>See the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki/Spring-Integration-2.1-to-2.2-Migration-Guide" target="_top">Migration Guide</a> for important changes that might affect your applications.
You can find migration guides for all versions back to 2.1 on the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki" target="_top">wiki</a>.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x2.2-new-components" href="#x2.2-new-components"></a>I.13.1&nbsp;New Components</h3></div></div></div>

<p>Version 2.2 added a number of new components.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-redis-store-adapters" href="#x2.2-redis-store-adapters"></a><code class="literal">RedisStore</code> Inbound and Outbound Channel Adapters</h4></div></div></div>

<p>Spring Integration now has <code class="literal">RedisStore</code> Inbound and Outbound Channel Adapters, letting you write and read <code class="literal">Message</code> payloads to and from Redis collections.
For more information, see <a class="xref" href="redis.html#redis-store-outbound-channel-adapter" title="27.6&nbsp;RedisStore Outbound Channel Adapter">Section&nbsp;27.6, &#8220;RedisStore Outbound Channel Adapter&#8221;</a> and <a class="xref" href="redis.html#redis-store-inbound-channel-adapter" title="27.5&nbsp;Redis Store Inbound Channel Adapter">Section&nbsp;27.5, &#8220;Redis Store Inbound Channel Adapter&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-mongo-adapters" href="#x2.2-mongo-adapters"></a>MongoDB Inbound and Outbound Channel Adapters</h4></div></div></div>

<p>Spring Integration now has MongoDB inbound and outbound channel adapters, letting you write and read <code class="literal">Message</code> payloads to and from a MongoDB document store.
For more information, see <a class="xref" href="mongodb.html#mongodb-outbound-channel-adapter" title="25.4&nbsp;MongoDB Outbound Channel Adapter">Section&nbsp;25.4, &#8220;MongoDB Outbound Channel Adapter&#8221;</a> and <a class="xref" href="mongodb.html#mongodb-inbound-channel-adapter" title="25.3&nbsp;MongoDB Inbound Channel Adapter">Section&nbsp;25.3, &#8220;MongoDB Inbound Channel Adapter&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-jpa" href="#x2.2-jpa"></a>JPA Endpoints</h4></div></div></div>

<p>Spring Integration now includes components for the Java Persistence API (JPA) for retrieving and persisting JPA entity objects.
The JPA Adapter includes the following components:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="link" href="jpa.html#jpa-inbound-channel-adapter" title="22.5&nbsp;Inbound Channel Adapter">Inbound channel adapter</a>
</li><li class="listitem">
<a class="link" href="jpa.html#jpa-outbound-channel-adapter" title="22.6&nbsp;Outbound Channel Adapter">Outbound channel adapter</a>
</li><li class="listitem">
<a class="link" href="jpa.html#jpa-updating-outbound-gateway" title="22.7.2&nbsp;Updating Outbound Gateway">Updating outbound gateway</a>
</li><li class="listitem">
<a class="link" href="jpa.html#jpa-retrieving-outbound-gateway" title="22.7.5&nbsp;Retrieving Outbound Gateway">Retrieving outbound gateway</a>
</li></ul></div>
<p>For more information, see <a class="xref" href="jpa.html" title="22.&nbsp;JPA Support">Chapter&nbsp;22, <i>JPA Support</i></a>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x2.2-general" href="#x2.2-general"></a>I.13.2&nbsp;General Changes</h3></div></div></div>

<p>This section describes general changes from version 2.1 to version 2.2.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-spring-31" href="#x2.2-spring-31"></a>Spring 3.1 Used by Default</h4></div></div></div>

<p>Spring Integration now uses Spring 3.1.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-handler-advice" href="#x2.2-handler-advice"></a>Adding Behavior to Endpoints</h4></div></div></div>

<p>The ability to add an <code class="literal">&lt;advice-chain/&gt;</code> to a poller has been available for some time.
However, the behavior added by this affects the entire integration flow.
It did not address the ability to add (for example) retry to an individual endpoint.
The 2.2. release introduced the <code class="literal">&lt;request-handler-advice-chain/&gt;</code> to many endpoints.</p>
<p>In addition, we added three standard advice classes for this purpose:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">MessageHandlerRetryAdvice</code>
</li><li class="listitem">
<code class="literal">MessageHandlerCircuitBreakerAdvice</code>
</li><li class="listitem">
<code class="literal">ExpressionEvaluatingMessageHandlerAdvice</code>
</li></ul></div>
<p>For more information, see <a class="xref" href="messaging-endpoints-chapter.html#message-handler-advice-chain" title="10.9&nbsp;Adding Behavior to Endpoints">Section&nbsp;10.9, &#8220;Adding Behavior to Endpoints&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-transaction-sync" href="#x2.2-transaction-sync"></a>Transaction Synchronization and Pseudo Transactions</h4></div></div></div>

<p>Pollers can now participate in Spring&#8217;s Transaction Synchronization feature.
This allows for synchronizing such operations as renaming files by an inbound channel adapter, depending on whether the transaction commits or rolls back.</p>
<p>In addition, you can enable these features when no "<code class="literal">real</code>" transaction is present, by means of a <code class="literal">PseudoTransactionManager</code>.</p>
<p>For more information, see <a class="xref" href="transactions.html#transaction-synchronization" title="C.3&nbsp;Transaction Synchronization">Section&nbsp;C.3, &#8220;Transaction Synchronization&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-file-adapter" href="#x2.2-file-adapter"></a>File Adapter: Improved File Overwrite and Append Handling</h4></div></div></div>

<p>When using the file outbound channel adapter or the file outbound gateway, you can use a new <code class="literal">mode</code> property.
Prior to Spring Integration 2.2, target files were replaced when they existed.
Now you can specify the following options:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">REPLACE</code> (default)
</li><li class="listitem">
<code class="literal">APPEND</code>
</li><li class="listitem">
<code class="literal">FAIL</code>
</li><li class="listitem">
<code class="literal">IGNORE</code>
</li></ul></div>
<p>For more information, see <a class="xref" href="files.html#file-writing-destination-exists" title="17.2.3&nbsp;Dealing with Existing Destination Files">Section&nbsp;17.2.3, &#8220;Dealing with Existing Destination Files&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-outbound-gateways" href="#x2.2-outbound-gateways"></a>Reply-Timeout Added to More Outbound Gateways</h4></div></div></div>

<p>The XML Namespace support adds the reply-timeout attribute to the following outbound gateways:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
AMQP Outbound Gateway
</li><li class="listitem">
File Outbound Gateway
</li><li class="listitem">
FTP Outbound Gateway
</li><li class="listitem">
SFTP Outbound Gateway
</li><li class="listitem">
WS Outbound Gateway
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-amqp-11" href="#x2.2-amqp-11"></a>Spring-AMQP 1.1</h4></div></div></div>

<p>Spring Integration now uses Spring AMQP 1.1.
This enables several features to be used within a Spring Integration application, including the following:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
A fixed reply queue for the outbound gateway
</li><li class="listitem">
HA (mirrored) queues
</li><li class="listitem">
Publisher confirmations
</li><li class="listitem">
Returned messages
</li><li class="listitem">
Support for dead letter exchanges and dead letter queues
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-jdbc-11" href="#x2.2-jdbc-11"></a>JDBC Support - Stored Procedures Components</h4></div></div></div>

<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_spel_support_2" href="#_spel_support_2"></a>SpEL Support</h5></div></div></div>

<p>When using the stored procedure components of the Spring Integration JDBC Adapter, you can now provide stored procedure names or stored function names by using the Spring Expression Language (SpEL).</p>
<p>Doing so lets you specify the stored procedures to be invoked at runtime.
For example, you can provide stored procedure names that you would like to execute through message headers.
For more information, see <a class="xref" href="jdbc.html#stored-procedures" title="21.5&nbsp;Stored Procedures">Section&nbsp;21.5, &#8220;Stored Procedures&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_jmx_support" href="#_jmx_support"></a>JMX Support</h5></div></div></div>

<p>The stored procedure components now provide basic JMX support, exposing some of their properties as MBeans:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Stored procedure name
</li><li class="listitem">
Stored procedure name expression
</li><li class="listitem">
<code class="literal">JdbcCallOperations</code> cache statistics
</li></ul></div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-jdbc-gateway-update-optional" href="#x2.2-jdbc-gateway-update-optional"></a>JDBC Support: Outbound Gateway</h4></div></div></div>

<p>When you use the JDBC outbound gateway, the update query is no longer mandatory.
You can now provide only a select query by using the request message as a source of parameters.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-jdbc-message-store-channels" href="#x2.2-jdbc-message-store-channels"></a>JDBC Support: Channel-specific Message Store Implementation</h4></div></div></div>

<p>We added a new message channel-specific message store implementation, providing a more scalable solution using database-specific SQL queries.
For more information, see <a class="xref" href="jdbc.html#jdbc-message-store-channels" title="21.4.3&nbsp;Backing Message Channels">Section&nbsp;21.4.3, &#8220;Backing Message Channels&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-shutdown" href="#x2.2-shutdown"></a>Orderly Shutdown</h4></div></div></div>

<p>We added a method called <code class="literal">stopActiveComponents()</code> to the <code class="literal">IntegrationMBeanExporter</code>.
It allows a Spring Integration application to be shut down in an orderly manner, disallowing new inbound messages to certain adapters and waiting for some time to allow in-flight messages to complete.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-jms-og" href="#x2.2-jms-og"></a>JMS Outbound Gateway Improvements</h4></div></div></div>

<p>You can now configure the JMS outbound gateway to use a <code class="literal">MessageListener</code> container to receive replies.
Doing so can improve performance of the gateway.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-o-t-j-t" href="#x2.2-o-t-j-t"></a><code class="literal">ObjectToJsonTransformer</code></h4></div></div></div>

<p>By default, the <code class="literal">ObjectToJsonTransformer</code> now sets the <code class="literal">content-type</code> header to <code class="literal">application/json</code>.
For more information, see <a class="xref" href="messaging-transformation-chapter.html#transformer" title="9.1&nbsp;Transformer">Section&nbsp;9.1, &#8220;Transformer&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="httpChanges" href="#httpChanges"></a>HTTP Support</h4></div></div></div>

<p>Java serialization over HTTP is no longer enabled by default.
Previously, when setting an <code class="literal">expected-response-type</code> on a <code class="literal">Serializable</code> object, the <code class="literal">Accept</code> header was not properly set up.
We updated the <code class="literal">SerializingHttpMessageConverter</code> to set the <code class="literal">Accept</code> header to <code class="literal">application/x-java-serialized-object</code>.
However, because this could cause incompatibility with existing applications, we decided to no longer automatically add this converter to the HTTP endpoints.</p>
<p>If you wish to use Java serialization, you need to add the <code class="literal">SerializingHttpMessageConverter</code> to the appropriate endpoints by using the <code class="literal">message-converters</code> attribute (when you use XML configuration) or by using the <code class="literal">setMessageConverters()</code> method (in Java).</p>
<p>Alternatively, you may wish to consider using JSON instead.
It is enabled by having <code class="literal">Jackson</code> on the classpath.</p>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="migration-2.0-2.1" href="#migration-2.0-2.1"></a>I.14&nbsp;Changes between 2.0 and 2.1</h2></div></div></div>

<p>See the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki/Spring-Integration-2.0-to-2.1-Migration-Guide" target="_top">Migration Guide</a> for important changes that might affect your applications.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x2.1-new-components" href="#x2.1-new-components"></a>I.14.1&nbsp;New Components</h3></div></div></div>

<p>Version 2.1 added a number of new components.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-scripting-support" href="#x2.1-new-scripting-support"></a>JSR-223 Scripting Support</h4></div></div></div>

<p>In Spring Integration 2.0, we added support for <a class="ulink" href="http://groovy.codehaus.org/" target="_top">Groovy</a>.
With Spring Integration 2.1, we expanded support for additional languages substantially by implementing support for <a class="ulink" href="http://www.jcp.org/en/jsr/detail?id=223" target="_top">JSR-223</a> ("<code class="literal">Scripting for the Java&#8482; Platform</code>").
Now you have the ability to use any scripting language that supports JSR-223 including:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Javascript
</li><li class="listitem">
Ruby and JRuby
</li><li class="listitem">
Python and Jython
</li><li class="listitem">
Groovy
</li></ul></div>
<p>For further details, see <a class="xref" href="messaging-endpoints-chapter.html#scripting" title="10.7&nbsp;Scripting Support">Section&nbsp;10.7, &#8220;Scripting Support&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-gemfire-support" href="#x2.1-new-gemfire-support"></a>GemFire Support</h4></div></div></div>

<p>Spring Integration provides support for <a class="ulink" href="http://www.vmware.com/products/application-platform/vfabric-gemfire/overview.html" target="_top">GemFire</a> by providing inbound adapters for entry and continuous query events, an outbound adapter to write entries to the cache, and <a class="ulink" href="http://static.springsource.org/spring-integration/api/org/springframework/integration/store/MessageStore.html" target="_top"><code class="literal">MessageStore</code></a> and <a class="ulink" href="http://static.springsource.org/spring-integration/api/org/springframework/integration/store/MessageGroupStore.html" target="_top"><code class="literal">MessageGroupStore</code></a> implementations.
Spring integration leverages the <a class="ulink" href="http://www.springsource.org/spring-gemfire" target="_top">Spring Gemfire</a> project, providing a thin wrapper over its components.</p>
<p>For further details, see <a class="xref" href="gemfire.html" title="19.&nbsp;Pivotal GemFire and Apache Geode Support">Chapter&nbsp;19, <i>Pivotal GemFire and Apache Geode Support</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-amqp-support" href="#x2.1-new-amqp-support"></a>AMQP Support</h4></div></div></div>

<p>Spring Integration 2.1 added several channel adapters for receiving and sending messages by using the <a class="ulink" href="http://www.amqp.org/" target="_top">Advanced Message Queuing Protocol</a> (AMQP).
Furthermore, Spring Integration also provides a point-to-point message channel and a publish-subscribe message channel, both of which are backed by AMQP Exchanges and Queues.</p>
<p>For further details, see <a class="xref" href="amqp.html" title="14.&nbsp;AMQP Support">Chapter&nbsp;14, <i>AMQP Support</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-mongodb-support" href="#x2.1-new-mongodb-support"></a>MongoDB Support</h4></div></div></div>

<p>As of version 2.1, Spring Integration provides support for <a class="ulink" href="http://www.mongodb.org/" target="_top">MongoDB</a> by providing a MongoDB-based <code class="literal">MessageStore</code>.</p>
<p>For further details, see <a class="xref" href="mongodb.html" title="25.&nbsp;MongoDb Support">Chapter&nbsp;25, <i>MongoDb Support</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-redis-support" href="#x2.1-new-redis-support"></a>Redis Support</h4></div></div></div>

<p>As of version 2.1, Spring Integration supports <a class="ulink" href="http://redis.io/" target="_top">Redis</a>, an advanced key-value store, by providing a Redis-based <code class="literal">MessageStore</code> as well as publish-subscribe messaging adapters.</p>
<p>For further details, see <a class="xref" href="redis.html" title="27.&nbsp;Redis Support">Chapter&nbsp;27, <i>Redis Support</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-resource-support" href="#x2.1-new-resource-support"></a>Support for Spring&#8217;s Resource abstraction</h4></div></div></div>

<p>In version 2.1, we introduced a new resource inbound channel adapter that builds upon Spring&#8217;s resource abstraction to support greater flexibility across a variety of actual types of underlying resources, such as a file, a URL, or a classpath resource.
Therefore, it is similar to but more generic than the file inbound channel adapter.</p>
<p>For further details, see <a class="xref" href="resource.html#resource-inbound-channel-adapter" title="28.1&nbsp;Resource Inbound Channel Adapter">Section&nbsp;28.1, &#8220;Resource Inbound Channel Adapter&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-stored-proc-support" href="#x2.1-new-stored-proc-support"></a>Stored Procedure Components</h4></div></div></div>

<p>With Spring Integration 2.1, the <code class="literal">JDBC</code> Module also provides stored procedure support by adding several new components, including inbound and outbound channel adapters and an outbound gateway.
The stored procedure support leverages  Spring&#8217;s <a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/jdbc/core/simple/SimpleJdbcCall.html" target="_top"><code class="literal">SimpleJdbcCall</code></a> class and consequently supports stored procedures for:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Apache Derby
</li><li class="listitem">
DB2
</li><li class="listitem">
MySQL
</li><li class="listitem">
Microsoft SQL Server
</li><li class="listitem">
Oracle
</li><li class="listitem">
PostgreSQL
</li><li class="listitem">
Sybase
</li></ul></div>
<p>The stored procedure components also support SQL functions for the following databases:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
MySQL
</li><li class="listitem">
Microsoft SQL Server
</li><li class="listitem">
Oracle
</li><li class="listitem">
PostgreSQL
</li></ul></div>
<p>For further details, see <a class="xref" href="jdbc.html#stored-procedures" title="21.5&nbsp;Stored Procedures">Section&nbsp;21.5, &#8220;Stored Procedures&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-xpath-filter-support" href="#x2.1-new-xpath-filter-support"></a>XPath and XML Validating Filter</h4></div></div></div>

<p>Spring Integration 2.1 provides a new XPath-based message filter.
It is part of the <code class="literal">XML</code> module.
The XPath filter lets you filter messages by using XPath Expressions.
We also added documentation for the XML validating filter.</p>
<p>For more details, see <a class="xref" href="xml.html#xml-xpath-filter" title="38.7&nbsp;Using the XPath Filter">Section&nbsp;38.7, &#8220;Using the XPath Filter&#8221;</a> and <a class="xref" href="xml.html#xml-validating-filter" title="38.9&nbsp;XML Validating Filter">Section&nbsp;38.9, &#8220;XML Validating Filter&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-payload-enricher-support" href="#x2.1-new-payload-enricher-support"></a>Payload Enricher</h4></div></div></div>

<p>Since Spring Integration 2.1, we added the payload enricher.
A payload enricher defines an endpoint that typically passes a <a class="ulink" href="http://static.springsource.org/spring-integration/api/org/springframework/integration/Message.html" target="_top"><code class="literal">Message</code></a> to the exposed request channel and then expects a reply message.
The reply message then becomes the root object for evaluation of expressions to enrich the target payload.</p>
<p>For further details, see <a class="xref" href="messaging-transformation-chapter.html#payload-enricher" title="9.2.2&nbsp;Payload Enricher">Section&nbsp;9.2.2, &#8220;Payload Enricher&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-ftp-outbound-gateway" href="#x2.1-new-ftp-outbound-gateway"></a>FTP and SFTP Outbound Gateways</h4></div></div></div>

<p>Spring Integration 2.1 provides two new outbound gateways to interact with remote File Transfer Protocol (FTP) or Secure File Transfer Protocol (SFT) servers.
These two gateways let you directly execute a limited set of remote commands.</p>
<p>For instance, you can use these outbound gateways to list, retrieve, and delete remote files and have the Spring Integration message flow continue with the remote server&#8217;s response.</p>
<p>For further details, see <a class="xref" href="ftp.html#ftp-outbound-gateway" title="18.9&nbsp;FTP Outbound Gateway">Section&nbsp;18.9, &#8220;FTP Outbound Gateway&#8221;</a> and <a class="xref" href="sftp.html#sftp-outbound-gateway" title="30.11&nbsp;SFTP Outbound Gateway">Section&nbsp;30.11, &#8220;SFTP Outbound Gateway&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-ftp-session-caching" href="#x2.1-new-ftp-session-caching"></a>FTP Session Caching</h4></div></div></div>

<p>As of version 2.1, we have exposed more flexibility with regards to session management for remote file adapters (for example, FTP, SFTP, and others).</p>
<p>Specifically, we deprecated the <code class="literal">cache-sessions</code> attribute (which is available via the XML namespace support).
As an alternative, we added the <code class="literal">sessionCacheSize</code> and <code class="literal">sessionWaitTimeout</code> attributes on the <code class="literal">CachingSessionFactory</code>.</p>
<p>For further details, see <a class="xref" href="ftp.html#ftp-session-caching" title="18.10&nbsp;FTP Session Caching">Section&nbsp;18.10, &#8220;FTP Session Caching&#8221;</a> and <a class="xref" href="sftp.html#sftp-session-caching" title="30.4&nbsp;SFTP Session Caching">Section&nbsp;30.4, &#8220;SFTP Session Caching&#8221;</a>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x2.1-framework-refactorings" href="#x2.1-framework-refactorings"></a>I.14.2&nbsp;Framework Refactoring</h3></div></div></div>

<p>We refactored the Spring Integration framework in a number of ways, all described in this section.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-router-standardization" href="#x2.1-router-standardization"></a>Standardizing Router Configuration</h4></div></div></div>

<p>We standardized router parameters across all router implementations with Spring Integration 2.1 to provide a more consistent user experience.</p>
<p>In Spring Integration 2.1, we removed the <code class="literal">ignore-channel-name-resolution-failures</code> attribute in favor of consolidating its behavior with the <code class="literal">resolution-required</code> attribute.
Also, the <code class="literal">resolution-required</code> attribute now defaults to <code class="literal">true</code>.</p>
<p>Starting with Spring Integration 2.1, routers no longer silently drop any messages if no default output channel was defined.
This means that, by default, routers now require at least one resolved channel (if no <code class="literal">default-output-channel</code> was set) and, by default, throw a <code class="literal">MessageDeliveryException</code> if no channel was determined (or an attempt to send was not successful).</p>
<p>If, however, you do want to drop messages silently, you can set <code class="literal">default-output-channel="nullChannel"</code>.</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top">
<p>With the standardization of router parameters and the consolidation of the parameters described earlier, older Spring Integration based applications may break.</p>
</td></tr></table></div>
<p>For further details, see <code class="literal">&lt;&lt;router&gt;&gt;</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-schema-updated" href="#x2.1-schema-updated"></a>XML Schemas updated to 2.1</h4></div></div></div>

<p>Spring Integration 2.1 ships with an updated XML Schema (version 2.1).
It provides many improvements, such as the Router standardizations <a class="link" href="history.html#x2.1-router-standardization" title="Standardizing Router Configuration">discussed earlier</a>.</p>
<p>From now on, developers must always declare the latest XML schema (currently version 2.1).
Alternatively, they can use the version-less schema.
Generally, the best option is to use version-less namespaces, as these automatically use the latest available version of Spring Integration.</p>
<p>The following example declares a version-less Spring Integration namespace:</p>
<div class="informalexample">
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
   <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
   <span class="hl-attribute">xmlns:int</span>=<span class="hl-value">"http://www.springframework.org/schema/integration"</span>
   <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/integration
           http://www.springframework.org/schema/integration/spring-integration.xsd
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="hl-tag">&gt;</span>
...
<span class="hl-tag">&lt;/beans&gt;</span></pre>
</div>
<p>The following example declares a Spring Integration namespace with an explicit version:</p>
<div class="informalexample">
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
   <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
   <span class="hl-attribute">xmlns:int</span>=<span class="hl-value">"http://www.springframework.org/schema/integration"</span>
   <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/integration
           http://www.springframework.org/schema/integration/spring-integration-2.2.xsd
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="hl-tag">&gt;</span>
...
<span class="hl-tag">&lt;/beans&gt;</span></pre>
</div>
<p>The old 1.0 and 2.0 schemas are still there.
However, if an application context still references one of those deprecated schemas, the validator fails on initialization.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x2.1-source-control-infrastructure" href="#x2.1-source-control-infrastructure"></a>I.14.3&nbsp;Source Control Management and Build Infrastructure</h3></div></div></div>

<p>Version 2.1 introduced a number of changes to source control management and build infrastructure.
This section covers those changes.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-move-to-github" href="#x2.1-move-to-github"></a>Source Code Now Hosted on Github</h4></div></div></div>

<p>Since version 2.0, the Spring Integration project uses <a class="ulink" href="http://git-scm.com/" target="_top">Git</a> for version control.
To increase community visibility even further, the project was moved from SpringSource hosted Git repositories to <a class="ulink" href="http://www.github.com/" target="_top">Github</a>.
The Spring Integration Git repository is located at: <a class="ulink" href="https://github.com/spring-projects/spring-integration" target="_top">spring-integration</a>.</p>
<p>For the project, we also improved the process of providing code contributions.
Further, we ensure that every commit is peer-reviewed.
In fact, core committers now follow the same process as contributors.
For more details, see <a class="ulink" href="https://github.com/spring-projects/spring-integration/blob/master/CONTRIBUTING.adoc" target="_top">Contributing</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-sonar" href="#x2.1-sonar"></a>Improved Source Code Visibility with Sonar</h4></div></div></div>

<p>In an effort to provide better source code visibility and consequently to monitor the quality of Spring Integration&#8217;s source code, we set up an instance of <a class="ulink" href="http://www.sonarsource.org/" target="_top">Sonar</a>.
We gather metrics nightly and make them available at <a class="ulink" href="https://sonar.spring.io/dashboard?id=org.springframework.integration%3Aspring-integration%3Amaster" target="_top">sonar.spring.io</a>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x2.1-new-samples" href="#x2.1-new-samples"></a>I.14.4&nbsp;New Samples</h3></div></div></div>

<p>For the 2.1 release of Spring Integration, we also expanded the Spring Integration Samples project and added many new samples, such as samples that cover AMQP support, a sample that showcases the new payload enricher, a sample illustrating techniques for testing Spring Integration flow fragments, and a sample for executing stored procedures against Oracle databases.
For details, visit <a class="ulink" href="https://github.com/spring-projects/spring-integration-samples" target="_top">spring-integration-samples</a>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="migration-1.0-2.0" href="#migration-1.0-2.0"></a>I.15&nbsp;Changes between Versions 1.0 and 2.0</h2></div></div></div>

<p>See the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki/Spring-Integration-1.0-to-2.0-Migration-Guide" target="_top">Migration Guide</a> for important changes that might affect your applications.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="migration-spring-30-support" href="#migration-spring-30-support"></a>I.15.1&nbsp;Spring 3 support</h3></div></div></div>

<p>Spring Integration 2.0 is built on top of Spring 3.0.5 and makes many of its features available to our users.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="spel-support" href="#spel-support"></a>Support for the Spring Expression Language (SpEL)</h4></div></div></div>

<p>You can now use SpEL expressions within the transformer, router, filter, splitter, aggregator, service-activator, header-enricher, and many more elements of the Spring Integration core namespace as well as within various adapters.
This guide includes many samples.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="conversion-support" href="#conversion-support"></a>Conversion Service and Converter</h4></div></div></div>

<p>You can now benefit from the conversion service support provided with Spring while configuring many Spring Integration components, such as a <a class="ulink" href="http://www.eaipatterns.com/DatatypeChannel.html" target="_top">Datatype channel</a>.
See <a class="xref" href="messaging-channels-section.html#channel-implementations" title="6.1.2&nbsp;Message Channel Implementations">Section&nbsp;6.1.2, &#8220;Message Channel Implementations&#8221;</a> and <a class="xref" href="">???</a>.
Also, the SpEL support mentioned in the previous point also relies upon the conversion service.
Therefore, you can register converters once and take advantage of them anywhere you use SpEL expressions.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="task-scheduler-poller-support" href="#task-scheduler-poller-support"></a><code class="literal">TaskScheduler</code> and <code class="literal">Trigger</code></h4></div></div></div>

<p>Spring 3.0 defines two new strategies related to scheduling: <code class="literal">TaskScheduler</code> and <code class="literal">Trigger</code>.
Spring Integration (which uses a lot of scheduling) now builds upon these.
In fact, Spring Integration 1.0 had originally defined some of the components (such as <code class="literal">CronTrigger</code>) that have now been migrated into Spring 3.0&#8217;s core API.
Now you can benefit from reusing the same components within the entire application context (not just Spring Integration configuration).
We also greatly simplified configuration of Spring Integration pollers by providing attributes for directly configuring rates, delays, cron expressions, and trigger references.
See <a class="xref" href="messaging-channels-section.html#channel-adapter" title="6.3&nbsp;Channel Adapter">Section&nbsp;6.3, &#8220;Channel Adapter&#8221;</a> for sample configurations.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="rest-support" href="#rest-support"></a><code class="literal">RestTemplate</code> and <code class="literal">HttpMessageConverter</code></h4></div></div></div>

<p>Our outbound HTTP adapters now delegate to Spring&#8217;s <code class="literal">RestTemplate</code> for executing the HTTP request and handling its response.
This also means that you can reuse any custom <code class="literal">HttpMessageConverter</code> implementations.
See <a class="xref" href="http.html#http-outbound" title="20.2&nbsp;HTTP Outbound Components">Section&nbsp;20.2, &#8220;HTTP Outbound Components&#8221;</a> for more details.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="new-eip" href="#new-eip"></a>I.15.2&nbsp;Enterprise Integration Pattern Additions</h3></div></div></div>

<p>Also in 2.0, we have added support for even more of the patterns described in Hohpe and Woolf&#8217;s <a class="ulink" href="http://www.eaipatterns.com/" target="_top">Enterprise Integration Patterns</a> book.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-message-history" href="#new-message-history"></a>Message History</h4></div></div></div>

<p>We now provide support for the <a class="ulink" href="http://www.eaipatterns.com/MessageHistory.html" target="_top">message history</a> pattern, letting you keep track of all traversed components, including the name of each channel and endpoint as well as the timestamp of that traversal.
See <a class="xref" href="system-management-chapter.html#message-history" title="12.3&nbsp;Message History">Section&nbsp;12.3, &#8220;Message History&#8221;</a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-message-store" href="#new-message-store"></a>Message Store</h4></div></div></div>

<p>We now provide support for the <a class="ulink" href="http://www.eaipatterns.com/MessageStore.html" target="_top">message store</a> pattern.
The message store provides a strategy for persisting messages on behalf of any process whose scope extends beyond a single transaction, such as the aggregator and the resequencer.
Many sections of this guide include samples of how to use a message store, as it affects several areas of Spring Integration.
See <a class="xref" href="system-management-chapter.html#message-store" title="12.4&nbsp;Message Store">Section&nbsp;12.4, &#8220;Message Store&#8221;</a>, <a class="xref" href="messaging-transformation-chapter.html#claim-check" title="9.3&nbsp;Claim Check">Section&nbsp;9.3, &#8220;Claim Check&#8221;</a>, <a class="xref" href="messaging-channels-section.html#channel" title="6.1&nbsp;Message Channels">Section&nbsp;6.1, &#8220;Message Channels&#8221;</a>, <a class="xref" href="messaging-routing-chapter.html#aggregator" title="8.4&nbsp;Aggregator">Section&nbsp;8.4, &#8220;Aggregator&#8221;</a>, <a class="xref" href="jdbc.html" title="21.&nbsp;JDBC Support">Chapter&nbsp;21, <i>JDBC Support</i></a>`", and <a class="xref" href="messaging-routing-chapter.html#resequencer" title="8.5&nbsp;Resequencer">Section&nbsp;8.5, &#8220;Resequencer&#8221;</a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-claim-check" href="#new-claim-check"></a>Claim Check</h4></div></div></div>

<p>We have added an implementation of the <a class="ulink" href="http://www.eaipatterns.com/StoreInLibrary.html" target="_top">claim check</a> pattern.
The idea behind the claim check pattern is that you can exchange a message payload for a "<code class="literal">claim ticket</code>".
This lets you reduce bandwidth and avoid potential security issues when sending messages across channels.
See <a class="xref" href="messaging-transformation-chapter.html#claim-check" title="9.3&nbsp;Claim Check">Section&nbsp;9.3, &#8220;Claim Check&#8221;</a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-control-bus" href="#new-control-bus"></a>Control Bus</h4></div></div></div>

<p>We have provided implementations of the <a class="ulink" href="http://www.eaipatterns.com/ControlBus.html" target="_top">control bus</a> pattern, which lets you use messaging to manage and monitor endpoints and channels.
The implementations include both a SpEL-based approach and one that runs Groovy scripts.
See <a class="xref" href="system-management-chapter.html#control-bus" title="12.6&nbsp;Control Bus">Section&nbsp;12.6, &#8220;Control Bus&#8221;</a> and <a class="xref" href="messaging-endpoints-chapter.html#groovy-control-bus" title="10.8.4&nbsp;Control Bus">Section&nbsp;10.8.4, &#8220;Control Bus&#8221;</a> for more details.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="new-adapters" href="#new-adapters"></a>I.15.3&nbsp;New Channel Adapters and Gateways</h3></div></div></div>

<p>We have added several new channel adapters and messaging gateways in Spring Integration 2.0.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-ip" href="#new-ip"></a>TCP and UDP Adapters</h4></div></div></div>

<p>We have added channel adapters for receiving and sending messages over the TCP and UDP internet protocols.
See <a class="xref" href="ip.html" title="34.&nbsp;TCP and UDP Support">Chapter&nbsp;34, <i>TCP and UDP Support</i></a> for more details.
See also the following blog: <a class="ulink" href="http://blog.springsource.com/2010/03/29/using-udp-and-tcp-adapters-in-spring-integration-2-0-m3/" target="_top">"<code class="literal">Using UDP and TCP Adapters in Spring Integration 2.0 M3</code>"</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-twitter" href="#new-twitter"></a>Twitter Adapters</h4></div></div></div>

<p>Twitter adapters provides support for sending and receiving Twitter status updates as well as direct messages.
You can also perform Twitter Searches with an inbound channel adapter.
See <a class="ulink" href="https://github.com/spring-projects/spring-integration-extensions/tree/master/spring-integration-social-twitter" target="_top">Spring Integration Social Twitter</a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-xmpp" href="#new-xmpp"></a>XMPP Adapters</h4></div></div></div>

<p>The new XMPP adapters support both chat messages and presence events.
See <a class="xref" href="xmpp.html" title="39.&nbsp;XMPP Support">Chapter&nbsp;39, <i>XMPP Support</i></a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-ftp" href="#new-ftp"></a>FTP and FTPS Adapters</h4></div></div></div>

<p>Inbound and outbound file transfer support over FTP and FTPS is now available.
See <a class="xref" href="ftp.html" title="18.&nbsp;FTP/FTPS Adapters">Chapter&nbsp;18, <i>FTP/FTPS Adapters</i></a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-sftp" href="#new-sftp"></a>SFTP Adapters</h4></div></div></div>

<p>Inbound and outbound file transfer support over SFTP is now available.
See <a class="xref" href="sftp.html" title="30.&nbsp;SFTP Adapters">Chapter&nbsp;30, <i>SFTP Adapters</i></a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-feed" href="#new-feed"></a>Feed Adapters</h4></div></div></div>

<p>We have also added channel adapters for receiving news feeds (ATOM and RSS).
See <a class="xref" href="feed.html" title="16.&nbsp;Feed Adapter">Chapter&nbsp;16, <i>Feed Adapter</i></a> for more details.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="new-other" href="#new-other"></a>I.15.4&nbsp;Other Additions</h3></div></div></div>

<p>Spring Integration adds a number of other features. This section describes them.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-groovy" href="#new-groovy"></a>Groovy Support</h4></div></div></div>

<p>Spring Integration 2.0 added Groovy support, letting you use the Groovy scripting language to provide integration and business logic.
See <a class="xref" href="messaging-endpoints-chapter.html#groovy" title="10.8&nbsp;Groovy support">Section&nbsp;10.8, &#8220;Groovy support&#8221;</a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-map-transformer" href="#new-map-transformer"></a>Map Transformers</h4></div></div></div>

<p>These symmetrical transformers convert payload objects to and from <code class="literal">Map</code> objects.
See <a class="xref" href="messaging-transformation-chapter.html#transformer" title="9.1&nbsp;Transformer">Section&nbsp;9.1, &#8220;Transformer&#8221;</a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-json-transformer" href="#new-json-transformer"></a>JSON Transformers</h4></div></div></div>

<p>These symmetrical transformers convert payload objects to and from JSON.
See <a class="xref" href="messaging-transformation-chapter.html#transformer" title="9.1&nbsp;Transformer">Section&nbsp;9.1, &#8220;Transformer&#8221;</a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-serialize-transformer" href="#new-serialize-transformer"></a>Serialization Transformers</h4></div></div></div>

<p>These symmetrical transformers convert payload objects to and from byte arrays.
They also support the serializer and deserializer strategy interfaces that Spring 3.0.5 added.
See <a class="xref" href="messaging-transformation-chapter.html#transformer" title="9.1&nbsp;Transformer">Section&nbsp;9.1, &#8220;Transformer&#8221;</a> for more details.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="new-refactoring" href="#new-refactoring"></a>I.15.5&nbsp;Framework Refactoring</h3></div></div></div>

<p>The core API went through some significant refactoring to make it simpler and more usable.
Although we anticipate that the impact to developers should be minimal, you should read through this document to find what was changed.
Specifically, you should read <a class="xref" href="messaging-routing-chapter.html#dynamic-routers" title="8.1.6&nbsp;Dynamic Routers">Section&nbsp;8.1.6, &#8220;Dynamic Routers&#8221;</a>, <a class="xref" href="messaging-endpoints-chapter.html#gateway" title="10.4&nbsp;Messaging Gateways">Section&nbsp;10.4, &#8220;Messaging Gateways&#8221;</a>, <a class="xref" href="http.html#http-outbound" title="20.2&nbsp;HTTP Outbound Components">Section&nbsp;20.2, &#8220;HTTP Outbound Components&#8221;</a>, <a class="xref" href="message.html" title="7.&nbsp;Message">Chapter&nbsp;7, <i>Message</i></a>, and <a class="xref" href="messaging-routing-chapter.html#aggregator" title="8.4&nbsp;Aggregator">Section&nbsp;8.4, &#8220;Aggregator&#8221;</a>.
If you directly depend on some of the core components (<code class="literal">Message</code>, <code class="literal">MessageHeaders</code>, <code class="literal">MessageChannel</code>, <code class="literal">MessageBuilder</code>, and others), you need to update any import statements.
We restructured some packaging to provide the flexibility we needed for extending the domain model while avoiding any cyclical dependencies (it is a policy of the framework to avoid such "<code class="literal">tangles</code>").</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="new-infrastructure" href="#new-infrastructure"></a>I.15.6&nbsp;New Source Control Management and Build Infrastructure</h3></div></div></div>

<p>With Spring Integration 2.0, we switched our build environment to use Git for source control.
To access our repository, visit <a class="ulink" href="http://git.springsource.org/spring-integration" target="_top">http://git.springsource.org/spring-integration</a>.
We have also switched our build system to <a class="ulink" href="http://gradle.org/" target="_top">Gradle</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="new-samples" href="#new-samples"></a>I.15.7&nbsp;New Spring Integration Samples</h3></div></div></div>

<p>With Spring Integration 2.0, we have decoupled the samples from our main release distribution.
Please read the following blog to get more information: <a class="ulink" href="http://blog.springsource.com/2010/09/29/new-spring-integration-samples/" target="_top">New Spring Integration Samples</a>. We have also created many new samples, including samples for every new adapter.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="new-sts" href="#new-sts"></a>I.15.8&nbsp;Spring Tool Suite Visual Editor for Spring Integration</h3></div></div></div>

<p>There is an amazing new visual editor for Spring Integration included within the latest version of SpringSource Tool Suite.
If you are not already using STS, you can download it athttps://spring.io/tools/sts[Spring Tool Suite].</p>
</div>
</div>
</div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="resources.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="spring-integration-appendices.html">Up</a></td><td width="40%" align="right">&nbsp;</td></tr><tr><td width="40%" align="left" valign="top">Appendix&nbsp;H.&nbsp;Additional Resources&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;</td></tr></table></div></body></html>