<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>12.&nbsp;Spring ApplicationEvent Support</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Integration Reference Manual"><link rel="up" href="spring-integration-endpoints.html" title="Part&nbsp;V.&nbsp;Integration Endpoints"><link rel="prev" href="amqp.html" title="11.&nbsp;AMQP Support"><link rel="next" href="feed.html" title="13.&nbsp;Feed Adapter"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">12.&nbsp;Spring ApplicationEvent Support</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="amqp.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;V.&nbsp;Integration Endpoints</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="feed.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="applicationevent" href="#applicationevent"></a>12.&nbsp;Spring ApplicationEvent Support</h2></div></div></div>

<p>Spring Integration provides support for inbound and outbound <code class="literal">ApplicationEvents</code> as defined by the underlying Spring Framework.
For more information about Spring&#8217;s support for events and listeners, refer to the <a class="ulink" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/beans.html#context-functionality-events" target="_top">Spring Reference Manual</a>.</p>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="appevent-inbound" href="#appevent-inbound"></a>12.1&nbsp;Receiving Spring Application Events</h2></div></div></div>

<p>To receive events and send them to a channel, simply define an instance of Spring Integration&#8217;s <code class="literal">ApplicationEventListeningMessageProducer</code>.
This class is an implementation of Spring&#8217;s <code class="literal">ApplicationListener</code> interface.
By default it will pass all received events as Spring Integration Messages.
To limit based on the type of event, configure the list of event types that you want to receive with the <span class="emphasis"><em>eventTypes</em></span> property.
If a received event has a Message instance as its <span class="emphasis"><em>source</em></span>, then that will be passed as-is.
Otherwise, if a SpEL-based "payloadExpression" has been provided, that will be evaluated against the ApplicationEvent instance.
If the event&#8217;s source is not a Message instance and no "payloadExpression" has been provided, then the ApplicationEvent itself will be passed as the payload.</p>
<p>Starting with <span class="emphasis"><em>version 4.2</em></span> the <code class="literal">ApplicationEventListeningMessageProducer</code> implements <code class="literal">GenericApplicationListener</code>
and can be configured to accept not only <code class="literal">ApplicationEvent</code> types, but any type for treating <span class="emphasis"><em>payload events</em></span>
which are supported since Spring Framework 4.2, too.
When the accepted event is an instance of <code class="literal">PayloadApplicationEvent</code>, its <code class="literal">payload</code> is used for the message to send.</p>
<p>For convenience namespace support is provided to configure&nbsp;an <code class="literal">ApplicationEventListeningMessageProducer</code> via the <span class="emphasis"><em>inbound-channel-adapter</em></span> element.</p>
<pre class="programlisting"><span class="hl-tag">&lt;int-event:inbound-channel-adapter</span> <span class="hl-attribute">channel</span>=<span class="hl-value">"eventChannel"</span>
                                   <span class="hl-attribute">error-channel</span>=<span class="hl-value">"eventErrorChannel"</span>
                                   <span class="hl-attribute">event-types</span>=<span class="hl-value">"example.FooEvent, example.BarEvent, java.util.Date"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;int:publish-subscribe-channel</span> <span class="hl-attribute">id</span>=<span class="hl-value">"eventChannel"</span><span class="hl-tag">/&gt;</span></pre>
<p>In the above example, all Application Context events that match one of the types specified by the <span class="emphasis"><em>event-types</em></span> (optional) attribute will be delivered as Spring Integration Messages to the Message Channel named <span class="emphasis"><em>eventChannel</em></span>.
If a downstream component throws an exception, a MessagingException containing the failed message and exception will be sent to the channel named <span class="emphasis"><em>eventErrorChannel</em></span>.
If no "error-channel" is specified and the downstream channels are synchronous, the Exception will be propagated to the caller.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="appevent-outbound" href="#appevent-outbound"></a>12.2&nbsp;Sending Spring Application Events</h2></div></div></div>

<p>To send Spring <code class="literal">ApplicationEvents</code>, create an instance of the <code class="literal">ApplicationEventPublishingMessageHandler</code> and register it within an endpoint.
This implementation of the <code class="literal">MessageHandler</code> interface also implements Spring&#8217;s <code class="literal">ApplicationEventPublisherAware</code> interface and thus acts as a bridge between Spring Integration Messages and <code class="literal">ApplicationEvents</code>.</p>
<p>For convenience namespace support is provided to configure&nbsp;an <code class="literal">ApplicationEventPublishingMessageHandler</code> via the <span class="emphasis"><em>outbound-channel-adapter</em></span> element.</p>
<pre class="programlisting"><span class="hl-tag">&lt;int:channel</span> <span class="hl-attribute">id</span>=<span class="hl-value">"eventChannel"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;int-event:outbound-channel-adapter</span> <span class="hl-attribute">channel</span>=<span class="hl-value">"eventChannel"</span><span class="hl-tag">/&gt;</span></pre>
<p>If you are using a PollableChannel (e.g., Queue), you can also provide <span class="emphasis"><em>poller</em></span> as a sub-element of the <span class="emphasis"><em>outbound-channel-adapter</em></span> element.
You can also optionally provide a <span class="emphasis"><em>task-executor</em></span> reference for that poller.
The following example demonstrates both.</p>
<pre class="programlisting"><span class="hl-tag">&lt;int:channel</span> <span class="hl-attribute">id</span>=<span class="hl-value">"eventChannel"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;int:queue/&gt;</span>
<span class="hl-tag">&lt;/int:channel&gt;</span>

<span class="hl-tag">&lt;int-event:outbound-channel-adapter</span> <span class="hl-attribute">channel</span>=<span class="hl-value">"eventChannel"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;int:poller</span> <span class="hl-attribute">max-messages-per-poll</span>=<span class="hl-value">"1"</span> <span class="hl-attribute">task-executor</span>=<span class="hl-value">"executor"</span> <span class="hl-attribute">fixed-rate</span>=<span class="hl-value">"100"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/int-event:outbound-channel-adapter&gt;</span>

<span class="hl-tag">&lt;task:executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">"executor"</span> <span class="hl-attribute">pool-size</span>=<span class="hl-value">"5"</span><span class="hl-tag">/&gt;</span></pre>
<p>In the above example, all messages sent to the <span class="emphasis"><em>eventChannel</em></span> channel will be published as ApplicationEvents to any relevant ApplicationListener instances that are registered within the same Spring ApplicationContext.
If the payload of the Message is an ApplicationEvent, it will be passed as-is.
Otherwise the Message itself will be wrapped in a <code class="literal">MessagingEvent</code> instance.</p>
<p>Starting with <span class="emphasis"><em>version 4.2</em></span> the <code class="literal">ApplicationEventPublishingMessageHandler</code> (<code class="literal">&lt;int-event:outbound-channel-adapter&gt;</code>)
can be configured with the <code class="literal">publish-payload</code> boolean attribute to publish to the application context <code class="literal">payload</code> as is,
instead of wrapping it to a <code class="literal">MessagingEvent</code> instance.</p>
</div>
</div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="amqp.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="spring-integration-endpoints.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="feed.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">11.&nbsp;AMQP Support&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;13.&nbsp;Feed Adapter</td></tr></table></div></body></html>