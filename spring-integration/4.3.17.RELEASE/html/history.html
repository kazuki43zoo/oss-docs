<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Appendix&nbsp;H.&nbsp;Change History</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Integration Reference Manual"><link rel="up" href="spring-integration-appendices.html" title="Part&nbsp;VI.&nbsp;Appendices"><link rel="prev" href="resources.html" title="Appendix&nbsp;G.&nbsp;Additional Resources"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Appendix&nbsp;H.&nbsp;Change History</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="resources.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;VI.&nbsp;Appendices</th><td width="20%" align="right">&nbsp;</td></tr></table><hr></div><div class="appendix"><div class="titlepage"><div><div><h2 class="title"><a name="history" href="#history"></a>Appendix&nbsp;H.&nbsp;Change History</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="migration-4.1-4.2" href="#migration-4.1-4.2"></a>H.1&nbsp;Changes between 4.1 and 4.2</h2></div></div></div>

<p>Please be sure to also see the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki/Spring-Integration-4.1-to-4.2-Migration-Guide" target="_top">Migration Guide</a>
for important changes that might affect your applications.
Migration guides for all versions back to <span class="emphasis"><em>2.1</em></span> can be found on the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki" target="_top">Wiki</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="x4.2-new-components" href="#x4.2-new-components"></a>H.2&nbsp;New Components</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-JMX" href="#x4.2-JMX"></a>H.2.1&nbsp;Major Management/JMX Rework</h3></div></div></div>

<p>A new <code class="literal">MetricsFactory</code> strategy interface has been introduced.
This, together with other changes in the JMX and management infrastructure provides much more control over management
configuration and runtime performance.</p>
<p>However, this has some important implications for (some) user environments.</p>
<p>For complete details, see <a class="xref" href="system-management-chapter.html#metrics-management" title="9.1&nbsp;Metrics and Management">Section&nbsp;9.1, &#8220;Metrics and Management&#8221;</a> and <a class="xref" href="system-management-chapter.html#jmx-42-improvements" title="JMX Improvements">the section called &#8220;JMX Improvements&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-mongodb-metadata-store" href="#x4.2-mongodb-metadata-store"></a>H.2.2&nbsp;MongoDB Metadata Store</h3></div></div></div>

<p>The <code class="literal">MongoDbMetadataStore</code> is now available. For more information, see <a class="xref" href="mongodb.html#mongodb-metadata-store" title="22.3.2&nbsp;MongoDB Metadata Store">Section&nbsp;22.3.2, &#8220;MongoDB Metadata Store&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-secured-channel-annotation" href="#x4.2-secured-channel-annotation"></a>H.2.3&nbsp;SecuredChannel Annotation</h3></div></div></div>

<p>The <code class="literal">@SecuredChannel</code> annotation has been introduced, replacing the deprecated <code class="literal">ChannelSecurityInterceptorFactoryBean</code>.
For more information, see <a class="xref" href="security.html" title="Appendix&nbsp;D.&nbsp;Security in Spring Integration">Appendix&nbsp;D, <i>Security in Spring Integration</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-security-context-propagation" href="#x4.2-security-context-propagation"></a>H.2.4&nbsp;SecurityContext Propagation</h3></div></div></div>

<p>The <code class="literal">SecurityContextPropagationChannelInterceptor</code> has been
introduced for the <code class="literal">SecurityContext</code> propagation from one message flow&#8217;s Thread to another.
For more information, see <a class="xref" href="security.html" title="Appendix&nbsp;D.&nbsp;Security in Spring Integration">Appendix&nbsp;D, <i>Security in Spring Integration</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-file-splitter" href="#x4.2-file-splitter"></a>H.2.5&nbsp;FileSplitter</h3></div></div></div>

<p>The <code class="literal">FileSplitter</code>, which splits text files into lines, was added in 4.1.2.
It now has full support in the <code class="literal">int-file:</code> namespace; see <a class="xref" href="files.html#file-splitter" title="14.5&nbsp;File Splitter">Section&nbsp;14.5, &#8220;File Splitter&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-zk" href="#x4.2-zk"></a>H.2.6&nbsp;Zookeeper Support</h3></div></div></div>

<p>Zookeeper support has been added to the framework to assist when running on a clustered/multi-host environment.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
ZookeeperMetadataStore
</li><li class="listitem">
ZookeeperLockRegistry
</li><li class="listitem">
Zookeeper Leadership
</li></ul></div>
<p>See <a class="xref" href="zookeeper.html" title="37.&nbsp;Zookeeper Support">Chapter&nbsp;37, <i>Zookeeper Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-barrier" href="#x4.2-barrier"></a>H.2.7&nbsp;Thread Barrier</h3></div></div></div>

<p>A new thread <code class="literal">&lt;int:barrier/&gt;</code> component is available allowing a thread to be suspended until some asynchronous event
occurs.</p>
<p>See <a class="xref" href="messaging-routing-chapter.html#barrier" title="6.8&nbsp;Thread Barrier">Section&nbsp;6.8, &#8220;Thread Barrier&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-stomp" href="#x4.2-stomp"></a>H.2.8&nbsp;STOMP Support</h3></div></div></div>

<p>STOMP support has been added to the framework as <span class="emphasis"><em>inbound</em></span> and <span class="emphasis"><em>outbound</em></span> channel adapters pair.
See <a class="xref" href="stomp.html" title="28.&nbsp;STOMP Support">Chapter&nbsp;28, <i>STOMP Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-codec" href="#x4.2-codec"></a>H.2.9&nbsp;Codec</h3></div></div></div>

<p>A new <code class="literal">Codec</code> abstraction has been introduced, to encode/decode objects to/from <code class="literal">byte[]</code>.
An implementation that uses Kryo is provided.
Codec-based transformers and message converters are also provided.</p>
<p>See <a class="xref" href="messaging-transformation-chapter.html#codec" title="7.4&nbsp;Codec">Section&nbsp;7.4, &#8220;Codec&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-prepared-statement-setter" href="#x4.2-prepared-statement-setter"></a>H.2.10&nbsp;Message PreparedStatement Setter</h3></div></div></div>

<p>A new <code class="literal">MessagePreparedStatementSetter</code> functional interface callback is available for the <code class="literal">JdbcMessageHandler</code>
(<code class="literal">&lt;int-jdbc:outbound-gateway&gt;</code> and <code class="literal">&lt;int-jdbc:outbound-channel-adapter&gt;</code>) as an alternative to the
<code class="literal">SqlParameterSourceFactory</code> to populate parameters on the <code class="literal">PreparedStatement</code> with the <code class="literal">requestMessage</code> context.</p>
<p>See <a class="xref" href="jdbc.html#jdbc-outbound-channel-adapter" title="18.2&nbsp;Outbound Channel Adapter">Section&nbsp;18.2, &#8220;Outbound Channel Adapter&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="x4.2-general" href="#x4.2-general"></a>H.3&nbsp;General Changes</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-wire-tap" href="#x4.2-wire-tap"></a>H.3.1&nbsp;Wire Tap</h3></div></div></div>

<p>As an alternative to the existing <code class="literal">selector</code> attribute, the <code class="literal">&lt;wire-tap/&gt;</code> now supports the <code class="literal">selector-expression</code> attribute.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-file-changes" href="#x4.2-file-changes"></a>H.3.2&nbsp;File Changes</h3></div></div></div>

<p>See <a class="xref" href="files.html" title="14.&nbsp;File Support">Chapter&nbsp;14, <i>File Support</i></a> for more information about these changes.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_appending_new_lines" href="#_appending_new_lines"></a>Appending New Lines</h4></div></div></div>

<p>The <code class="literal">&lt;int-file:outbound-channel-adapter&gt;</code> and <code class="literal">&lt;int-file:outbound-gateway&gt;</code> now support an <code class="literal">append-new-line</code> attribute.
If set to <code class="literal">true</code>, a new line is appended to the file after a message is written.
The default attribute value is <code class="literal">false</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_ignoring_hidden_files" href="#_ignoring_hidden_files"></a>Ignoring Hidden Files</h4></div></div></div>

<p>The <code class="literal">ignore-hidden</code> attribute has been introduced for the <code class="literal">&lt;int-file:inbound-channel-adapter&gt;</code> to pick up or not
the <span class="emphasis"><em>hidden</em></span> files from the source directory.
It is <code class="literal">true</code> by default.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_writing_inputstream_payloads" href="#_writing_inputstream_payloads"></a>Writing InputStream Payloads</h4></div></div></div>

<p>The <code class="literal">FileWritingMessageHandler</code> now also accepts <code class="literal">InputStream</code> as a valid message payload type.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_headdirectoryscanner" href="#_headdirectoryscanner"></a>HeadDirectoryScanner</h4></div></div></div>

<p>The <code class="literal">HeadDirectoryScanner</code> can now be used with other <code class="literal">FileListFilter</code> s.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_last_modified_filter" href="#_last_modified_filter"></a>Last Modified Filter</h4></div></div></div>

<p>The <code class="literal">LastModifiedFileListFilter</code> has been added.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_watchservice_directory_scanner" href="#_watchservice_directory_scanner"></a>WatchService Directory Scanner</h4></div></div></div>

<p>The <code class="literal">WatchServiceDirectoryScanner</code> is now available.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_persistent_file_list_filter_changes" href="#_persistent_file_list_filter_changes"></a>Persistent File List Filter Changes</h4></div></div></div>

<p>The <code class="literal">AbstractPersistentFileListFilter</code> has a new property <code class="literal">flushOnUpdate</code> which, when set to true, will <code class="literal">flush()</code> the
metadata store if it implements <code class="literal">Flushable</code> (e.g. the <code class="literal">PropertiesPersistingMetadataStore</code>).</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-class-package-change" href="#x4.2-class-package-change"></a>H.3.3&nbsp;Class Package Change</h3></div></div></div>

<p>The <code class="literal">ScatterGatherHandler</code> class has been moved from the <code class="literal">org.springframework.integration.handler</code> to the <code class="literal">org.springframework.integration.scattergather</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_tcp_changes" href="#_tcp_changes"></a>H.3.4&nbsp;TCP Changes</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.2-tcp-serializers" href="#x4.2-tcp-serializers"></a>TCP Serializers</h4></div></div></div>

<p>The TCP <code class="literal">Serializers</code> no longer <code class="literal">flush()</code> the <code class="literal">OutputStream</code>; this is now done by the <code class="literal">TcpNxxConnection</code> classes.
If you are using the serializers directly within user code, you may have to <code class="literal">flush()</code> the <code class="literal">OutputStream</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.2-tcp-server-exceptions" href="#x4.2-tcp-server-exceptions"></a>Server Socket Exceptions</h4></div></div></div>

<p><code class="literal">TcpConnectionServerExceptionEvent</code> s are now published whenever an unexpected exception occurs on a TCP server socket (also added to 4.1.3, 4.0.7).
See <a class="xref" href="ip.html#tcp-events" title="31.5&nbsp;TCP Connection Events">Section&nbsp;31.5, &#8220;TCP Connection Events&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.2-tcp-server-port" href="#x4.2-tcp-server-port"></a>TCP Server Port</h4></div></div></div>

<p>If a TCP server socket factory is configured to listen on a random port, the actual port chosen by the OS can now
be obtained using <code class="literal">getPort()</code>.
<code class="literal">getServerSocketAddress()</code> is also available.</p>
<p>See <a class="xref" href="ip.html#connection-factories" title="31.3&nbsp;TCP Connection Factories">Section&nbsp;31.3, &#8220;TCP Connection Factories&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.2-tcp-gw-rto" href="#x4.2-tcp-gw-rto"></a>TCP Gateway Remote Timeout</h4></div></div></div>

<p>The <code class="literal">TcpOutboundGateway</code> now supports <code class="literal">remote-timeout-expression</code> as an alternative to the existing <code class="literal">remote-timeout</code> attribute.
This allows setting the timeout based on each message.</p>
<p>Also, the <code class="literal">remote-timeout</code> no longer defaults to the same value as <code class="literal">reply-timeout</code> which has a completely different meaning.</p>
<p>See <a class="xref" href="ip.html#tcp-ob-gateway-attributes" title="Table&nbsp;31.7.&nbsp;TCP Outbound Gateway Attributes">Table&nbsp;31.7, &#8220;TCP Outbound Gateway Attributes&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.2-tcp-ssl" href="#x4.2-tcp-ssl"></a>TCP SSLSession Available for Header Mapping</h4></div></div></div>

<p><code class="literal">TcpConnection</code> s now support <code class="literal">getSslSession()</code> to enable users to extract information from the session to add to
message headers.</p>
<p>See <a class="xref" href="ip.html#ip-msg-headers" title="31.13&nbsp;IP Message Headers">Section&nbsp;31.13, &#8220;IP Message Headers&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.2-tcp-events" href="#x4.2-tcp-events"></a>TCP Events</h4></div></div></div>

<p>New events are now published whenever a correlation exception occurs - for example sending a message to a
non-existent socket.</p>
<p>The <code class="literal">TcpConnectionEventListeningMessageProducer</code> is deprecated; use the generic event adapter instead.</p>
<p>See <a class="xref" href="ip.html#tcp-events" title="31.5&nbsp;TCP Connection Events">Section&nbsp;31.5, &#8220;TCP Connection Events&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-inbound-channel-adapter-annotation" href="#x4.2-inbound-channel-adapter-annotation"></a>H.3.5&nbsp;@InboundChannelAdapter</h3></div></div></div>

<p>Previously, the <code class="literal">@Poller</code> on an inbound channel adapter defaulted the <code class="literal">maxMessagesPerPoll</code> attribute to <code class="literal">-1</code> (infinity).
This was inconsistent with the XML configuration of <code class="literal">&lt;inbound-channel-adapter/&gt;</code> s, which defaults to 1.
The annotation now defaults this attribute to 1.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-api-changes" href="#x4.2-api-changes"></a>H.3.6&nbsp;API Changes</h3></div></div></div>

<p><code class="literal">o.s.integration.util.FunctionIterator</code> now requires a <code class="literal">o.s.integration.util.Function</code> instead of a
<code class="literal">reactor.function.Function</code>.
This was done to remove an unnecessary hard dependency on Reactor.
Any uses of this iterator will need to change the import.</p>
<p>Of course, Reactor is still supported for functionality such as the <code class="literal">Promise</code> gateway; the dependency was removed for those users who don&#8217;t need it.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-jms-changes" href="#x4.2-jms-changes"></a>H.3.7&nbsp;JMS Changes</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_reply_listener_lazy_initialization" href="#_reply_listener_lazy_initialization"></a>Reply Listener Lazy Initialization</h4></div></div></div>

<p>It is now possible to configure the reply listener in JMS outbound gateways to be initialized on-demand and stopped
after an idle period, instead of being controlled by the gateway&#8217;s lifecycle.</p>
<p>See <a class="xref" href="jms.html#jms-outbound-gateway" title="20.5&nbsp;Outbound Gateway">Section&nbsp;20.5, &#8220;Outbound Gateway&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_conversion_errors_in_message_driven_endpoints" href="#_conversion_errors_in_message_driven_endpoints"></a>Conversion Errors in Message-Driven Endpoints</h4></div></div></div>

<p>The <code class="literal">error-channel</code> now is used for the conversion errors, which have caused a transaction rollback and message redelivery previously.</p>
<p>See <a class="xref" href="jms.html#jms-message-driven-channel-adapter" title="20.2&nbsp;Message-Driven Channel Adapter">Section&nbsp;20.2, &#8220;Message-Driven Channel Adapter&#8221;</a> and <a class="xref" href="jms.html#jms-inbound-gateway" title="20.4&nbsp;Inbound Gateway">Section&nbsp;20.4, &#8220;Inbound Gateway&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_default_acknowledge_mode" href="#_default_acknowledge_mode"></a>Default Acknowledge Mode</h4></div></div></div>

<p>When using an implicitly defined <code class="literal">DefaultMessageListenerContainer</code>, the default <code class="literal">acknowledge</code> is now <code class="literal">transacted</code>.
<code class="literal">transacted</code> is recommended when using this container, to avoid message loss.
This default now applies to the message-driven inbound adapter and the inbound gateway, it was already the
default for jms-backed channels.</p>
<p>See <a class="xref" href="jms.html#jms-message-driven-channel-adapter" title="20.2&nbsp;Message-Driven Channel Adapter">Section&nbsp;20.2, &#8220;Message-Driven Channel Adapter&#8221;</a> and <a class="xref" href="jms.html#jms-inbound-gateway" title="20.4&nbsp;Inbound Gateway">Section&nbsp;20.4, &#8220;Inbound Gateway&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_shared_subscriptions" href="#_shared_subscriptions"></a>Shared Subscriptions</h4></div></div></div>

<p>Namespace support for shared subscriptions (JMS 2.0) has been added to message-driven endpoints and the
<code class="literal">&lt;int-jms:publish-subscribe-channel&gt;</code>.
Previously, you had to wire up listener containers as <code class="literal">&lt;bean/&gt;</code> s to use shared connections.</p>
<p>See <a class="xref" href="jms.html" title="20.&nbsp;JMS Support">Chapter&nbsp;20, <i>JMS Support</i></a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-conditional-pollers" href="#x4.2-conditional-pollers"></a>H.3.8&nbsp;Conditional Pollers</h3></div></div></div>

<p>Much more flexibility is now provided for dynamic polling.</p>
<p>See <a class="xref" href="messaging-channels-section.html#conditional-pollers" title="4.2.3&nbsp;Conditional Pollers for Message Sources">Section&nbsp;4.2.3, &#8220;Conditional Pollers for Message Sources&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-amqp-changes" href="#x4.2-amqp-changes"></a>H.3.9&nbsp;AMQP Changes</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_publisher_confirms" href="#_publisher_confirms"></a>Publisher Confirms</h4></div></div></div>

<p>The <code class="literal">&lt;int-amqp:outbound-gateway&gt;</code> now supports <code class="literal">confirm-correlation-expression</code> and <code class="literal">confirm-(n)ack-channel</code>
attributes with similar purpose as for <code class="literal">&lt;int-amqp:outbound-channel-adapter&gt;</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_correlation_data" href="#_correlation_data"></a>Correlation Data</h4></div></div></div>

<p>For both the outbound channel adapter and gateway, if the correlation data is a <code class="literal">Message&lt;?&gt;</code>, it will be the basis
of the message on the ack/nack channel, with the additional header(s) added.
Previously, any correlation data (including <code class="literal">Message&lt;?&gt;</code>) was returned as the payload of the ack/nack message.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_the_inbound_gateway_properties" href="#_the_inbound_gateway_properties"></a>The Inbound Gateway properties</h4></div></div></div>

<p>The <code class="literal">&lt;int-amqp:inbound-gateway&gt;</code> now exposes the <code class="literal">amqp-template</code> attribute to allow more control over an external bean
for the reply <code class="literal">RabbitTemplate</code> or even provide your own <code class="literal">AmqpTemplate</code> implementation.
In addition the <code class="literal">default-reply-to</code> is exposed to be used if request message doesn&#8217;t have <code class="literal">replyTo</code> property.</p>
<p>See <a class="xref" href="amqp.html" title="11.&nbsp;AMQP Support">Chapter&nbsp;11, <i>AMQP Support</i></a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-xpath-splitter" href="#x4.2-xpath-splitter"></a>H.3.10&nbsp;XPath Splitter Improvements</h3></div></div></div>

<p>The <code class="literal">XPathMessageSplitter</code> (<code class="literal">&lt;int-xml:xpath-splitter&gt;</code>) now allows the configuration of <code class="literal">output-properties</code>
for the internal <code class="literal">javax.xml.transform.Transformer</code> and supports an <code class="literal">Iterator</code> mode (defaults to <code class="literal">true</code>) for the xpath
evaluation <code class="literal">org.w3c.dom.NodeList</code> result.</p>
<p>See <a class="xref" href="xml.html#xml-xpath-splitting" title="35.5&nbsp;Splitting XML Messages">Section&nbsp;35.5, &#8220;Splitting XML Messages&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-http-changes" href="#x4.2-http-changes"></a>H.3.11&nbsp;HTTP Changes</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_cors" href="#_cors"></a>CORS</h4></div></div></div>

<p>The HTTP Inbound Endpoints (<code class="literal">&lt;int-http:inbound-channel-adapter&gt;</code> and <code class="literal">&lt;int-http:inbound-gateway&gt;</code>) now allow the
configuration of <span class="emphasis"><em>Cross-Origin Resource Sharing (CORS)</em></span>.</p>
<p>See <a class="xref" href="http.html#http-cors" title="17.4.4&nbsp;Cross-Origin Resource Sharing (CORS) Support">Section&nbsp;17.4.4, &#8220;Cross-Origin Resource Sharing (CORS) Support&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_inbound_gateway_timeout" href="#_inbound_gateway_timeout"></a>Inbound Gateway Timeout</h4></div></div></div>

<p>The HTTP inbound gateway can be configured as to what status code to return when a request times out.
The default is now <code class="literal">500 Internal Server Error</code> instead of <code class="literal">200 OK</code>.</p>
<p>See <a class="xref" href="http.html#http-response-statuscode" title="17.4.5&nbsp;Response StatusCode">Section&nbsp;17.4.5, &#8220;Response StatusCode&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_form_data" href="#_form_data"></a>Form Data</h4></div></div></div>

<p>Documentation is provided for when proxying <code class="literal">multipart/form-data</code> requests.
See <a class="xref" href="http.html" title="17.&nbsp;HTTP Support">Chapter&nbsp;17, <i>HTTP Support</i></a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-gw" href="#x4.2-gw"></a>H.3.12&nbsp;Gateway Changes</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_gateway_methods_can_return_completablefuture" href="#_gateway_methods_can_return_completablefuture"></a>Gateway Methods can Return CompletableFuture&lt;?&gt;</h4></div></div></div>

<p>When using Java 8, gateway methods can now return <code class="literal">CompletableFuture&lt;?&gt;</code>.
See <a class="xref" href="messaging-endpoints-chapter.html#gw-completable-future" title="CompletableFuture">the section called &#8220;CompletableFuture&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_messaginggateway_annotation" href="#_messaginggateway_annotation"></a>MessagingGateway Annotation</h4></div></div></div>

<p>The request and reply timeout properties are now <code class="literal">String</code> instead of <code class="literal">Long</code> to allow configuration with property
placeholders or SpEL. See <a class="xref" href="messaging-endpoints-chapter.html#messaging-gateway-annotation" title="8.4.6&nbsp;@MessagingGateway Annotation">Section&nbsp;8.4.6, &#8220;@MessagingGateway Annotation&#8221;</a>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.2-aggregator-changes" href="#x4.2-aggregator-changes"></a>H.3.13&nbsp;Aggregator Changes</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_aggregator_performance" href="#_aggregator_performance"></a>Aggregator Performance</h4></div></div></div>

<p>This release includes some performance improvements for aggregating components (aggregator, resequencer, etc),
by more efficiently removing messages from groups when they are released.
New methods (<code class="literal">removeMessagesFromGroup</code>) have been added to the message store.
Set the <code class="literal">removeBatchSize</code> property (default <code class="literal">100</code>) to adjust the number of messages deleted in each operation.
Currently, JDBC, Redis and MongoDB message stores support this property.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_output_message_group_processor" href="#_output_message_group_processor"></a>Output Message Group Processor</h4></div></div></div>

<p>When using a <code class="literal">ref</code> or inner bean for the aggregator, it is now possible to bind a <code class="literal">MessageGroupProcessor</code> directly.
In addition, a <code class="literal">SimpleMessageGroupProcessor</code> is provided that simply returns the collection of messages in the group.
When an output processor produces a collection of <code class="literal">Message&lt;?&gt;</code>, the aggregator releases those messages individually.
Configuring the <code class="literal">SimpleMessageGroupProcessor</code> makes the aggregator a message barrier, were messages are held up
until they all arrive, and are then released individually. See <a class="xref" href="messaging-routing-chapter.html#aggregator" title="6.4&nbsp;Aggregator">Section&nbsp;6.4, &#8220;Aggregator&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="__s_ftp_changes" href="#__s_ftp_changes"></a>H.3.14&nbsp;(S)FTP Changes</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_inbound_channel_adapters" href="#_inbound_channel_adapters"></a>Inbound channel adapters</h4></div></div></div>

<p>You can now specify a <code class="literal">remote-directory-expression</code> on the inbound channel adapters, to determine the directory
at runtime.
See <a class="xref" href="ftp.html" title="15.&nbsp;FTP/FTPS Adapters">Chapter&nbsp;15, <i>FTP/FTPS Adapters</i></a> and <a class="xref" href="sftp.html" title="27.&nbsp;SFTP Adapters">Chapter&nbsp;27, <i>SFTP Adapters</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_gateway_partial_results" href="#_gateway_partial_results"></a>Gateway Partial Results</h4></div></div></div>

<p>When use FTP/SFTP outbound gateways to operate on multiple files (<code class="literal">mget</code>, <code class="literal">mput</code>), it is possible for an exception to
occur after part of the request is completed.
If such a condition occurs, a <code class="literal">PartialSuccessException</code> is thrown containing the partial results.
See <a class="xref" href="ftp.html#ftp-outbound-gateway" title="15.7&nbsp;FTP Outbound Gateway">Section&nbsp;15.7, &#8220;FTP Outbound Gateway&#8221;</a> and <a class="xref" href="sftp.html#sftp-outbound-gateway" title="27.10&nbsp;SFTP Outbound Gateway">Section&nbsp;27.10, &#8220;SFTP Outbound Gateway&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_delegating_session_factory" href="#_delegating_session_factory"></a>Delegating Session Factory</h4></div></div></div>

<p>A delegating session factory is now available, enabling the selection of a particular session factory based on some
thread context value.</p>
<p>See <a class="xref" href="ftp.html#ftp-dsf" title="15.3&nbsp;Delegating Session Factory">Section&nbsp;15.3, &#8220;Delegating Session Factory&#8221;</a> and <a class="xref" href="sftp.html#sftp-dsf" title="27.4&nbsp;Delegating Session Factory">Section&nbsp;27.4, &#8220;Delegating Session Factory&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_default_sftp_session_factory" href="#_default_sftp_session_factory"></a>Default Sftp Session Factory</h4></div></div></div>

<p>Previously, the <code class="literal">DefaultSftpSessionFactory</code> unconditionally allowed connections to unknown hosts.
This is now configurable (default false).</p>
<p>The factory now requires a configured <code class="literal">knownHosts</code> file unless the <code class="literal">allowUnknownKeys</code> property is <code class="literal">true</code> (default
false).</p>
<p>See <a class="xref" href="sftp.html#sftp-unk-hosts">Section&nbsp;27.2.1, &#8220;Configuration Properties&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_message_session_callback" href="#_message_session_callback"></a>Message Session Callback</h4></div></div></div>

<p>The <code class="literal">MessageSessionCallback&lt;F, T&gt;</code> has been introduced to perform any custom <code class="literal">Session</code> operation(s) with the
<code class="literal">requestMessage</code> context in the <code class="literal">&lt;int-(s)ftp:outbound-gateway/&gt;</code>.</p>
<p>See <a class="xref" href="ftp.html#ftp-session-callback" title="15.10&nbsp;MessageSessionCallback">Section&nbsp;15.10, &#8220;MessageSessionCallback&#8221;</a> and <a class="xref" href="sftp.html#sftp-session-callback" title="27.12&nbsp;MessageSessionCallback">Section&nbsp;27.12, &#8220;MessageSessionCallback&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_websocket_changes_2" href="#_websocket_changes_2"></a>H.3.15&nbsp;Websocket Changes</h3></div></div></div>

<p><code class="literal">WebSocketHandlerDecoratorFactory</code> support has been added to the <code class="literal">ServerWebSocketContainer</code>
to allow chained customization for the internal <code class="literal">WebSocketHandler</code>.
See <a class="xref" href="web-sockets.html#web-sockets-namespace" title="33.5&nbsp;WebSockets Namespace Support">Section&nbsp;33.5, &#8220;WebSockets Namespace Support&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_application_event_adapters_changes" href="#_application_event_adapters_changes"></a>H.3.16&nbsp;Application Event Adapters changes</h3></div></div></div>

<p>The <code class="literal">ApplicationEvent</code> adapters can now operate with <code class="literal">payload</code> as <code class="literal">event</code> directly allow omitting custom
<code class="literal">ApplicationEvent</code> extensions.
The <code class="literal">publish-payload</code> boolean attribute has been introduced on the <code class="literal">&lt;int-event:outbound-channel-adapter&gt;</code> for this
purpose.
See <a class="xref" href="applicationevent.html" title="12.&nbsp;Spring ApplicationEvent Support">Chapter&nbsp;12, <i>Spring ApplicationEvent Support</i></a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="migration-4.0-4.1" href="#migration-4.0-4.1"></a>H.4&nbsp;Changes between 4.0 and 4.1</h2></div></div></div>

<p>Please be sure to also see the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki/Spring-Integration-4.0-to-4.1-Migration-Guide" target="_top">Migration Guide</a> for important changes that might affect your applications.
Migration guides for all versions back to <span class="emphasis"><em>2.1</em></span> can be found on the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki" target="_top">Wiki</a>.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_new_components" href="#_new_components"></a>H.4.1&nbsp;New Components</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-promise-gateway" href="#x4.1-promise-gateway"></a>Promise&lt;?&gt; Gateway</h4></div></div></div>

<p>A Reactor <code class="literal">Promise</code> return type is now supported for Messaging Gateway methods.
See <a class="xref" href="messaging-endpoints-chapter.html#async-gateway" title="8.4.9&nbsp;Asynchronous Gateway">Section&nbsp;8.4.9, &#8220;Asynchronous Gateway&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-web-socket-adapters" href="#x4.1-web-socket-adapters"></a>WebSocket support</h4></div></div></div>

<p>The <span class="emphasis"><em>WebSocket</em></span> module is now available.
It is fully based on the Spring WebSocket and Spring Messaging modules and provides an <code class="literal">&lt;inbound-channel-adapter&gt;</code> and an <code class="literal">&lt;outbound-channel-adapter&gt;</code>.
See <a class="xref" href="web-sockets.html" title="33.&nbsp;WebSockets Support">Chapter&nbsp;33, <i>WebSockets Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-scatter-gather" href="#x4.1-scatter-gather"></a>Scatter-Gather EIP pattern</h4></div></div></div>

<p>The <span class="emphasis"><em>Scatter-Gather</em></span> EIP pattern is now implemented.
See <a class="xref" href="messaging-routing-chapter.html#scatter-gather" title="6.7&nbsp;Scatter-Gather">Section&nbsp;6.7, &#8220;Scatter-Gather&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-Routing-Slip" href="#x4.1-Routing-Slip"></a>Routing Slip Pattern</h4></div></div></div>

<p>The <span class="emphasis"><em>Routing Slip</em></span> EIP pattern implementation is now provided.
See <a class="xref" href="messaging-routing-chapter.html#routing-slip" title="Routing Slip">the section called &#8220;Routing Slip&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-idempotent-receiver" href="#x4.1-idempotent-receiver"></a>Idempotent Receiver Pattern</h4></div></div></div>

<p>The <span class="emphasis"><em>Idempotent Receiver</em></span> EIP implementation is now provided via the <code class="literal">&lt;idempotent-receiver&gt;</code> component in XML, or the <code class="literal">IdempotentReceiverInterceptor</code> and <code class="literal">IdempotentReceiver</code> annotation when using Java Configuration.
See <a class="xref" href="messaging-endpoints-chapter.html#idempotent-receiver" title="8.9.10&nbsp;Idempotent Receiver Enterprise Integration Pattern">Section&nbsp;8.9.10, &#8220;Idempotent Receiver Enterprise Integration Pattern&#8221;</a> and their JavaDocs for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-BoonJsonObjectMapper" href="#x4.1-BoonJsonObjectMapper"></a>BoonJsonObjectMapper</h4></div></div></div>

<p>The <span class="emphasis"><em>Boon</em></span>`JsonObjectMapper` is now provided for the JSON transformers.
See <a class="xref" href="messaging-transformation-chapter.html#transformer" title="7.1&nbsp;Transformer">Section&nbsp;7.1, &#8220;Transformer&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-redis-queue-gateways" href="#x4.1-redis-queue-gateways"></a>Redis Queue Gateways</h4></div></div></div>

<p>The <code class="literal">&lt;redis-queue-inbound-gateway&gt;</code> and <code class="literal">&lt;redis-queue-outbound-gateway&gt;</code> components are now provided.
See <a class="xref" href="redis.html#redis-queue-inbound-gateway" title="24.10&nbsp;Redis Queue Inbound Gateway">Section&nbsp;24.10, &#8220;Redis Queue Inbound Gateway&#8221;</a> and <a class="xref" href="redis.html#redis-queue-outbound-gateway" title="24.9&nbsp;Redis Queue Outbound Gateway">Section&nbsp;24.9, &#8220;Redis Queue Outbound Gateway&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-PollSkipAdvice" href="#x4.1-PollSkipAdvice"></a>PollSkipAdvice</h4></div></div></div>

<p>The <code class="literal">PollSkipAdvice</code> is now provided to be used within <code class="literal">&lt;advice-chain&gt;</code> of the <code class="literal">&lt;poller&gt;</code> to determine if the current <span class="emphasis"><em>poll</em></span> should be suppressed (skipped) by some condition implemented with <code class="literal">PollSkipStrategy</code>.
See <a class="xref" href="messaging-channels-section.html#polling-consumer" title="4.2&nbsp;Poller">Section&nbsp;4.2, &#8220;Poller&#8221;</a> for more information.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.1-general" href="#x4.1-general"></a>H.4.2&nbsp;General Changes</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-amqp-inbound-missing-queues" href="#x4.1-amqp-inbound-missing-queues"></a>AMQP Inbound Endpoints, Channel</h4></div></div></div>

<p>Elements that utilize a message listener container (inbound endpoints, channel) now support the <code class="literal">missing-queues-fatal</code> attribute.
See <a class="xref" href="amqp.html" title="11.&nbsp;AMQP Support">Chapter&nbsp;11, <i>AMQP Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-amqp-outbound-lazy-connect" href="#x4.1-amqp-outbound-lazy-connect"></a>AMQP Outbound Endpoints</h4></div></div></div>

<p>The AMQP outbound endpoints support a new property <code class="literal">lazy-connect</code> (default true).
When true, the connection to the broker is not established until the first message arrives (assuming there are no inbound endpoints, which always attempt to establish the connection during startup).
When set the <span class="emphasis"><em>false</em></span> an attempt to establish the connection is made during application startup.
See <a class="xref" href="amqp.html" title="11.&nbsp;AMQP Support">Chapter&nbsp;11, <i>AMQP Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-sms-copy-on-get" href="#x4.1-sms-copy-on-get"></a>SimpleMessageStore</h4></div></div></div>

<p>The <code class="literal">SimpleMessageStore</code> no longer makes a copy of the group when calling <code class="literal">getMessageGroup()</code>.
See <a class="xref" href="system-management-chapter.html#sms-caution" title="Caution with SimpleMessageStore">Caution with SimpleMessageStore</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-ws-encode-uri" href="#x4.1-ws-encode-uri"></a>Web Service Outbound Gateway: encode-uri</h4></div></div></div>

<p>The <code class="literal">&lt;ws:outbound-gateway/&gt;</code> now provides an <code class="literal">encode-uri</code> attribute to allow disabling the encoding of the URI object before sending the request.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-http-status-code" href="#x4.1-http-status-code"></a>Http Inbound Channel Adapter and StatusCode</h4></div></div></div>

<p>The <code class="literal">&lt;http:inbound-channel-adapter&gt;</code> can now be configured with a <code class="literal">status-code-expression</code> to override the default <code class="literal">200 OK</code> status.
See <a class="xref" href="http.html#http-namespace" title="17.4&nbsp;HTTP Namespace Support">Section&nbsp;17.4, &#8220;HTTP Namespace Support&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-mqtt" href="#x4.1-mqtt"></a>MQTT Adapter Changes</h4></div></div></div>

<p>The MQTT channel adapters can now be configured to connect to multiple servers, for example, to support High Availability (HA).
See <a class="xref" href="mqtt.html" title="23.&nbsp;MQTT Support">Chapter&nbsp;23, <i>MQTT Support</i></a> for more information.</p>
<p>The MQTT message-driven channel adapter now supports specifying the QoS setting for each subscription.
See <a class="xref" href="mqtt.html#mqtt-inbound" title="23.2&nbsp;Inbound (message-driven) Channel Adapter">Section&nbsp;23.2, &#8220;Inbound (message-driven) Channel Adapter&#8221;</a> for more information.</p>
<p>The MQTT outbound channel adapter now supports asynchronous sends, avoiding blocking until delivery is confirmed.
See <a class="xref" href="mqtt.html#mqtt-outbound" title="23.3&nbsp;Outbound Channel Adapter">Section&nbsp;23.3, &#8220;Outbound Channel Adapter&#8221;</a> for more information.</p>
<p>It is now possible to programmatically subscribe to and unsubscribe from topics at runtime.
See <a class="xref" href="mqtt.html#mqtt-inbound" title="23.2&nbsp;Inbound (message-driven) Channel Adapter">Section&nbsp;23.2, &#8220;Inbound (message-driven) Channel Adapter&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-sftp" href="#x4.1-sftp"></a>FTP/SFTP Adapter Changes</h4></div></div></div>

<p>The FTP and SFTP outbound channel adapters now support appending to remote files, as well as taking specific actions when a remote file already exists.
The remote file templates now also support this as well as <code class="literal">rmdir()</code> and <code class="literal">exists()</code>.
In addition, the remote file templates provide access to the underlying client object enabling access to low-level APIs.</p>
<p>See <a class="xref" href="ftp.html" title="15.&nbsp;FTP/FTPS Adapters">Chapter&nbsp;15, <i>FTP/FTPS Adapters</i></a> and <a class="xref" href="sftp.html" title="27.&nbsp;SFTP Adapters">Chapter&nbsp;27, <i>SFTP Adapters</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-splitter-iterator" href="#x4.1-splitter-iterator"></a>Splitter and Iterator</h4></div></div></div>

<p><code class="literal">Splitter</code> components now support an <code class="literal">Iterator</code> as the result object for producing output messages.
See <a class="xref" href="messaging-routing-chapter.html#splitter" title="6.3&nbsp;Splitter">Section&nbsp;6.3, &#8220;Splitter&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-aggregator" href="#x4.1-aggregator"></a>Aggregator</h4></div></div></div>

<p><code class="literal">Aggregator</code> s now support a new attribute <code class="literal">expire-groups-upon-timeout</code>.
See <a class="xref" href="messaging-routing-chapter.html#aggregator-config" title="6.4.4&nbsp;Configuring an Aggregator">Section&nbsp;6.4.4, &#8220;Configuring an Aggregator&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-content-enricher-improvement" href="#x4.1-content-enricher-improvement"></a>Content Enricher Improvements</h4></div></div></div>

<p>An <code class="literal">null-result-expression</code> attribute has been added, which is evaluated and returned if <code class="literal">&lt;enricher&gt;</code> returns <code class="literal">null</code>.
It can be added in <code class="literal">&lt;header&gt;</code> and <code class="literal">&lt;property&gt;</code>.
See <a class="xref" href="messaging-transformation-chapter.html#content-enricher" title="7.2&nbsp;Content Enricher">Section&nbsp;7.2, &#8220;Content Enricher&#8221;</a> for more information.</p>
<p>An <code class="literal">error-channel</code> attribute has been added, which is used to handle an error flow if <code class="literal">Exception</code> occurs downstream of the <code class="literal">request-channel</code>.
This enable you to return an alternative object to use for enrichment.
See <a class="xref" href="messaging-transformation-chapter.html#content-enricher" title="7.2&nbsp;Content Enricher">Section&nbsp;7.2, &#8220;Content Enricher&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-header-channel-registry" href="#x4.1-header-channel-registry"></a>Header Channel Registry</h4></div></div></div>

<p>The <code class="literal">&lt;header-enricher/&gt;</code>'s <code class="literal">&lt;header-channels-to-string/&gt;</code> element can now override the header channel registry&#8217;s default time for retaining channel mappings.
See <a class="xref" href="messaging-transformation-chapter.html#header-channel-registry" title="Header Channel Registry">the section called &#8220;Header Channel Registry&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-orderly-shutdown" href="#x4.1-orderly-shutdown"></a>Orderly Shutdown</h4></div></div></div>

<p>Improvements have been made to the orderly shutdown algorithm.
See <a class="xref" href="system-management-chapter.html#jmx-shutdown" title="9.7&nbsp;Orderly Shutdown">Section&nbsp;9.7, &#8220;Orderly Shutdown&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-recipientListRouter" href="#x4.1-recipientListRouter"></a>Management for RecipientListRouter</h4></div></div></div>

<p>The <code class="literal">RecipientListRouter</code> provides now several <span class="emphasis"><em>management</em></span> operations to configure <span class="emphasis"><em>recipients</em></span> at runtime.
With that the <code class="literal">&lt;recipient-list-router&gt;</code> can now be configured without any <code class="literal">&lt;recipient&gt;</code> from the start.
See <a class="xref" href="messaging-routing-chapter.html#recipient-list-router-management" title="RecipientListRouterManagement">the section called &#8220;RecipientListRouterManagement&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-AbstractHeaderMapper-changes" href="#x4.1-AbstractHeaderMapper-changes"></a>AbstractHeaderMapper: NON_STANDARD_HEADERS token</h4></div></div></div>

<p>The <code class="literal">AbstractHeaderMapper</code> implementations now provides the additional <code class="literal">NON_STANDARD_HEADERS</code> token to map any user-defined headers, which aren&#8217;t mapped by default.
See <a class="xref" href="amqp.html#amqp-message-headers" title="11.12&nbsp;AMQP Message Headers">Section&nbsp;11.12, &#8220;AMQP Message Headers&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-amqp-channels" href="#x4.1-amqp-channels"></a>AMQP Channels: template-channel-transacted</h4></div></div></div>

<p>The new <code class="literal">template-channel-transacted</code> attribute has been introduced for AMQP <code class="literal">MessageChannel</code> s.
See <a class="xref" href="amqp.html#amqp-channels" title="11.11&nbsp;AMQP Backed Message Channels">Section&nbsp;11.11, &#8220;AMQP Backed Message Channels&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-syslog" href="#x4.1-syslog"></a>Syslog Adapter</h4></div></div></div>

<p>The default syslog message converter now has an option to retain the original message in the payload, while still setting the headers.
See <a class="xref" href="syslog.html#syslog-inbound-adapter" title="30.2&nbsp;Syslog <inbound-channel-adapter&gt;">Section&nbsp;30.2, &#8220;Syslog &lt;inbound-channel-adapter&gt;&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-async-gateway" href="#x4.1-async-gateway"></a>Async Gateway</h4></div></div></div>

<p>In addition to the <code class="literal">Promise</code> return type mentioned above, gateway methods may now return a <code class="literal">ListenableFuture</code>, introduced in Spring Framework 4.0.
You can also disable the async processing in the gateway, allowing a downstream flow to directly return a <code class="literal">Future</code>.
See <a class="xref" href="messaging-endpoints-chapter.html#async-gateway" title="8.4.9&nbsp;Asynchronous Gateway">Section&nbsp;8.4.9, &#8220;Asynchronous Gateway&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-aggregator-advice-chain" href="#x4.1-aggregator-advice-chain"></a>Aggregator Advice Chain</h4></div></div></div>

<p><code class="literal">Aggregator</code> s and <code class="literal">Resequencer</code> s now support an <code class="literal">&lt;expire-advice-chain/&gt;</code> and <code class="literal">&lt;expire-transactional/&gt;</code> sub-elements to <span class="emphasis"><em>advise</em></span> the <code class="literal">forceComplete</code> operation.
See <a class="xref" href="messaging-routing-chapter.html#aggregator-config" title="6.4.4&nbsp;Configuring an Aggregator">Section&nbsp;6.4.4, &#8220;Configuring an Aggregator&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-script-outbound-channel-adapter" href="#x4.1-script-outbound-channel-adapter"></a>Outbound Channel Adapter and Scripts</h4></div></div></div>

<p>The <code class="literal">&lt;int:outbound-channel-adapter/&gt;</code> now supports the <code class="literal">&lt;script/&gt;</code> sub-element.
The underlying script must have a <code class="literal">void</code> return type or return <code class="literal">null</code>.
See <a class="xref" href="messaging-endpoints-chapter.html#groovy" title="8.8&nbsp;Groovy support">Section&nbsp;8.8, &#8220;Groovy support&#8221;</a> and <a class="xref" href="messaging-endpoints-chapter.html#scripting" title="8.7&nbsp;Scripting support">Section&nbsp;8.7, &#8220;Scripting support&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-reseq" href="#x4.1-reseq"></a>Resequencer Changes</h4></div></div></div>

<p>When a message group in a resequencer is timed out (using <code class="literal">group-timeout</code> or a <code class="literal">MessageGroupStoreReaper</code>), late arriving messages will now be discarded immediately by default.
See <a class="xref" href="messaging-routing-chapter.html#resequencer" title="6.5&nbsp;Resequencer">Section&nbsp;6.5, &#8220;Resequencer&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-Optional-Parameter" href="#x4.1-Optional-Parameter"></a>Optional POJO method parameter</h4></div></div></div>

<p>Now Spring Integration consistently handles the Java 8&#8217;s <code class="literal">Optional</code> type.
See <a class="xref" href="messaging-endpoints-chapter.html#service-activator-namespace" title="8.5.2&nbsp;Configuring Service Activator">Section&nbsp;8.5.2, &#8220;Configuring Service Activator&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-queue-channel-queue.typ" href="#x4.1-queue-channel-queue.typ"></a>QueueChannel: backed Queue type</h4></div></div></div>

<p>The <code class="literal">QueueChannel</code> backed <code class="literal">Queue type</code> has been changed from <code class="literal">BlockingQueue</code> to the more generic <code class="literal">Queue</code>.
It allows the use of any external <code class="literal">Queue</code> implementation, for example Reactor&#8217;s <code class="literal">PersistentQueue</code>.
See <a class="xref" href="messaging-channels-section.html#channel-configuration-queuechannel" title="QueueChannel Configuration">the section called &#8220;QueueChannel Configuration&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-channel-interceptor" href="#x4.1-channel-interceptor"></a>ChannelInterceptor Changes</h4></div></div></div>

<p>The <code class="literal">ChannelInterceptor</code> now supports additional <code class="literal">afterSendCompletion()</code> and <code class="literal">afterReceiveCompletion()</code> methods.
See <a class="xref" href="messaging-channels-section.html#channel-interceptors" title="4.1.3&nbsp;Channel Interceptors">Section&nbsp;4.1.3, &#8220;Channel Interceptors&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.1-mail-peek" href="#x4.1-mail-peek"></a>IMAP PEEK</h4></div></div></div>

<p>Since <span class="emphasis"><em>version 4.1.1</em></span> there is a change of behavior if you explicitly set the javamail property <code class="literal">mail.[protocol].peek</code> to <code class="literal">false</code> (where <code class="literal">[protocol]</code> is <code class="literal">imap</code> or <code class="literal">imaps</code>).
See <a class="xref" href="mail.html#imap-peek" title="Important: IMAP PEEK">Important: IMAP PEEK</a>.</p>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="migration-3.0-4.0" href="#migration-3.0-4.0"></a>H.5&nbsp;Changes between 3.0 and 4.0</h2></div></div></div>

<p>Please be sure to also see the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki/Spring-Integration-3.0-to-4.0-Migration-Guide" target="_top">Migration Guide</a> for important changes that might affect your applications.
Migration guides for all versions back to <span class="emphasis"><em>2.1</em></span> can be found on the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki" target="_top">Wiki</a>.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.0-new-components" href="#x4.0-new-components"></a>H.5.1&nbsp;New Components</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-mqtt" href="#x4.0-mqtt"></a>MQTT Channel Adapters</h4></div></div></div>

<p>The MQTT channel adapters (previously available in the Spring Integration Extensions repository) are now available as part of the normal Spring Integration distribution.
See <a class="xref" href="mqtt.html" title="23.&nbsp;MQTT Support">Chapter&nbsp;23, <i>MQTT Support</i></a></p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-enable-configuration" href="#x4.0-enable-configuration"></a>@EnableIntegration</h4></div></div></div>

<p>The <code class="literal">@EnableIntegration</code> annotation has been added, to permit declaration of standard Spring Integration beans when using <code class="literal">@Configuration</code> classes.
See <a class="xref" href="configuration.html#annotations" title="F.6&nbsp;Annotation Support">Section&nbsp;F.6, &#8220;Annotation Support&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-component-scan" href="#x4.0-component-scan"></a>@IntegrationComponentScan</h4></div></div></div>

<p>The <code class="literal">@IntegrationComponentScan</code> annotation has been added, to permit classpath scanning for Spring Integration specific components.
See <a class="xref" href="configuration.html#annotations" title="F.6&nbsp;Annotation Support">Section&nbsp;F.6, &#8220;Annotation Support&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-message-history" href="#x4.0-message-history"></a>@EnableMessageHistory</h4></div></div></div>

<p>Message history can now be enabled with the <code class="literal">@EnableMessageHistory</code> annotation in a <code class="literal">@Configuration</code> class; in addition the message history settings can be modified by a JMX MBean.
In addition auto-created <code class="literal">MessageHandler</code> s for annotated endpoints (e.g.
<code class="literal">@ServiceActivator</code>, <code class="literal">@Splitter</code> etc.) now are also trackable by <code class="literal">MessageHistory</code>.
For more information, see <a class="xref" href="system-management-chapter.html#message-history" title="9.3&nbsp;Message History">Section&nbsp;9.3, &#8220;Message History&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-messaging-gateway" href="#x4.0-messaging-gateway"></a>@MessagingGateway</h4></div></div></div>

<p>Messaging gateway interfaces can now be configured with the <code class="literal">@MessagingGateway</code> annotation.
It is an analogue of the <code class="literal">&lt;int:gateway/&gt;</code> xml element.
For more information, see <a class="xref" href="messaging-endpoints-chapter.html#messaging-gateway-annotation" title="8.4.6&nbsp;@MessagingGateway Annotation">Section&nbsp;8.4.6, &#8220;@MessagingGateway Annotation&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-boot" href="#x4.0-boot"></a>Spring Boot @EnableAutoConfiguration</h4></div></div></div>

<p>As well as the <code class="literal">@EnableIntegration</code> annotation mentioned above, a a hook has been introduced to allow the Spring Integration infrastructure beans to be configured using Spring Boot&#8217;s <code class="literal">@EnableAutoConfiguration</code>.
For more information seehttp://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-auto-configuration.html[Spring Boot - AutoConfigure].</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-global-channel-interceptor" href="#x4.0-global-channel-interceptor"></a>@GlobalChannelInterceptor</h4></div></div></div>

<p>As well as the <code class="literal">@EnableIntegration</code> annotation mentioned above, the <code class="literal">@GlobalChannelInterceptor</code> annotation has bean introduced.
For more information, see <a class="xref" href="configuration.html#annotations" title="F.6&nbsp;Annotation Support">Section&nbsp;F.6, &#8220;Annotation Support&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-integration-converter" href="#x4.0-integration-converter"></a>@IntegrationConverter</h4></div></div></div>

<p>The <code class="literal">@IntegrationConverter</code> annotation has bean introduced, as an analogue of <code class="literal">&lt;int:converter/&gt;</code> component.
For more information, see <a class="xref" href="configuration.html#annotations" title="F.6&nbsp;Annotation Support">Section&nbsp;F.6, &#8220;Annotation Support&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-enable-publisher" href="#x4.0-enable-publisher"></a>@EnablePublisher</h4></div></div></div>

<p>The <code class="literal">@EnablePublisher</code> annotation has been added, to allow the specification of a <code class="literal">default-publisher-channel</code> for <code class="literal">@Publisher</code> annotations.
See <a class="xref" href="configuration.html#annotations" title="F.6&nbsp;Annotation Support">Section&nbsp;F.6, &#8220;Annotation Support&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-redis-cms" href="#x4.0-redis-cms"></a>Redis Channel Message Stores</h4></div></div></div>

<p>A new Redis <code class="literal">MessageGroupStore</code>, that is optimized for use when backing a <code class="literal">QueueChannel</code> for persistence, is now provided.
For more information, see <a class="xref" href="redis.html#redis-cms" title="24.4.1&nbsp;Redis Channel Message Stores">Section&nbsp;24.4.1, &#8220;Redis Channel Message Stores&#8221;</a>.</p>
<p>A new Redis <code class="literal">ChannelPriorityMessageStore</code> is now provided.
This can be used to retrieve messages by priority.
For more information, see <a class="xref" href="redis.html#redis-cms" title="24.4.1&nbsp;Redis Channel Message Stores">Section&nbsp;24.4.1, &#8220;Redis Channel Message Stores&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-priority-channel-mondodb" href="#x4.0-priority-channel-mondodb"></a>MongodDB Channel Message Store</h4></div></div></div>

<p>MongoDB support now provides the <code class="literal">MongoDbChannelMessageStore</code> - a <span class="emphasis"><em>channel</em></span> specific <code class="literal">MessageStore</code> implementation.
With <code class="literal">priorityEnabled = true</code>, it can be used in <code class="literal">&lt;int:priority-queue&gt;</code> s to achieve <span class="emphasis"><em>priority</em></span> order polling of persisted messages.
For more information see <a class="xref" href="mongodb.html#mongodb-priority-channel-message-store" title="22.3.1&nbsp;MongoDB Channel Message Store">Section&nbsp;22.3.1, &#8220;MongoDB Channel Message Store&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-MBeanExport-annotation" href="#x4.0-MBeanExport-annotation"></a>@EnableIntegrationMBeanExport</h4></div></div></div>

<p>The <code class="literal">IntegrationMBeanExporter</code> can now be enabled with the <code class="literal">@EnableIntegrationMBeanExport</code> annotation in a <code class="literal">@Configuration</code> class.
For more information, see <a class="xref" href="system-management-chapter.html#jmx-mbean-exporter" title="9.2.7&nbsp;MBean Exporter">Section&nbsp;9.2.7, &#8220;MBean Exporter&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-channel-security-interceptor" href="#x4.0-channel-security-interceptor"></a>ChannelSecurityInterceptorFactoryBean</h4></div></div></div>

<p>Configuration of Spring Security for message channels using <code class="literal">@Configuration</code> classes is now supported by using a <code class="literal">ChannelSecurityInterceptorFactoryBean</code>.
For more information, see <a class="xref" href="security.html" title="Appendix&nbsp;D.&nbsp;Security in Spring Integration">Appendix&nbsp;D, <i>Security in Spring Integration</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-redis-outbound-gateway" href="#x4.0-redis-outbound-gateway"></a>Redis Command Gateway</h4></div></div></div>

<p>The Redis support now provides the <code class="literal">&lt;outbound-gateway&gt;</code> component to perform generic Redis commands using the <code class="literal">RedisConnection#execute</code> method.
For more information, see <a class="xref" href="redis.html#redis-outbound-gateway" title="24.8&nbsp;Redis Outbound Command Gateway">Section&nbsp;24.8, &#8220;Redis Outbound Command Gateway&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-redis-gemfire-lock-registry" href="#x4.0-redis-gemfire-lock-registry"></a>RedisLockRegistry and GemfireLockRegistry</h4></div></div></div>

<p>The <code class="literal">RedisLockRegistry</code> and <code class="literal">GemfireLockRegistry</code> are now available supporting global locks visible to multiple application instances/servers.
These can be used with aggregating message handlers across multiple application instances such that group release will occur on only one instance.
For more information, see <a class="xref" href="redis.html#redis-lock-registry" title="24.11&nbsp;Redis Lock Registry">Section&nbsp;24.11, &#8220;Redis Lock Registry&#8221;</a>, <a class="xref" href="gemfire.html#gemfire-lock-registry" title="16.6&nbsp;Gemfire Lock Registry">Section&nbsp;16.6, &#8220;Gemfire Lock Registry&#8221;</a> and <a class="xref" href="messaging-routing-chapter.html#aggregator" title="6.4&nbsp;Aggregator">Section&nbsp;6.4, &#8220;Aggregator&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-poller-annotation" href="#x4.0-poller-annotation"></a>@Poller</h4></div></div></div>

<p>Annotation-based messaging configuration can now have a <code class="literal">poller</code> attribute.
This means that methods annotated with (<code class="literal">@ServiceActivator</code>, <code class="literal">@Aggregator</code> etc.) can now use an <code class="literal">inputChannel</code> that is a reference to a <code class="literal">PollableChannel</code>.
For more information, see <a class="xref" href="configuration.html#annotations" title="F.6&nbsp;Annotation Support">Section&nbsp;F.6, &#8220;Annotation Support&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-inbound-channel-adapter-annotation" href="#x4.0-inbound-channel-adapter-annotation"></a>@InboundChannelAdapter and SmartLifecycle for Annotated Endpoints</h4></div></div></div>

<p>The <code class="literal">@InboundChannelAdapter</code> method annotation is now available.
It is an analogue of the <code class="literal">&lt;int:inbound-channel-adapter&gt;</code> XML component.
In addition, all Messaging Annotations now provide <code class="literal">SmartLifecycle</code> options.
For more information, see <a class="xref" href="configuration.html#annotations" title="F.6&nbsp;Annotation Support">Section&nbsp;F.6, &#8220;Annotation Support&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-twitter-sog" href="#x4.0-twitter-sog"></a>Twitter Search Outbound Gateway</h4></div></div></div>

<p>A new twitter endpoint <code class="literal">&lt;int-twitter-search-outbound-gateway/&gt;</code> has been added.
Unlike the search inbound adapter which polls using the same search query each time, the outbound gateway allows on-demand customized queries.
For more information, see <a class="xref" href="twitter.html#twitter-sog" title="32.6&nbsp;Twitter Search Outbound Gateway">Section&nbsp;32.6, &#8220;Twitter Search Outbound Gateway&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-gemfire-metadata" href="#x4.0-gemfire-metadata"></a>Gemfire Metadata Store</h4></div></div></div>

<p>The <code class="literal">GemfireMetadataStore</code> is provided, allowing it to be used, for example, in a <code class="literal">AbstractPersistentAcceptOnceFileListFilter</code> implementation in a multiple application instance/server environment.
For more information, see <a class="xref" href="system-management-chapter.html#metadata-store" title="9.5&nbsp;Metadata Store">Section&nbsp;9.5, &#8220;Metadata Store&#8221;</a>, <a class="xref" href="files.html#file-reading" title="14.2&nbsp;Reading Files">Section&nbsp;14.2, &#8220;Reading Files&#8221;</a>, <a class="xref" href="ftp.html#ftp-inbound" title="15.4&nbsp;FTP Inbound Channel Adapter">Section&nbsp;15.4, &#8220;FTP Inbound Channel Adapter&#8221;</a> and <a class="xref" href="sftp.html#sftp-inbound" title="27.7&nbsp;SFTP Inbound Channel Adapter">Section&nbsp;27.7, &#8220;SFTP Inbound Channel Adapter&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-bridge-annotations" href="#x4.0-bridge-annotations"></a>@BridgeFrom and @BridgeTo Annotations</h4></div></div></div>

<p>Annotation and Java configuration has introduced <code class="literal">@BridgeFrom</code> and <code class="literal">@BridgeTo</code> <code class="literal">@Bean</code> method annotations to mark <code class="literal">MessageChannel</code> beans in <code class="literal">@Configuration</code> classes.
For more information, see <a class="xref" href="configuration.html#annotations" title="F.6&nbsp;Annotation Support">Section&nbsp;F.6, &#8220;Annotation Support&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-meta-messaging-annotations" href="#x4.0-meta-messaging-annotations"></a>Meta Messaging Annotations</h4></div></div></div>

<p>Messaging Annotations (<code class="literal">@ServiceActivator</code>, <code class="literal">@Router</code>, <code class="literal">@MessagingGateway</code> etc.) can now be configured as meta-annotations for user-defined Messaging Annotations.
In addition the user-defined annotations can have the same attributes (<code class="literal">inputChannel</code>, <code class="literal">@Poller</code>, <code class="literal">autoStartup</code> etc.).
For more information, see <a class="xref" href="configuration.html#annotations" title="F.6&nbsp;Annotation Support">Section&nbsp;F.6, &#8220;Annotation Support&#8221;</a>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x4.0-general" href="#x4.0-general"></a>H.5.2&nbsp;General Changes</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_requires_spring_framework_4_0" href="#_requires_spring_framework_4_0"></a>Requires Spring Framework 4.0</h4></div></div></div>

<p>Core messaging abstractions (<code class="literal">Message</code>, <code class="literal">MessageChannel</code> etc) have moved to the Spring Framework <code class="literal">spring-messaging</code> module.
Users who reference these classes directly in their code will need to make changes as described in the first section of the <a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki/Spring-Integration-3.0-to-4.0-Migration-Guide" target="_top">Migration Guide</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-xpath-header-enricher-header-type" href="#x4.0-xpath-header-enricher-header-type"></a>Header Type for XPath Header Enricher</h4></div></div></div>

<p>The <code class="literal">header-type</code> attribute has been introduced for the <code class="literal">header</code> sub-element of the <code class="literal">&lt;int-xml:xpath-header-enricher&gt;</code>.
This attribute provides the target type for the header value to which the result of the XPath expression evaluation will be converted.
For more information see <a class="xref" href="xml.html#xml-xpath-header-enricher" title="35.7&nbsp;XPath Header Enricher">Section&nbsp;35.7, &#8220;XPath Header Enricher&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-object-to-json-transformer-result-type" href="#x4.0-object-to-json-transformer-result-type"></a>Object To Json Transformer: Node Result</h4></div></div></div>

<p>The <code class="literal">result-type</code> attribute has been introduced for the <code class="literal">&lt;int:object-to-json-transformer&gt;</code>.
This attribute provides the target type for the result of object mapping to JSON.
It supports <code class="literal">STRING</code> (default) and <code class="literal">NODE</code>.
For more information see <a class="xref" href="messaging-transformation-chapter.html#transformer-xpath-spel-function">the section called &#8220;JSON Transformers&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-jms-header-mapping" href="#x4.0-jms-header-mapping"></a>JMS Header Mapping</h4></div></div></div>

<p>The <code class="literal">DefaultJmsHeaderMapper</code> now maps an incoming <code class="literal">JMSPriority</code> header to the Spring Integration <code class="literal">priority</code> header.
Previously <code class="literal">priority</code> was only considered for outbound messages.
For more information see <a class="xref" href="jms.html#jms-header-mapping" title="20.6&nbsp;Mapping Message Headers to/from JMS Message">Section&nbsp;20.6, &#8220;Mapping Message Headers to/from JMS Message&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-jms-ob" href="#x4.0-jms-ob"></a>JMS Outbound Channel Adapter</h4></div></div></div>

<p>The JMS outbound channel adapter now supports the <code class="literal">session-transacted</code> attribute (default false).
Previously, you had to inject a customized <code class="literal">JmsTemplate</code> to use transactions.
See <a class="xref" href="jms.html#jms-outbound-channel-adapter" title="20.3&nbsp;Outbound Channel Adapter">Section&nbsp;20.3, &#8220;Outbound Channel Adapter&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-jms-ib" href="#x4.0-jms-ib"></a>JMS Inbound Channel Adapter</h4></div></div></div>

<p>The JMS inbound channel adapter now supports the <code class="literal">session-transacted</code> attribute (default false).
Previously, you had to inject a customized <code class="literal">JmsTemplate</code> to use transactions (the adapter allowed <span class="emphasis"><em>transacted</em></span> in the acknowledgeMode which was incorrect, and didn&#8217;t work; this value is no longer allowed).
See<a class="xref" href="jms.html#jms-inbound-channel-adapter" title="20.1&nbsp;Inbound Channel Adapter">Section&nbsp;20.1, &#8220;Inbound Channel Adapter&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-datatype-channel" href="#x4.0-datatype-channel"></a>Datatype Channels</h4></div></div></div>

<p>You can now specify a <code class="literal">MessageConverter</code> to be used when converting (if necessary) payloads to one of the accepted <code class="literal">datatype</code> s in a Datatype channel.
For more information see <a class="xref" href="messaging-channels-section.html#channel-datatype-channel" title="Datatype Channel Configuration">the section called &#8220;Datatype Channel Configuration&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-retry-config" href="#x4.0-retry-config"></a>Simpler Retry Advice Configuration</h4></div></div></div>

<p>Simplified namespace support has been added to configure a <code class="literal">RequestHandlerRetryAdvice</code>.
For more information see <a class="xref" href="messaging-endpoints-chapter.html#retry-config" title="Configuring the Retry Advice">the section called &#8220;Configuring the Retry Advice&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-release-strategy-group-timeout" href="#x4.0-release-strategy-group-timeout"></a>Correlation Endpoint: Time-based Release Strategy</h4></div></div></div>

<p>The mutually exclusive <code class="literal">group-timeout</code> and <code class="literal">group-timeout-expression</code> attributes have been added to the <code class="literal">&lt;int:aggregator&gt;</code> and <code class="literal">&lt;int:resequencer&gt;</code>.
These attributes allow forced completion of a partial <code class="literal">MessageGroup</code>, if the <code class="literal">ReleaseStrategy</code> does not release a group and no further messages arrive within the time specified.
For more information see <a class="xref" href="messaging-routing-chapter.html#aggregator-config" title="6.4.4&nbsp;Configuring an Aggregator">Section&nbsp;6.4.4, &#8220;Configuring an Aggregator&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-redis-metadata" href="#x4.0-redis-metadata"></a>Redis Metadata Store</h4></div></div></div>

<p>The <code class="literal">RedisMetadataStore</code> now implements <code class="literal">ConcurrentMetadataStore</code>, allowing it to be used, for example, in a <code class="literal">AbstractPersistentAcceptOnceFileListFilter</code> implementation in a multiple application instance/server environment.
For more information, see <a class="xref" href="redis.html#redis-metadata-store" title="24.5&nbsp;Redis Metadata Store">Section&nbsp;24.5, &#8220;Redis Metadata Store&#8221;</a>, <a class="xref" href="files.html#file-reading" title="14.2&nbsp;Reading Files">Section&nbsp;14.2, &#8220;Reading Files&#8221;</a>, <a class="xref" href="ftp.html#ftp-inbound" title="15.4&nbsp;FTP Inbound Channel Adapter">Section&nbsp;15.4, &#8220;FTP Inbound Channel Adapter&#8221;</a> and <a class="xref" href="sftp.html#sftp-inbound" title="27.7&nbsp;SFTP Inbound Channel Adapter">Section&nbsp;27.7, &#8220;SFTP Inbound Channel Adapter&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-jdbc-cs" href="#x4.0-jdbc-cs"></a>JdbcChannelMessageStore and PriorityChannel</h4></div></div></div>

<p>The <code class="literal">JdbcChannelMessageStore</code> now implements <code class="literal">PriorityCapableChannelMessageStore</code>, allowing it to be used as a <code class="literal">message-store</code> reference for <code class="literal">priority-queue</code> s.
For more information, see <a class="xref" href="jdbc.html#jdbc-message-store-channels" title="18.4.2&nbsp;Backing Message Channels">Section&nbsp;18.4.2, &#8220;Backing Message Channels&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-amqp" href="#x4.0-amqp"></a>AMQP Endpoints Delivery Mode</h4></div></div></div>

<p>Spring AMQP, by default, creates persistent messages on the broker.
This behavior can be overridden by setting the <code class="literal">amqp_deliveryMode</code> header and/or customizing the mappers.
A convenient <code class="literal">default-delivery-mode</code> attribute has now been added to the adapters to provide easier configuration of this important setting.
For more information, see <a class="xref" href="amqp.html#amqp-outbound-channel-adapter" title="11.5&nbsp;Outbound Channel Adapter">Section&nbsp;11.5, &#8220;Outbound Channel Adapter&#8221;</a> and <a class="xref" href="amqp.html#amqp-outbound-gateway" title="11.6&nbsp;Outbound Gateway">Section&nbsp;11.6, &#8220;Outbound Gateway&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-ftp" href="#x4.0-ftp"></a>FTP Timeouts</h4></div></div></div>

<p>The <code class="literal">DefaultFtpSessionFactory</code> now exposes the <code class="literal">connectTimeout</code>, <code class="literal">defaultTimeout</code> and <code class="literal">dataTimeout</code> properties, avoiding the need to subclass the factory just to set these common properties.
The <code class="literal">postProcess*</code> methods are still available for more advanced configuration.
See <a class="xref" href="ftp.html#ftp-session-factory" title="15.2&nbsp;FTP Session Factory">Section&nbsp;15.2, &#8220;FTP Session Factory&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-twitter-status-updating" href="#x4.0-twitter-status-updating"></a>Twitter: StatusUpdatingMessageHandler</h4></div></div></div>

<p>The <code class="literal">StatusUpdatingMessageHandler</code> (<code class="literal">&lt;int-twitter:outbound-channel-adapter&gt;</code>) now supports the <code class="literal">tweet-data-expression</code> attribute to build a <code class="literal">org.springframework.social.twitter.api.TweetData</code> object for updating the timeline status allowing, for example, attaching an image.
See <a class="xref" href="twitter.html#outbound-twitter-update" title="32.5.1&nbsp;Twitter Outbound Update Channel Adapter">Section&nbsp;32.5.1, &#8220;Twitter Outbound Update Channel Adapter&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-jpa-id-expression" href="#x4.0-jpa-id-expression"></a>JPA Retrieving Gateway: id-expression</h4></div></div></div>

<p>The <code class="literal">id-expression</code> attribute has been introduced for <code class="literal">&lt;int-jpa:retrieving-outbound-gateway&gt;</code> to perform <code class="literal">EntityManager.find(Class entityClass, Object primaryKey)</code>.
See <a class="xref" href="jpa.html#jpa-retrieving-outbound-gateway" title="19.6.3&nbsp;Retrieving Outbound Gateway">Section&nbsp;19.6.3, &#8220;Retrieving Outbound Gateway&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-tcp-deserializer-events" href="#x4.0-tcp-deserializer-events"></a>TCP Deserialization Events</h4></div></div></div>

<p>When one of the standard deserializers encounters a problem decoding the input stream to a message, it will now emit a <code class="literal">TcpDeserializationExceptionEvent</code>, allowing applications to examine the data at the point the exception occurred.
See <a class="xref" href="ip.html#tcp-events" title="31.5&nbsp;TCP Connection Events">Section&nbsp;31.5, &#8220;TCP Connection Events&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x4.0-bean-messaging-annotations" href="#x4.0-bean-messaging-annotations"></a>Messaging Annotations on @Bean Definitions</h4></div></div></div>

<p>Messaging Annotations (<code class="literal">@ServiceActivator</code>, <code class="literal">@Router</code>, <code class="literal">@InboundChannelAdapter</code> etc.) can now be configured on <code class="literal">@Bean</code> definitions in <code class="literal">@Configuration</code> classes.
For more information, see <a class="xref" href="configuration.html#annotations" title="F.6&nbsp;Annotation Support">Section&nbsp;F.6, &#8220;Annotation Support&#8221;</a>.</p>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="migration-2.2-3.0" href="#migration-2.2-3.0"></a>H.6&nbsp;Changes Between 2.2 and 3.0</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x3.0-new-components" href="#x3.0-new-components"></a>H.6.1&nbsp;New Components</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-request-mapping" href="#x3.0-request-mapping"></a>HTTP Request Mapping</h4></div></div></div>

<p>The HTTP module now provides powerful Request Mapping support for Inbound Endpoints.
Class <code class="literal">UriPathHandlerMapping</code> was replaced by <code class="literal">IntegrationRequestMappingHandlerMapping</code>, which is registered under the bean name <code class="literal">integrationRequestMappingHandlerMapping</code> in the application context.
Upon parsing of the HTTP Inbound Endpoint, a new <code class="literal">IntegrationRequestMappingHandlerMapping</code> bean is either registered or an existing bean is being reused.
To achieve flexible Request Mapping configuration, Spring Integration provides the <code class="literal">&lt;request-mapping/&gt;</code> sub-element for the <code class="literal">&lt;http:inbound-channel-adapter/&gt;</code> and the <code class="literal">&lt;http:inbound-gateway/&gt;</code>.
Both HTTP Inbound Endpoints are now fully based on the Request Mapping infrastructure that was introduced with Spring MVC 3.1.
For example, multiple paths are supported on a single inbound endpoint.
For more information see <a class="xref" href="http.html#http-namespace" title="17.4&nbsp;HTTP Namespace Support">Section&nbsp;17.4, &#8220;HTTP Namespace Support&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-spel-customization" href="#x3.0-spel-customization"></a>Spring Expression Language (SpEL) Configuration</h4></div></div></div>

<p>A new <code class="literal">IntegrationEvaluationContextFactoryBean</code> is provided to allow configuration of custom <code class="literal">PropertyAccessor</code> s and functions for use in SpEL expressions throughout the framework.
For more information see <a class="xref" href="spel.html" title="Appendix&nbsp;A.&nbsp;Spring Expression Language (SpEL)">Appendix&nbsp;A, <i>Spring Expression Language (SpEL)</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-spel-functions" href="#x3.0-spel-functions"></a>SpEL Functions Support</h4></div></div></div>

<p>To customize the SpEL <code class="literal">EvaluationContext</code> with static <code class="literal">Method</code> functions, the new <code class="literal">&lt;spel-function/&gt;</code> component is introduced.
Two built-in functions are also provided (<code class="literal">#jsonPath</code> and <code class="literal">#xpath</code>).
For more information see <a class="xref" href="spel.html#spel-functions" title="A.3&nbsp;SpEL Functions">Section&nbsp;A.3, &#8220;SpEL Functions&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-spel-property-accessors" href="#x3.0-spel-property-accessors"></a>SpEL PropertyAccessors Support</h4></div></div></div>

<p>To customize the SpEL <code class="literal">EvaluationContext</code> with <code class="literal">PropertyAccessor</code> implementations the new <code class="literal">&lt;spel-property-accessors/&gt;</code> component is introduced.
For more information see <a class="xref" href="spel.html#spel-property-accessors" title="A.4&nbsp;PropertyAccessors">Section&nbsp;A.4, &#8220;PropertyAccessors&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-redis-new-components" href="#x3.0-redis-new-components"></a>Redis: New Components</h4></div></div></div>

<p>A new Redis-based <a class="ulink" href="http://docs.spring.io/spring-integration/docs/latest-ga/api/org/springframework/integration/store/MetadataStore.html" target="_top">MetadataStore</a> implementation has been added.
The <code class="literal">RedisMetadataStore</code> can be used to maintain state of a <code class="literal">MetadataStore</code> across application restarts.
This new <code class="literal">MetadataStore</code> implementation can be used with adapters such as:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Twitter Inbound Adapters
</li><li class="listitem">
Feed Inbound Channel Adapter
</li></ul></div>
<p>New queue-based components have been added.
The <code class="literal">&lt;int-redis:queue-inbound-channel-adapter/&gt;</code> and the <code class="literal">&lt;int-redis:queue-outbound-channel-adapter/&gt;</code> components are provided to perform <span class="emphasis"><em>right pop</em></span> and <span class="emphasis"><em>left push</em></span> operations on a Redis List, respectively.</p>
<p>For more information see <a class="xref" href="redis.html" title="24.&nbsp;Redis Support">Chapter&nbsp;24, <i>Redis Support</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-hcr" href="#x3.0-hcr"></a>Header Channel Registry</h4></div></div></div>

<p>It is now possible to instruct the framework to store reply and error channels in a registry for later resolution.
This is useful for cases where the <code class="literal">replyChannel</code> or <code class="literal">errorChannel</code> might be lost; for example when serializing a message.
See <a class="xref" href="messaging-transformation-chapter.html#header-enricher" title="7.2.2&nbsp;Header Enricher">Section&nbsp;7.2.2, &#8220;Header Enricher&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-configurable-mongo-MS" href="#x3.0-configurable-mongo-MS"></a>MongoDB support: New ConfigurableMongoDbMessageStore</h4></div></div></div>

<p>In addition to the existing <code class="literal">eMongoDbMessageStore</code>, a new <code class="literal">ConfigurableMongoDbMessageStore</code> has been introduced.
This provides a more robust and flexible implementation of <code class="literal">MessageStore</code> for MongoDB.
It does not have backward compatibility, with the existing store, but it is recommended to use it for new applications.
Existing applications can use it, but messages in the old store will not be available.
See <a class="xref" href="mongodb.html" title="22.&nbsp;MongoDb Support">Chapter&nbsp;22, <i>MongoDb Support</i></a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-syslog" href="#x3.0-syslog"></a>Syslog Support</h4></div></div></div>

<p>Building on the 2.2 <code class="literal">SyslogToMapTransformer</code> Spring Integration 3.0 now introduces <code class="literal">UDP</code> and <code class="literal">TCP</code> inbound channel adapters especially tailored for receiving SYSLOG messages.
For more information, see<a class="xref" href="syslog.html" title="30.&nbsp;Syslog Support">Chapter&nbsp;30, <i>Syslog Support</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-tail" href="#x3.0-tail"></a><span class="emphasis"><em>Tail</em></span> Support</h4></div></div></div>

<p>File 'tail&#8217;ing inbound channel adapters are now provided to generate messages when lines are added to the end of text files; see <a class="xref" href="files.html#file-tailing" title="14.2.6&nbsp;'Tail&#8217;ing Files">Section&nbsp;14.2.6, &#8220;'Tail&#8217;ing Files&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-jmx" href="#x3.0-jmx"></a>JMX Support</h4></div></div></div>

<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
A new <code class="literal">&lt;int-jmx:tree-polling-channel-adapter/&gt;</code> is provided; this adapter queries the JMX MBean tree and sends a message with a payload that is the graph of objects that matches the query.
By default the MBeans are mapped to primitives and simple Objects like Map, List and arrays - permitting simple transformation, for example, to JSON.
</li><li class="listitem">
The <code class="literal">IntegrationMBeanExporter</code> now allows the configuration of a custom <code class="literal">ObjectNamingStrategy</code> using the <code class="literal">naming-strategy</code> attribute.
</li></ul></div>
<p>For more information, see <a class="xref" href="system-management-chapter.html#jmx" title="9.2&nbsp;JMX Support">Section&nbsp;9.2, &#8220;JMX Support&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-tcp-events" href="#x3.0-tcp-events"></a>TCP/IP Connection Events and Connection Management</h4></div></div></div>

<p><code class="literal">TcpConnection</code> s now emit <code class="literal">ApplicationEvent</code> s (specifically <code class="literal">TcpConnectionEvent</code> s) when connections are opened, closed, or an exception occurs.
This allows applications to be informed of changes to TCP connections using the normal Spring <code class="literal">ApplicationListener</code> mechanism.</p>
<p><code class="literal">AbstractTcpConnection</code> has been renamed <code class="literal">TcpConnectionSupport</code>; custom connections that are subclasses of this class, can use its methods to publish events.
Similarly, <code class="literal">AbstractTcpConnectionInterceptor</code> has been renamed to <code class="literal">TcpConnectionInterceptorSupport</code>.</p>
<p>In addition, a new <code class="literal">&lt;int-ip:tcp-connection-event-inbound-channel-adapter/&gt;</code> is provided; by default, this adapter sends all <code class="literal">TcpConnectionEvent</code> s to a <code class="literal">Channel</code>.</p>
<p>Further, the TCP Connection Factories, now provide a new method <code class="literal">getOpenConnectionIds()</code>, which returns a list of identifiers for all open connections; this allows applications, for example, to broadcast to all open connections.</p>
<p>Finally, the connection factories also provide a new method <code class="literal">closeConnection(String connectionId)</code> which allows applications to explicitly close a connection using its ID.</p>
<p>For more information see <a class="xref" href="ip.html#tcp-events" title="31.5&nbsp;TCP Connection Events">Section&nbsp;31.5, &#8220;TCP Connection Events&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-inbound-script" href="#x3.0-inbound-script"></a>Inbound Channel Adapter Script Support</h4></div></div></div>

<p>The <code class="literal">&lt;int:inbound-channel-adapter/&gt;</code> now supports <code class="literal">&lt;expression/&gt;</code> and <code class="literal">&lt;script/&gt;</code> sub-elements to create a <code class="literal">MessageSource</code>; see <a class="xref" href="messaging-channels-section.html#channel-adapter-expressions-and-scripts" title="4.3.3&nbsp;Channel Adapter Expressions and Scripts">Section&nbsp;4.3.3, &#8220;Channel Adapter Expressions and Scripts&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-content-enricher-headers" href="#x3.0-content-enricher-headers"></a>Content Enricher: Headers Enrichment Support</h4></div></div></div>

<p>The Content Enricher now provides configuration for <code class="literal">&lt;header/&gt;</code> sub-elements, to enrich the outbound Message with headers based on the reply Message from the underlying message flow.
For more information see <a class="xref" href="messaging-transformation-chapter.html#payload-enricher" title="7.2.3&nbsp;Payload Enricher">Section&nbsp;7.2.3, &#8220;Payload Enricher&#8221;</a>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x3.0-general" href="#x3.0-general"></a>H.6.2&nbsp;General Changes</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-message-id" href="#x3.0-message-id"></a>Message ID Generation</h4></div></div></div>

<p>Previously, message ids were generated using the JDK <code class="literal">UUID.randomUUID()</code> method.
With this release, the default mechanism has been changed to use a more efficient algorithm which is significantly faster.
In addition, the ability to change the strategy used to generate message ids has been added.
For more information see <a class="xref" href="messaging-construction-chapter.html#message-id-generation" title="Message ID Generation">the section called &#8220;Message ID Generation&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-gateway" href="#x3.0-gateway"></a>&lt;gateway&gt; Changes</h4></div></div></div>

<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
It is now possible to set common headers across all gateway methods, and more options are provided for adding, to the message, information about which method was invoked.
</li><li class="listitem">
It is now possible to entirely customize the way that gateway method calls are mapped to messages.
</li><li class="listitem">
The <code class="literal">GatewayMethodMetadata</code> is now public class and it makes possible flexibly to configure the <code class="literal">GatewayProxyFactoryBean</code> programmatically from Java code.
</li></ul></div>
<p>For more information see <a class="xref" href="messaging-endpoints-chapter.html#gateway" title="8.4&nbsp;Messaging Gateways">Section&nbsp;8.4, &#8220;Messaging Gateways&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-http-endpointss" href="#x3.0-http-endpointss"></a>HTTP Endpoint Changes</h4></div></div></div>

<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<span class="strong"><strong>Outbound Endpoint <span class="emphasis"><em>encode-uri</em></span></strong></span> - <code class="literal">&lt;http:outbound-gateway/&gt;</code> and <code class="literal">&lt;http:outbound-channel-adapter/&gt;</code> now provide an <code class="literal">encode-uri</code> attribute to allow disabling the encoding of the URI object before sending the request.
</li><li class="listitem">
<span class="strong"><strong>Inbound Endpoint <span class="emphasis"><em>merge-with-default-converters</em></span></strong></span> - <code class="literal">&lt;http:inbound-gateway/&gt;</code> and <code class="literal">&lt;http:inbound-channel-adapter/&gt;</code> now have a <code class="literal">merge-with-default-converters</code> attribute to include the list of default <code class="literal">HttpMessageConverter</code> s after the custom message converters.
</li><li class="listitem">
<span class="strong"><strong><span class="emphasis"><em>If-(Un)Modified-Since</em></span> HTTP Headers</strong></span> - previously, <span class="emphasis"><em>If-Modified-Since</em></span> and <span class="emphasis"><em>If-Unmodified-Since</em></span> HTTP headers were incorrectly processed within from/to HTTP headers mapping in the <code class="literal">DefaultHttpHeaderMapper</code>.
Now, in addition correcting that issue, <code class="literal">DefaultHttpHeaderMapper</code> provides date parsing from formatted strings for any HTTP headers that accept date-time values.
</li><li class="listitem">
<span class="strong"><strong>Inbound Endpoint Expression Variables</strong></span> - In addition to the existing <span class="emphasis"><em>#requestParams</em></span> and <span class="emphasis"><em>#pathVariables</em></span>, the <code class="literal">&lt;http:inbound-gateway/&gt;</code> and <code class="literal">&lt;http:inbound-channel-adapter/&gt;</code> now support additional useful variables: <span class="emphasis"><em>#matrixVariables</em></span>, <span class="emphasis"><em>#requestAttributes</em></span>, <span class="emphasis"><em>#requestHeaders</em></span> and <span class="emphasis"><em>#cookies</em></span>.
These variables are available in both payload and header expressions.
</li><li class="listitem">
<span class="strong"><strong>Outbound Endpoint <span class="emphasis"><em>uri-variables-expression</em></span></strong></span> - HTTP Outbound Endpoints now support the <code class="literal">uri-variables-expression</code> attribute to specify an <code class="literal">Expression</code> to evaluate a <code class="literal">Map</code> for all URI variable placeholders within URL template.
This allows selection of a different map of expressions based on the outgoing message.
</li></ul></div>
<p>For more information see <a class="xref" href="http.html" title="17.&nbsp;HTTP Support">Chapter&nbsp;17, <i>HTTP Support</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-json-transformers" href="#x3.0-json-transformers"></a>Jackson Support (JSON)</h4></div></div></div>

<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
A new abstraction for JSON conversion has been introduced.
Implementations for Jackson 1.x and Jackson 2 are currently provided, with the version being determined by presence on the classpath.
Previously, only Jackson 1.x was supported.
</li><li class="listitem">
The <code class="literal">ObjectToJsonTransformer</code> and <code class="literal">JsonToObjectTransformer</code> now emit/consume headers containing type information.
</li></ul></div>
<p>For more information, see <span class="emphasis"><em>JSON Transformers</em></span> in <a class="xref" href="messaging-transformation-chapter.html#transformer" title="7.1&nbsp;Transformer">Section&nbsp;7.1, &#8220;Transformer&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-id-for-chain-sub-components" href="#x3.0-id-for-chain-sub-components"></a>Chain Elements <span class="emphasis"><em>id</em></span> Attribute</h4></div></div></div>

<p>Previously, the <span class="emphasis"><em>id</em></span> attribute for elements within a <code class="literal">&lt;chain&gt;</code> was ignored and, in some cases, disallowed.
Now, the <span class="emphasis"><em>id</em></span> attribute is allowed for all elements within a <code class="literal">&lt;chain&gt;</code>.
The bean names of chain elements is a combination of the surrounding chain&#8217;s <span class="emphasis"><em>id</em></span> and the <span class="emphasis"><em>id</em></span> of the element itself.
For example: <span class="emphasis"><em>fooChain$child.fooTransformer.handler</em></span>.
For more information see <a class="xref" href="messaging-routing-chapter.html#chain" title="6.6&nbsp;Message Handler Chain">Section&nbsp;6.6, &#8220;Message Handler Chain&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-corr-endpoint-empty-groups" href="#x3.0-corr-endpoint-empty-groups"></a>Aggregator <span class="emphasis"><em>empty-group-min-timeout</em></span> property</h4></div></div></div>

<p>The <code class="literal">AbstractCorrelatingMessageHandler</code> provides a new property <code class="literal">empty-group-min-timeout</code> to allow empty group expiry to run on a longer schedule than expiring partial groups.
Empty groups will not be removed from the <code class="literal">MessageStore</code> until they have not been modified for at least this number of milliseconds.
For more information see <a class="xref" href="messaging-routing-chapter.html#aggregator-config" title="6.4.4&nbsp;Configuring an Aggregator">Section&nbsp;6.4.4, &#8220;Configuring an Aggregator&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-filelistfilter" href="#x3.0-filelistfilter"></a>Persistent File List Filters (file, (S)FTP)</h4></div></div></div>

<p>New <code class="literal">FileListFilter</code> s that use a persistent <code class="literal">MetadataStore</code> are now available.
These can be used to prevent duplicate files after a system restart.
See<a class="xref" href="files.html#file-reading" title="14.2&nbsp;Reading Files">Section&nbsp;14.2, &#8220;Reading Files&#8221;</a>, <a class="xref" href="ftp.html#ftp-inbound" title="15.4&nbsp;FTP Inbound Channel Adapter">Section&nbsp;15.4, &#8220;FTP Inbound Channel Adapter&#8221;</a>, and <a class="xref" href="sftp.html#sftp-inbound" title="27.7&nbsp;SFTP Inbound Channel Adapter">Section&nbsp;27.7, &#8220;SFTP Inbound Channel Adapter&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-scripting-variables" href="#x3.0-scripting-variables"></a>Scripting Support: Variables Changes</h4></div></div></div>

<p>A new <code class="literal">variables</code> attribute has been introduced for scripting components.
In addition, variable bindings are now allowed for inline scripts.
See <a class="xref" href="messaging-endpoints-chapter.html#groovy" title="8.8&nbsp;Groovy support">Section&nbsp;8.8, &#8220;Groovy support&#8221;</a> and <a class="xref" href="messaging-endpoints-chapter.html#scripting" title="8.7&nbsp;Scripting support">Section&nbsp;8.7, &#8220;Scripting support&#8221;</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-direct-channel-lb-ref" href="#x3.0-direct-channel-lb-ref"></a>Direct Channel Load Balancing configuration</h4></div></div></div>

<p>Previously, when configuring <code class="literal">LoadBalancingStrategy</code> on the channel&#8217;s <span class="emphasis"><em>dispatcher</em></span> sub-element, the only available option was to use a pre-defined enumeration of values which did not allow one to set a custom implementation of the <code class="literal">LoadBalancingStrategy</code>.
You can now use <code class="literal">load-balancer-ref</code> to provide a reference to a custom implementation of the <code class="literal">LoadBalancingStrategy</code>.
For more information see <a class="xref" href="messaging-channels-section.html#channel-implementations-directchannel" title="DirectChannel">the section called &#8220;DirectChannel&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-pub-sub" href="#x3.0-pub-sub"></a>PublishSubscribeChannel Behavior</h4></div></div></div>

<p>Previously, sending to a &lt;publish-subscribe-channel/&gt; that had no subscribers would return a <code class="literal">false</code> result.
If used in conjunction with a <code class="literal">MessagingTemplate</code>, this would result in an exception being thrown.
Now, the <code class="literal">PublishSubscribeChannel</code> has a property <code class="literal">minSubscribers</code> (default 0).
If the message is sent to at least the minimum number of subscribers, the send is deemed to be successful (even if zero).
If an application is expecting to get an exception under these conditions, set the minimum subscribers to at least 1.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0--s-ftp-changes" href="#x3.0--s-ftp-changes"></a>FTP, SFTP and FTPS Changes</h4></div></div></div>

<p><span class="strong"><strong>The FTP, SFTP and FTPS endpoints no longer cache sessions by default</strong></span></p>
<p>The deprecated <code class="literal">cached-sessions</code> attribute has been removed from all endpoints.
Previously, the embedded caching mechanism controlled by this attribute&#8217;s value didn&#8217;t provide a way to limit the size of the cache, which could grow indefinitely.
The <code class="literal">CachingConnectionFactory</code> was introduced in release 2.1 and it became the preferred (and is now the only) way to cache sessions.</p>
<p>The <code class="literal">CachingConnectionFactory</code> now provides a new method <code class="literal">resetCache()</code>.
This immediately closes idle sessions and causes in-use sessions to be closed as and when they are returned to the cache.</p>
<p>The <code class="literal">DefaultSftpSessionFactory</code> (in conjunction with a <code class="literal">CachingSessionFactory</code>) now supports multiplexing channels over a single SSH connection (SFTP Only).</p>
<p><span class="strong"><strong>FTP, SFTP and FTPS Inbound Adapters</strong></span></p>
<p>Previously, there was no way to override the default filter used to process files retrieved from a remote server.
The <code class="literal">filter</code> attribute determines which files are retrieved but the <code class="literal">FileReadingMessageSource</code> uses an <code class="literal">AcceptOnceFileListFilter</code>.
This means that if a new copy of a file is retrieved, with the same name as a previously copied file, no message was sent from the adapter.</p>
<p>With this release, a new attribute <code class="literal">local-filter</code> allows you to override the default filter, for example with an <code class="literal">AcceptAllFileListFilter</code>, or some other custom filter.</p>
<p>For users that wish the behavior of the <code class="literal">AcceptOnceFileListFilter</code> to be maintained across JVM executions, a custom filter that retains state, perhaps on the file system, can now be configured.</p>
<p>Inbound Channel Adapters now support the <code class="literal">preserve-timestamp</code> attribute, which sets the local file modified timestamp to the timestamp from the server (default false).</p>
<p><span class="strong"><strong>FTP, SFTP and FTPS Gateways</strong></span></p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
The gateways now support the <span class="strong"><strong>mv</strong></span> command, enabling the renaming of remote files.
</li><li class="listitem">
The gateways now support recursive <span class="strong"><strong>ls</strong></span> and <span class="strong"><strong>mget</strong></span> commands, enabling the retrieval of a remote file tree.
</li><li class="listitem">
The gateways now support <span class="strong"><strong>put</strong></span> and <span class="strong"><strong>mput</strong></span> commands, enabling sending file(s) to the remote server.
</li><li class="listitem">
The <code class="literal">local-filename-generator-expression</code> attribute is now supported, enabling the naming of local files during retrieval.
By default, the same name as the remote file is used.
</li><li class="listitem">
The <code class="literal">local-directory-expression</code> attribute is now supported, enabling the naming of local directories during retrieval based on the remote directory.
</li></ul></div>
<p><span class="strong"><strong>Remote File Template</strong></span></p>
<p>A new higher-level abstraction (<code class="literal">RemoteFileTemplate</code>) is provided over the <code class="literal">Session</code> implementations used by the FTP and SFTP modules.
While it is used internally by endpoints, this abstraction can also be used programmatically and, like all Spring <code class="literal">*Template</code> implementations, reliably closes the underlying session while allowing low level access to the session when needed.</p>
<p>For more information, see <a class="xref" href="ftp.html" title="15.&nbsp;FTP/FTPS Adapters">Chapter&nbsp;15, <i>FTP/FTPS Adapters</i></a> and <a class="xref" href="sftp.html" title="27.&nbsp;SFTP Adapters">Chapter&nbsp;27, <i>SFTP Adapters</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-outbound-gateway-requires-reply" href="#x3.0-outbound-gateway-requires-reply"></a><span class="emphasis"><em>requires-reply</em></span> Attribute for Outbound Gateways</h4></div></div></div>

<p>All Outbound Gateways (e.g.
<code class="literal">&lt;jdbc:outbound-gateway/&gt;</code> or <code class="literal">&lt;jms:outbound-gateway/&gt;</code>) are designed for <span class="emphasis"><em>request-reply</em></span> scenarios.
A response is expected from the external service and will be published to the <code class="literal">reply-channel</code>, or the <code class="literal">replyChannel</code> message header.
However, there are some cases where the external system might not always return a result, e.g.
a <code class="literal">&lt;jdbc:outbound-gateway/&gt;</code>, when a SELECT ends with an empty <code class="literal">ResultSet</code> or, say, a Web Service is One-Way.
An option is therefore needed to configure whether or not a <span class="emphasis"><em>reply</em></span> is required.
For this purpose, the <span class="emphasis"><em>requires-reply</em></span> attribute has been introduced for Outbound Gateway components.
In most cases, the default value for <span class="emphasis"><em>requires-reply</em></span> is <code class="literal">true</code> and, if there is not any result, a <code class="literal">ReplyRequiredException</code> will be thrown.
Changing the value to <code class="literal">false</code> means that, if an external service doesn&#8217;t return anything, the message-flow will end at that point, similar to an Outbound Channel Adapter.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The WebService outbound gateway has an additional attribute <code class="literal">ignore-empty-responses</code>; this is used to treat an empty String response as if no response was received.
It is true by default but can be set to false to allow the application to receive an empty String in the reply message payload.
When the attribute is true an empty string is treated as no response for the purposes of the <span class="emphasis"><em>requires-reply</em></span> attribute.
<span class="emphasis"><em>requires-reply</em></span> is false by default for the WebService outbound gateway.</p>
</td></tr></table></div>
<p>Note, the <code class="literal">requiresReply</code> property was previously present in the <code class="literal">AbstractReplyProducingMessageHandler</code> but set to <code class="literal">false</code>, and there wasn&#8217;t any way to configure it on Outbound Gateways using the XML namespace.</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top">
<p>Previously, a gateway receiving no reply would silently end the flow (with a DEBUG log message); with this change an exception will now be thrown by default by most gateways.
To revert to the previous behavior, set <code class="literal">requires-reply</code> to false.</p>
</td></tr></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-amqp-mapping" href="#x3.0-amqp-mapping"></a>AMQP Outbound Gateway Header Mapping</h4></div></div></div>

<p>Previously, the &lt;int-amqp:outbound-gateway/&gt; mapped headers before invoking the message converter, and the converter could overwrite headers such as <code class="literal">content-type</code>.
The outbound adapter maps the headers after the conversion, which means headers like <code class="literal">content-type</code> from the outbound <code class="literal">Message</code> (if present) are used.</p>
<p>Starting with this release, the gateway now maps the headers after the message conversion, consistent with the adapter.
If your application relies on the previous behavior (where the converter&#8217;s headers overrode the mapped headers), you either need to filter those headers (before the message reaches the gateway) or set them appropriately.
The headers affected by the <code class="literal">SimpleMessageConverter</code> are <code class="literal">content-type</code> and <code class="literal">content-encoding</code>.
Custom message converters may set other headers.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-stored-proc-sql-return-type" href="#x3.0-stored-proc-sql-return-type"></a>Stored Procedure Components Improvements</h4></div></div></div>

<p>For more complex database-specific types, not supported by the standard <code class="literal">CallableStatement.getObject</code> method, 2 new additional attributes were introduced to the <code class="literal">&lt;sql-parameter-definition/&gt;</code> element with OUT-direction:</p>
<p><span class="emphasis"><em>type-name</em></span></p>
<p><span class="emphasis"><em>return-type</em></span></p>
<p>The <code class="literal">row-mapper</code> attribute of the Stored Procedure Inbound Channel Adapter <code class="literal">&lt;returning-resultset/&gt;</code> sub-element now supports a reference to a <code class="literal">RowMapper</code> bean definition.
Previously, it contained just a class name (which is still supported).</p>
<p>For more information see <a class="xref" href="jdbc.html#stored-procedures" title="18.5&nbsp;Stored Procedures">Section&nbsp;18.5, &#8220;Stored Procedures&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-ws-outbound-uri-substitution" href="#x3.0-ws-outbound-uri-substitution"></a>Web Service Outbound URI Configuration</h4></div></div></div>

<p>Web Service Outbound Gateway <span class="emphasis"><em>uri</em></span> attribute now supports <code class="literal">&lt;uri-variable/&gt;</code> substitution for all URI-schemes supported by Spring Web Services.
For more information see <a class="xref" href="ws.html#outbound-uri" title="34.4&nbsp;Outbound URI Configuration">Section&nbsp;34.4, &#8220;Outbound URI Configuration&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-redis" href="#x3.0-redis"></a>Redis Adapter Changes</h4></div></div></div>

<p>The Redis Inbound Channel Adapter can now use a <code class="literal">null</code> value for <code class="literal">serializer</code> property, with the raw data being the message payload.</p>
<p>The Redis Outbound Channel Adapter now has the <code class="literal">topic-expression</code> property to determine the Redis topic against the Message at runtime.</p>
<p>The Redis Inbound Channel Adapter, in addition to the existing <code class="literal">topics</code> attribute, now has the <code class="literal">topic-patterns</code> attribute.</p>
<p>For more information, see <a class="xref" href="redis.html" title="24.&nbsp;Redis Support">Chapter&nbsp;24, <i>Redis Support</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-advising-filters" href="#x3.0-advising-filters"></a>Advising Filters</h4></div></div></div>

<p>Previously, when a &lt;filter/&gt; had a &lt;request-handler-advice-chain/&gt;, the discard action was all performed within the scope of the advice chain (including any downstream flow on the <code class="literal">discard-channel</code>).
The filter element now has an attribute <code class="literal">discard-within-advice</code> (default <code class="literal">true</code>), to allow the discard action to be performed after the advice chain completes.
See <a class="xref" href="messaging-endpoints-chapter.html#advising-filters" title="8.9.6&nbsp;Advising Filters">Section&nbsp;8.9.6, &#8220;Advising Filters&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-annotation-advice" href="#x3.0-annotation-advice"></a>Advising Endpoints using Annotations</h4></div></div></div>

<p>Request Handler Advice Chains can now be configured using annotations.
See <a class="xref" href="messaging-endpoints-chapter.html#advising-with-annotations" title="8.9.7&nbsp;Advising Endpoints Using Annotations">Section&nbsp;8.9.7, &#8220;Advising Endpoints Using Annotations&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-o-t-s-t" href="#x3.0-o-t-s-t"></a>ObjectToStringTransformer Improvements</h4></div></div></div>

<p>This transformer now correctly transforms <code class="literal">byte[]</code> and <code class="literal">char[]</code> payloads to <code class="literal">String</code>.
For more information see <a class="xref" href="messaging-transformation-chapter.html#transformer" title="7.1&nbsp;Transformer">Section&nbsp;7.1, &#8220;Transformer&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-jpa-changes" href="#x3.0-jpa-changes"></a>JPA Support Changes</h4></div></div></div>

<p>Payloads to <span class="emphasis"><em>persist</em></span> or <span class="emphasis"><em>merge</em></span> can now be of type <code class="literal">http://docs.oracle.com/javase/7/docs/api/java/lang/Iterable.html[java.lang.Iterable]</code>.</p>
<p>In that case, each object returned by the <code class="literal">Iterable</code> is treated as an entity and persisted or merged using the underlying <code class="literal">EntityManager</code>.
<span class="emphasis"><em>NULL</em></span> values returned by the iterator are ignored.</p>
<p>The JPA adapters now have additional attributes to optionally <span class="emphasis"><em>flush</em></span> and <span class="emphasis"><em>clear</em></span> entities from the associated persistence context after performing persistence operations.</p>
<p>Retrieving gateways had no mechanism to specify the first record to be retrieved which is a common use case.
The retrieving gateways now support specifying this parameter using a <code class="literal">first-result</code> and <code class="literal">first-result-expression</code> attributes to the gateway definition.
<a class="xref" href="jpa.html#jpa-retrieving-outbound-gateway" title="19.6.3&nbsp;Retrieving Outbound Gateway">Section&nbsp;19.6.3, &#8220;Retrieving Outbound Gateway&#8221;</a>.</p>
<p>The JPA retrieving gateway and inbound adapter now have an attribute to specify the maximum number of results in a result set as an expression.
In addition, the <code class="literal">max-results</code> attribute has been introduced to replace <code class="literal">max-number-of-results</code>, which has been deprecated.
<code class="literal">max-results</code> and <code class="literal">max-results-expression</code> are used to provide the maximum number of results, or an expression to compute the maximum number of results, respectively, in the result set.</p>
<p>For more information see <a class="xref" href="jpa.html" title="19.&nbsp;JPA Support">Chapter&nbsp;19, <i>JPA Support</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-dalay-expression" href="#x3.0-dalay-expression"></a>Delayer: delay expression</h4></div></div></div>

<p>Previously, the <code class="literal">&lt;delayer&gt;</code> provided a <code class="literal">delay-header-name</code> attribute to determine the <span class="emphasis"><em>delay</em></span> value at runtime.
In complex cases it was necessary to precede the <code class="literal">&lt;delayer&gt;</code> with a <code class="literal">&lt;header-enricher&gt;</code>.
Spring Integration 3.0 introduced the <code class="literal">expression</code> attribute and <code class="literal">expression</code> sub-element for dynamic delay determination.
The <code class="literal">delay-header-name</code> attribute is now deprecated because the header evaluation can be specified in the <code class="literal">expression</code>.
In addition, the <code class="literal">ignore-expression-failures</code> was introduced to control the behavior when an expression evaluation fails.
For more information see <a class="xref" href="messaging-endpoints-chapter.html#delayer" title="8.6&nbsp;Delayer">Section&nbsp;8.6, &#8220;Delayer&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-jdbc-mysql-v5_6_4" href="#x3.0-jdbc-mysql-v5_6_4"></a>JDBC Message Store Improvements</h4></div></div></div>

<p><span class="emphasis"><em>Spring Integration 3.0</em></span> adds a new set of DDL scripts for <span class="emphasis"><em>MySQL</em></span> version 5.6.4 and higher.
Now <span class="emphasis"><em>MySQL</em></span> supports <span class="emphasis"><em>fractional
				seconds</em></span> and is thus improving the FIFO ordering when polling from a MySQL-based Message Store.
For more information, please see <a class="xref" href="jdbc.html#jdbc-message-store-generic" title="18.4.1&nbsp;The Generic JDBC Message Store">Section&nbsp;18.4.1, &#8220;The Generic JDBC Message Store&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-event-for-imap-idle" href="#x3.0-event-for-imap-idle"></a>IMAP Idle Connection Exceptions</h4></div></div></div>

<p>Previously, if an IMAP idle connection failed, it was logged but there was no mechanism to inform an application.
Such exceptions now generate <code class="literal">ApplicationEvent</code> s.
Applications can obtain these events using an <code class="literal">&lt;int-event:inbound-channel-adapter&gt;</code> or any <code class="literal">ApplicationListener</code> configured to receive an <code class="literal">ImapIdleExceptionEvent</code> or one of its super classes.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-tcp-headers" href="#x3.0-tcp-headers"></a>Message Headers and TCP</h4></div></div></div>

<p>The TCP connection factories now enable the configuration of a flexible mechanism to transfer selected headers (as well as the payload) over TCP.
A new <code class="literal">TcpMessageMapper</code> enables the selection of the headers, and an appropriate (de)serializer needs to be configured to write the resulting <code class="literal">Map</code> to the TCP stream.
A <code class="literal">MapJsonSerializer</code> is provided as a convenient mechanism to transfer headers and payload over TCP.
For more information see <a class="xref" href="ip.html#ip-headers" title="31.8.4&nbsp;Transferring Headers">Section&nbsp;31.8.4, &#8220;Transferring Headers&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-jms-mdca-te" href="#x3.0-jms-mdca-te"></a>JMS Message Driven Channel Adapter</h4></div></div></div>

<p>Previously, when configuring a <code class="literal">&lt;message-driven-channel-adapter/&gt;</code>, if you wished to use a specific <code class="literal">TaskExecutor</code>, it was necessary to declare a container bean and provide it to the adapter using the <code class="literal">container</code> attribute.
The <code class="literal">task-executor</code> is now provided, allowing it to be set directly on the adapter.
This is in addition to several other container attributes that were already available.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-rmi-ec" href="#x3.0-rmi-ec"></a>RMI Inbound Gateway</h4></div></div></div>

<p>The RMI Inbound Gateway now supports an <code class="literal">error-channel</code> attribute.
See <a class="xref" href="rmi.html#rmi-inbound" title="26.3&nbsp;Inbound RMI">Section&nbsp;26.3, &#8220;Inbound RMI&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x3.0-xslt-transformer" href="#x3.0-xslt-transformer"></a>XsltPayloadTransformer</h4></div></div></div>

<p>You can now specify the transformer factory class name using the <code class="literal">transformer-factory-class</code> attribute.
See <a class="xref" href="xml.html#xml-xslt-payload-transformers" title="XsltPayloadTransformer">the section called &#8220;XsltPayloadTransformer&#8221;</a></p>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="migration-2.1-2.2" href="#migration-2.1-2.2"></a>H.7&nbsp;Changes between 2.1 and 2.2</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x2.2-new-components" href="#x2.2-new-components"></a>H.7.1&nbsp;New Components</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-redis-store-adapters" href="#x2.2-redis-store-adapters"></a>RedisStore Inbound and Outbound Channel Adapters</h4></div></div></div>

<p>Spring Integration now has RedisStore Inbound and Outbound Channel Adapters allowing you to write and read Message payloads to/from Redis collection(s).
For more information please see <a class="xref" href="redis.html#redis-store-outbound-channel-adapter" title="24.7&nbsp;RedisStore Outbound Channel Adapter">Section&nbsp;24.7, &#8220;RedisStore Outbound Channel Adapter&#8221;</a> and <a class="xref" href="redis.html#redis-store-inbound-channel-adapter" title="24.6&nbsp;RedisStore Inbound Channel Adapter">Section&nbsp;24.6, &#8220;RedisStore Inbound Channel Adapter&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-mongo-adapters" href="#x2.2-mongo-adapters"></a>MongoDB Inbound and Outbound Channel Adapters</h4></div></div></div>

<p>Spring Integration now has MongoDB Inbound and Outbound Channel Adapters allowing you to write and read Message payloads to/from a MongoDB document store.
For more information please see <a class="xref" href="mongodb.html#mongodb-outbound-channel-adapter" title="22.5&nbsp;MongoDB Outbound Channel Adapter">Section&nbsp;22.5, &#8220;MongoDB Outbound Channel Adapter&#8221;</a> and <a class="xref" href="mongodb.html#mongodb-inbound-channel-adapter" title="22.4&nbsp;MongoDB Inbound Channel Adapter">Section&nbsp;22.4, &#8220;MongoDB Inbound Channel Adapter&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-jpa" href="#x2.2-jpa"></a>JPA Endpoints</h4></div></div></div>

<p>Spring Integration now includes components for the Java Persistence API (JPA) for retrieving and persisting JPA entity objects.
The JPA Adapter includes the following components:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<span class="emphasis"><em><a class="link" href="jpa.html#jpa-inbound-channel-adapter" title="19.4&nbsp;Inbound Channel Adapter">Inbound Channel Adapter</a></em></span>
</li><li class="listitem">
<span class="emphasis"><em><a class="link" href="jpa.html#jpa-outbound-channel-adapter" title="19.5&nbsp;Outbound Channel Adapter">Outbound Channel Adapter</a></em></span>
</li><li class="listitem">
<span class="emphasis"><em><a class="link" href="jpa.html#jpa-updating-outbound-gateway" title="19.6.2&nbsp;Updating Outbound Gateway">Updating Outbound Gateway</a></em></span>
</li><li class="listitem">
<span class="emphasis"><em><a class="link" href="jpa.html#jpa-retrieving-outbound-gateway" title="19.6.3&nbsp;Retrieving Outbound Gateway">Retrieving Outbound Gateway</a></em></span>
</li></ul></div>
<p>For more information please see <a class="xref" href="jpa.html" title="19.&nbsp;JPA Support">Chapter&nbsp;19, <i>JPA Support</i></a></p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x2.2-general" href="#x2.2-general"></a>H.7.2&nbsp;General Changes</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-spring-31" href="#x2.2-spring-31"></a>Spring 3.1 Used by Default</h4></div></div></div>

<p>Spring Integration now uses Spring 3.1.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-handler-advice" href="#x2.2-handler-advice"></a>Adding Behavior to Endpoints</h4></div></div></div>

<p>The ability to add an &lt;advice-chain/&gt; to a poller has been available for some time.
However, the behavior added by this affects the entire integration flow.
It did not address the ability to add, say, retry, to an individual endpoint.
The 2.2.
release introduces the &lt;request-handler-advice-chain/&gt; to many endpoints.</p>
<p>In addition, 3 standard Advice classes have been provided for this purpose:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
MessageHandlerRetryAdvice
</li><li class="listitem">
MessageHandlerCircuitBreakerAdvice
</li><li class="listitem">
ExpressionEvaluatingMessageHandlerAdvice
</li></ul></div>
<p>For more information, see <a class="xref" href="messaging-endpoints-chapter.html#message-handler-advice-chain" title="8.9&nbsp;Adding Behavior to Endpoints">Section&nbsp;8.9, &#8220;Adding Behavior to Endpoints&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-transaction-sync" href="#x2.2-transaction-sync"></a>Transaction Synchronization and Pseudo Transactions</h4></div></div></div>

<p>Pollers can now participate in Spring&#8217;s <span class="emphasis"><em>Transaction Synchronization</em></span> feature.
This allows for synchronizing such operations as renaming files by an inbound channel adapter depending on whether the transaction commits, or rolls back.</p>
<p>In addition, these features can be enabled when there is not a <span class="emphasis"><em>real</em></span> transaction present, by means of a <code class="literal">PseudoTransactionManager</code>.</p>
<p>For more information see <a class="xref" href="transactions.html#transaction-synchronization" title="C.3&nbsp;Transaction Synchronization">Section&nbsp;C.3, &#8220;Transaction Synchronization&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-file-adapter" href="#x2.2-file-adapter"></a>File Adapter - Improved File Overwrite/Append Handling</h4></div></div></div>

<p>When using the <span class="emphasis"><em>File Oubound Channel Adapter</em></span> or the <span class="emphasis"><em>File Outbound Gateway</em></span>, a new <span class="emphasis"><em>mode</em></span> property was added.
Prior to <span class="emphasis"><em>Spring Integration 2.2</em></span>, target files were replaced when they existed.
Now you can specify the following options:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
REPLACE (Default)
</li><li class="listitem">
APPEND
</li><li class="listitem">
FAIL
</li><li class="listitem">
IGNORE
</li></ul></div>
<p>For more information please see <a class="xref" href="files.html#file-writing-destination-exists" title="14.3.3&nbsp;Dealing with Existing Destination Files">Section&nbsp;14.3.3, &#8220;Dealing with Existing Destination Files&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-outbound-gateways" href="#x2.2-outbound-gateways"></a>Reply-Timeout added to more Outbound Gateways</h4></div></div></div>

<p>The XML Namespace support adds the <span class="emphasis"><em>reply-timeout</em></span> attribute to the following <span class="emphasis"><em>Outbound Gateways</em></span>:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Amqp Outbound Gateway
</li><li class="listitem">
File Outbound Gateway
</li><li class="listitem">
Ftp Outbound Gateway
</li><li class="listitem">
Sftp Outbound Gateway
</li><li class="listitem">
Ws Outbound Gateway
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-amqp-11" href="#x2.2-amqp-11"></a>Spring-AMQP 1.1</h4></div></div></div>

<p>Spring Integration now uses Spring AMQP 1.1.
This enables several features to be used within a Spring Integration application, including&#8230;&#8203;</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
A fixed reply queue for the outbound gateway
</li><li class="listitem">
HA (mirrored) queues
</li><li class="listitem">
Publisher Confirms
</li><li class="listitem">
Returned Messages
</li><li class="listitem">
Support for Dead Letter Exchanges/Dead Letter Queues
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-jdbc-11" href="#x2.2-jdbc-11"></a>JDBC Support - Stored Procedures Components</h4></div></div></div>

<p><span class="emphasis"><em>SpEL Support</em></span></p>
<p>When using the Stored Procedure components of the Spring Integration JDBC Adapter, you can now provide Stored Procedure Names or Stored Function Names using Spring Expression Language (SpEL).</p>
<p>This allows you to specify the Stored Procedures to be invoked at runtime.
For example, you can provide Stored Procedure names that you would like to execute via Message Headers.
For more information please see <a class="xref" href="jdbc.html#stored-procedures" title="18.5&nbsp;Stored Procedures">Section&nbsp;18.5, &#8220;Stored Procedures&#8221;</a>.</p>
<p><span class="emphasis"><em>JMX Support</em></span></p>
<p>The Stored Procedure components now provide basic JMX support, exposing some of their properties as MBeans:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Stored Procedure Name
</li><li class="listitem">
Stored Procedure Name Expression
</li><li class="listitem">
JdbcCallOperations Cache Statistics
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-jdbc-gateway-update-optional" href="#x2.2-jdbc-gateway-update-optional"></a>JDBC Support - Outbound Gateway</h4></div></div></div>

<p>When using the JDBC Outbound Gateway, the update query is no longer mandatory.
You can now provide solely a select query using the request message as a source of parameters.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-jdbc-message-store-channels" href="#x2.2-jdbc-message-store-channels"></a>JDBC Support - Channel-specific Message Store Implementation</h4></div></div></div>

<p>A new <span class="emphasis"><em>Message Channel</em></span>-specific Message Store Implementation has been added, providing a more scalable solution using database-specific SQL queries.
For more information please see: <a class="xref" href="jdbc.html#jdbc-message-store-channels" title="18.4.2&nbsp;Backing Message Channels">Section&nbsp;18.4.2, &#8220;Backing Message Channels&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-shutdown" href="#x2.2-shutdown"></a>Orderly Shutdown</h4></div></div></div>

<p>A method <code class="literal">stopActiveComponents()</code> has been added to the IntegrationMBeanExporter.
This allows a Spring Integration application to be shut down in an orderly manner, disallowing new inbound messages to certain adapters and waiting for some time to allow in-flight messages to complete.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-jms-og" href="#x2.2-jms-og"></a>JMS Oubound Gateway Improvements</h4></div></div></div>

<p>The JMS Outbound Gateway can now be configured to use a`MessageListener` container to receive replies.
This can improve performance of the gateway.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.2-o-t-j-t" href="#x2.2-o-t-j-t"></a>object-to-json-transformer</h4></div></div></div>

<p>The <code class="literal">ObjectToJsonTransformer</code> now sets the <span class="emphasis"><em>content-type</em></span> header to <span class="emphasis"><em>application/json</em></span> by default.
For more information see <a class="xref" href="messaging-transformation-chapter.html#transformer" title="7.1&nbsp;Transformer">Section&nbsp;7.1, &#8220;Transformer&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="httpChanges" href="#httpChanges"></a>HTTP Support</h4></div></div></div>

<p>Java serialization over HTTP is no longer enabled by default.
Previously, when setting a <code class="literal">expected-response-type</code> to a <code class="literal">Serializable</code> object, the <code class="literal">Accept</code> header was not properly set up.
The <code class="literal">SerializingHttpMessageConverter</code> has now been updated to set the Accept header to <code class="literal">application/x-java-serialized-object</code>.
However, because this could cause incompatibility with existing applications, it was decided to no longer automatically add this converter to the HTTP endpoints.</p>
<p>If you wish to use Java serialization, you will need to add the <code class="literal">SerializingHttpMessageConverter</code> to the appropriate endpoints, using the <code class="literal">message-converters</code> attribute, when using XML configuration, or using the <code class="literal">setMessageConverters()</code> method.</p>
<p>Alternatively, you may wish to consider using JSON instead which is enabled by simply having <code class="literal">Jackson</code> on the classpath.</p>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="migration-2.0-2.1" href="#migration-2.0-2.1"></a>H.8&nbsp;Changes between 2.0 and 2.1</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x2.1-new-components" href="#x2.1-new-components"></a>H.8.1&nbsp;New Components</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-scripting-support" href="#x2.1-new-scripting-support"></a>JSR-223 Scripting Support</h4></div></div></div>

<p>In Spring Integration 2.0, support for <a class="ulink" href="http://groovy.codehaus.org/" target="_top">Groovy</a> was added.
With Spring Integration 2.1 we expanded support for additional languages substantially by implementing support for <a class="ulink" href="http://www.jcp.org/en/jsr/detail?id=223" target="_top">JSR-223</a> (Scripting for the Java&#8482; Platform).
Now you have the ability to use any scripting language that supports JSR-223 including:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Javascript
</li><li class="listitem">
Ruby/JRuby
</li><li class="listitem">
Python/Jython
</li><li class="listitem">
Groovy
</li></ul></div>
<p>For further details please see <a class="xref" href="messaging-endpoints-chapter.html#scripting" title="8.7&nbsp;Scripting support">Section&nbsp;8.7, &#8220;Scripting support&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-gemfire-support" href="#x2.1-new-gemfire-support"></a>GemFire Support</h4></div></div></div>

<p>Spring Integration provides support for <a class="ulink" href="http://www.vmware.com/products/application-platform/vfabric-gemfire/overview.html" target="_top">GemFire</a> by providing inbound adapters for entry and continuous query events, an outbound adapter to write entries to the cache, and <a class="ulink" href="http://static.springsource.org/spring-integration/api/org/springframework/integration/store/MessageStore.html" target="_top"><code class="literal">MessageStore</code></a> and <a class="ulink" href="http://static.springsource.org/spring-integration/api/org/springframework/integration/store/MessageGroupStore.html" target="_top"><code class="literal">MessageGroupStore</code></a> implementations.
Spring integration leverages the <a class="ulink" href="http://www.springsource.org/spring-gemfire" target="_top"><span class="emphasis"><em>Spring Gemfire</em></span></a> project, providing a thin wrapper over its components.</p>
<p>For further details please see <a class="xref" href="gemfire.html" title="16.&nbsp;GemFire Support">Chapter&nbsp;16, <i>GemFire Support</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-amqp-support" href="#x2.1-new-amqp-support"></a>AMQP Support</h4></div></div></div>

<p>Spring Integration 2.1 adds several Channel Adapters for receiving and sending messages using thehttp://www.amqp.org/[<span class="emphasis"><em>Advanced Message Queuing Protocol</em></span>] (AMQP).
Furthermore, Spring Integration also provides a point-to-point Message Channel, as well as a publish/subscribe Message Channel that are backed by AMQP Exchanges and Queues.</p>
<p>For further details please see <a class="xref" href="amqp.html" title="11.&nbsp;AMQP Support">Chapter&nbsp;11, <i>AMQP Support</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-mongodb-support" href="#x2.1-new-mongodb-support"></a>MongoDB Support</h4></div></div></div>

<p>As of version 2.1 Spring Integration provides support for <a class="ulink" href="http://www.mongodb.org/" target="_top">MongoDB</a> by providing a MongoDB-based MessageStore.</p>
<p>For further details please see <a class="xref" href="mongodb.html" title="22.&nbsp;MongoDb Support">Chapter&nbsp;22, <i>MongoDb Support</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-redis-support" href="#x2.1-new-redis-support"></a>Redis Support</h4></div></div></div>

<p>As of version 2.1 Spring Integration supports <a class="ulink" href="http://redis.io/" target="_top">Redis</a>, an advanced key-value store, by providing a Redis-based MessageStore as well as Publish-Subscribe Messaging adapters.</p>
<p>For further details please see <a class="xref" href="redis.html" title="24.&nbsp;Redis Support">Chapter&nbsp;24, <i>Redis Support</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-resource-support" href="#x2.1-new-resource-support"></a>Support for Spring&#8217;s Resource abstraction</h4></div></div></div>

<p>As of version 2.1, we&#8217;ve introduced a new <span class="emphasis"><em>Resource Inbound Channel Adapter</em></span> that builds upon Spring&#8217;s Resource abstraction to support greater flexibility across a variety of actual types of underlying resources, such as a file, a URL, or a class path resource.
Therefore, it&#8217;s similar to but more generic than the <span class="emphasis"><em>File Inbound Channel Adapter</em></span>.</p>
<p>For further details please see <a class="xref" href="resource.html#resource-inbound-channel-adapter" title="25.2&nbsp;Resource Inbound Channel Adapter">Section&nbsp;25.2, &#8220;Resource Inbound Channel Adapter&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-stored-proc-support" href="#x2.1-new-stored-proc-support"></a>Stored Procedure Components</h4></div></div></div>

<p>With Spring Integration 2.1, the <code class="literal">JDBC</code> Module also provides Stored Procedure support by adding several new components, including inbound/outbound channel adapters and an Outbound Gateway.
The Stored Procedure support leverages Spring&#8217;shttp://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/jdbc/core/simple/SimpleJdbcCall.html[<code class="literal">SimpleJdbcCall</code>] class and consequently supports stored procedures for:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Apache Derby
</li><li class="listitem">
DB2
</li><li class="listitem">
MySQL
</li><li class="listitem">
Microsoft SQL Server
</li><li class="listitem">
Oracle
</li><li class="listitem">
PostgreSQL
</li><li class="listitem">
Sybase
</li></ul></div>
<p>The Stored Procedure components also support Sql Functions for the following databases:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
MySQL
</li><li class="listitem">
Microsoft SQL Server
</li><li class="listitem">
Oracle
</li><li class="listitem">
PostgreSQL
</li></ul></div>
<p>For further details please see <a class="xref" href="jdbc.html#stored-procedures" title="18.5&nbsp;Stored Procedures">Section&nbsp;18.5, &#8220;Stored Procedures&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-xpath-filter-support" href="#x2.1-new-xpath-filter-support"></a>XPath and XML Validating Filter</h4></div></div></div>

<p>Spring Integration 2.1 provides a new XPath-based Message Filter, that is part of the <code class="literal">XML</code> module.
The XPath Filter allows you to filter messages using provided XPath Expressions.
Furthermore, documentation was added for the XML Validating Filter.</p>
<p>For more details please see <a class="xref" href="xml.html#xml-xpath-filter" title="35.8&nbsp;Using the XPath Filter">Section&nbsp;35.8, &#8220;Using the XPath Filter&#8221;</a> and <a class="xref" href="xml.html#xml-validating-filter" title="35.10&nbsp;XML Validating Filter">Section&nbsp;35.10, &#8220;XML Validating Filter&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-payload-enricher-support" href="#x2.1-new-payload-enricher-support"></a>Payload Enricher</h4></div></div></div>

<p>Since Spring Integration 2.1, the Payload Enricher is provided.
A Payload Enricher defines an endpoint that typically passes ahttp://static.springsource.org/spring-integration/api/org/springframework/integration/Message.html[<code class="literal">Message</code>] to the exposed request channel and then expects a reply message.
The reply message then becomes the root object for evaluation of expressions to enrich the target payload.</p>
<p>For further details please see <a class="xref" href="messaging-transformation-chapter.html#payload-enricher" title="7.2.3&nbsp;Payload Enricher">Section&nbsp;7.2.3, &#8220;Payload Enricher&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-ftp-outbound-gateway" href="#x2.1-new-ftp-outbound-gateway"></a>FTP and SFTP Outbound Gateways</h4></div></div></div>

<p>Spring Integration 2.1 provides two new Outbound Gateways in order to interact with remote File Transfer Protocol (FTP) or Secure File Transfer Protocol (SFT) servers.
These two gateways allow you to directly execute a limited set of remote commands.</p>
<p>For instance, you can use these Outbound Gateways to list, retrieve and delete remote files and have the Spring Integration message flow continue with the remote server&#8217;s response.</p>
<p>For further details please see <a class="xref" href="ftp.html#ftp-outbound-gateway" title="15.7&nbsp;FTP Outbound Gateway">Section&nbsp;15.7, &#8220;FTP Outbound Gateway&#8221;</a> and <a class="xref" href="sftp.html#sftp-outbound-gateway" title="27.10&nbsp;SFTP Outbound Gateway">Section&nbsp;27.10, &#8220;SFTP Outbound Gateway&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-new-ftp-session-caching" href="#x2.1-new-ftp-session-caching"></a>FTP Session Caching</h4></div></div></div>

<p>As of version 2.1, we have exposed more flexibility with regards to session management for remote file adapters (e.g., FTP, SFTP etc).</p>
<p>Specifically, the <code class="literal">cache-sessions</code> attribute, which is available via the XML namespace support, is now <span class="emphasis"><em>deprecated</em></span>.
Alternatively, we added the <code class="literal">sessionCacheSize</code> and <code class="literal">sessionWaitTimeout</code> attributes on the <code class="literal">CachingSessionFactory</code>.</p>
<p>For further details please see <a class="xref" href="ftp.html#ftp-session-caching" title="15.8&nbsp;FTP Session Caching">Section&nbsp;15.8, &#8220;FTP Session Caching&#8221;</a> and <a class="xref" href="sftp.html#sftp-session-caching" title="27.5&nbsp;SFTP Session Caching">Section&nbsp;27.5, &#8220;SFTP Session Caching&#8221;</a>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x2.1-framework-refactorings" href="#x2.1-framework-refactorings"></a>H.8.2&nbsp;Framework Refactoring</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-router-standardization" href="#x2.1-router-standardization"></a>Standardizing Router Configuration</h4></div></div></div>

<p>Router parameters have been standardized across all router implementations with Spring Integration 2.1 providing a more consistent user experience.</p>
<p>With Spring Integration 2.1 the <code class="literal">ignore-channel-name-resolution-failures</code> attribute has been removed in favor of consolidating its behavior with the <code class="literal">resolution-required</code> attribute.
Also, the <code class="literal">resolution-required</code> attribute now defaults to <code class="literal">true</code>.</p>
<p>Starting with Spring Integration 2.1, routers will no longer silently drop any messages, if no default output channel was defined.
This means, that by default routers now require at least one resolved channel (if no <code class="literal">default-output-channel</code> was set) and by default will throw a <code class="literal">MessageDeliveryException</code> if no channel was determined (or an attempt to send was not successful).</p>
<p>If, however, you do desire to drop messages silently, simply set <code class="literal">default-output-channel="nullChannel"</code>.</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top">
<p>With the standardization of Router parameters and the consolidation of the parameters described above, there is the possibility of breaking older Spring Integration based applications.</p>
</td></tr></table></div>
<p>For further details please see <a class="xref" href="messaging-routing-chapter.html#router" title="6.1&nbsp;Routers">Section&nbsp;6.1, &#8220;Routers&#8221;</a></p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-schema-updated" href="#x2.1-schema-updated"></a>XML Schemas updated to 2.1</h4></div></div></div>

<p>Spring Integration 2.1 ships with an updated XML Schema (version 2.1), providing many improvements, e.g.
the Router standardizations discussed above.</p>
<p>From now on, users <span class="emphasis"><em>must</em></span> always declare the latest XML schema (currently version 2.1).
Alternatively, they can use the version-less schema.
Generally, the best option is to use version-less namespaces, as these will automatically use the latest available version of Spring Integration.</p>
<p>Declaring a version-less Spring Integration namespace:</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
   <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
   <span class="hl-attribute">xmlns:int</span>=<span class="hl-value">"http://www.springframework.org/schema/integration"</span>
   <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/integration
           http://www.springframework.org/schema/integration/spring-integration.xsd
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="hl-tag">&gt;</span>
...
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>Declaring a Spring Integration namespace using an explicit version:</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
   <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
   <span class="hl-attribute">xmlns:int</span>=<span class="hl-value">"http://www.springframework.org/schema/integration"</span>
   <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/integration
           http://www.springframework.org/schema/integration/spring-integration-2.2.xsd
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="hl-tag">&gt;</span>
...
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>The old 1.0 and 2.0 schemas are still there, but if an Application Context still references one of those deprecated schemas, the validator will fail on initialization.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x2.1-source-control-infrastructure" href="#x2.1-source-control-infrastructure"></a>H.8.3&nbsp;Source Control Management and Build Infrastructure</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-move-to-github" href="#x2.1-move-to-github"></a>Source Code now hosted on Github</h4></div></div></div>

<p>Since version 2.0, the Spring Integration project uses <a class="ulink" href="http://git-scm.com/" target="_top">Git</a> for version control.
In order to increase community visibility even further, the project was moved from SpringSource hosted Git repositories to <a class="ulink" href="http://www.github.com/" target="_top">Github</a>.
The Spring Integration Git repository is located at: <a class="ulink" href="https://github.com/spring-projects/spring-integration" target="_top">spring-integration</a>.</p>
<p>For the project we also improved the process of providing code contributions and we ensure that every commit is peer-reviewed.
In fact, core committers now follow the same process as contributors.
For more details please see:</p>
<p><a class="ulink" href="https://github.com/spring-projects/spring-integration/blob/master/CONTRIBUTING.adoc" target="_top">Contributing</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="x2.1-sonar" href="#x2.1-sonar"></a>Improved Source Code Visibility with Sonar</h4></div></div></div>

<p>In an effort to provide better source code visibility and consequently to monitor the quality of Spring Integration&#8217;s source code, an instance of <a class="ulink" href="http://www.sonarsource.org/" target="_top">Sonar</a> was setup and metrics are gathered nightly and made available at:</p>
<p><a class="ulink" href="https://sonar.spring.io/dashboard?id=org.springframework.integration%3Aspring-integration%3Amaster" target="_top">sonar.spring.io</a>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="x2.1-new-samples" href="#x2.1-new-samples"></a>H.8.4&nbsp;New Samples</h3></div></div></div>

<p>For the 2.1 release of Spring Integration we also expanded the Spring Integration Samples project and added many new samples, e.g.
samples covering AMQP support, the new payload enricher, a sample illustrating techniques for testing Spring Integration flow fragments, as well as an example for executing Stored Procedures against Oracle.
For details please visit:</p>
<p><a class="ulink" href="https://github.com/spring-projects/spring-integration-samples" target="_top">spring-integration-samples</a>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="migration-1.0-2.0" href="#migration-1.0-2.0"></a>H.9&nbsp;Changes between 1.0 and 2.0</h2></div></div></div>

<p>For a detailed migration guide in regards to upgrading an existing application that uses Spring Integration older than version 2.0, please see:</p>
<p><a class="ulink" href="https://github.com/spring-projects/spring-integration/wiki/Spring-Integration-1.0-to-2.0-Migration-Guide" target="_top">Spring Integration 1.0 to 2.0 Migration Guide</a></p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="migration-spring-30-support" href="#migration-spring-30-support"></a>H.9.1&nbsp;Spring 3 support</h3></div></div></div>

<p>Spring Integration 2.0 is built on top of Spring 3.0.5 and makes many of its features available to our users.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="spel-support" href="#spel-support"></a>Support for the Spring Expression Language (SpEL)</h4></div></div></div>

<p>You can now use SpEL expressions within the <span class="emphasis"><em>transformer, router, filter,
            splitter, aggregator, service-activator, header-enricher</em></span>, and many more elements of the Spring Integration core namespace as well as various adapters.
There are many samples provided throughout this manual.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="conversion-support" href="#conversion-support"></a>ConversionService and Converter</h4></div></div></div>

<p>You can now benefit from <span class="emphasis"><em>Conversion Service</em></span> support provided with Spring while configuring many Spring Integration components such as <a class="ulink" href="http://www.eaipatterns.com/DatatypeChannel.html" target="_top">Datatype Channel</a>.
See <a class="xref" href="messaging-channels-section.html#channel-implementations" title="4.1.2&nbsp;Message Channel Implementations">Section&nbsp;4.1.2, &#8220;Message Channel Implementations&#8221;</a> as well <a class="xref" href="messaging-endpoints-chapter.html#service-activator-introduction" title="8.5.1&nbsp;Introduction">Section&nbsp;8.5.1, &#8220;Introduction&#8221;</a>.
Also, the SpEL support mentioned in the previous point also relies upon the ConversionService.
Therefore, you can register Converters once, and take advantage of them anywhere you are using SpEL expressions.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="task-scheduler-poller-support" href="#task-scheduler-poller-support"></a>TaskScheduler and Trigger</h4></div></div></div>

<p>Spring 3.0 defines two new strategies related to scheduling: <span class="emphasis"><em>TaskScheduler and Trigger</em></span> Spring Integration (which uses a lot of scheduling) now builds upon these.
In fact, Spring Integration 1.0 had originally defined some of the components (e.g.
CronTrigger) that have now been migrated into Spring 3.0&#8217;s core API.
Now, you can benefit from reusing the same components within the entire Application Context (not just Spring Integration configuration).
Configuration of Spring Integration Pollers has been greatly simplified as well by providing attributes for directly configuring rates, delays, cron expressions, and trigger references.
See <a class="xref" href="messaging-channels-section.html#channel-adapter" title="4.3&nbsp;Channel Adapter">Section&nbsp;4.3, &#8220;Channel Adapter&#8221;</a> for sample configurations.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="rest-support" href="#rest-support"></a>RestTemplate and HttpMessageConverter</h4></div></div></div>

<p>Our outbound HTTP adapters now delegate to Spring&#8217;s RestTemplate for executing the HTTP request and handling its response.
This also means that you can reuse any custom HttpMessageConverter implementations.
See <a class="xref" href="http.html#http-outbound" title="17.3&nbsp;Http Outbound Components">Section&nbsp;17.3, &#8220;Http Outbound Components&#8221;</a> for more details.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="new-eip" href="#new-eip"></a>H.9.2&nbsp;Enterprise Integration Pattern Additions</h3></div></div></div>

<p>Also in 2.0 we have added support for even more of the patterns described in Hohpe and Woolf&#8217;s <a class="ulink" href="http://www.eaipatterns.com/" target="_top">Enterprise Integration Patterns</a> book.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-message-history" href="#new-message-history"></a>Message History</h4></div></div></div>

<p>We now provide support for the <a class="ulink" href="http://www.eaipatterns.com/MessageHistory.html" target="_top">Message History</a> pattern allowing you to keep track of all traversed components, including the name of each channel and endpoint as well as the timestamp of that traversal.
See <a class="xref" href="system-management-chapter.html#message-history" title="9.3&nbsp;Message History">Section&nbsp;9.3, &#8220;Message History&#8221;</a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-message-store" href="#new-message-store"></a>Message Store</h4></div></div></div>

<p>We now provide support for the <a class="ulink" href="http://www.eaipatterns.com/MessageStore.html" target="_top">Message Store</a> pattern.
The Message Store provides a strategy for persisting messages on behalf of any process whose scope extends beyond a single transaction, such as the Aggregator and Resequencer.
Many sections of this document provide samples on how to use a Message Store as it affects several areas of Spring Integration.
See <a class="xref" href="system-management-chapter.html#message-store" title="9.4&nbsp;Message Store">Section&nbsp;9.4, &#8220;Message Store&#8221;</a>, <a class="xref" href="messaging-transformation-chapter.html#claim-check" title="7.3&nbsp;Claim Check">Section&nbsp;7.3, &#8220;Claim Check&#8221;</a>, <a class="xref" href="messaging-channels-section.html#channel" title="4.1&nbsp;Message Channels">Section&nbsp;4.1, &#8220;Message Channels&#8221;</a>, <a class="xref" href="messaging-routing-chapter.html#aggregator" title="6.4&nbsp;Aggregator">Section&nbsp;6.4, &#8220;Aggregator&#8221;</a>, <a class="xref" href="jdbc.html" title="18.&nbsp;JDBC Support">Chapter&nbsp;18, <i>JDBC Support</i></a>, and <a class="xref" href="messaging-routing-chapter.html#resequencer" title="6.5&nbsp;Resequencer">Section&nbsp;6.5, &#8220;Resequencer&#8221;</a> for more details</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-claim-check" href="#new-claim-check"></a>Claim Check</h4></div></div></div>

<p>We have added an implementation of the <a class="ulink" href="http://www.eaipatterns.com/StoreInLibrary.html" target="_top">Claim Check</a> pattern.
The idea behind the Claim Check pattern is that you can exchange a Message payload for a "claim ticket" and vice-versa.
This allows you to reduce bandwidth and/or avoid potential security issues when sending Messages across channels.
See <a class="xref" href="messaging-transformation-chapter.html#claim-check" title="7.3&nbsp;Claim Check">Section&nbsp;7.3, &#8220;Claim Check&#8221;</a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-control-bus" href="#new-control-bus"></a>Control Bus</h4></div></div></div>

<p>We have provided implementations of the <a class="ulink" href="http://www.eaipatterns.com/ControlBus.html" target="_top">Control Bus</a> pattern which allows you to use messaging to manage and monitor endpoints and channels.
The implementations include both a SpEL-based approach and one that executes Groovy scripts.
See <a class="xref" href="system-management-chapter.html#control-bus" title="9.6&nbsp;Control Bus">Section&nbsp;9.6, &#8220;Control Bus&#8221;</a> and <a class="xref" href="messaging-endpoints-chapter.html#groovy-control-bus" title="8.8.2&nbsp;Control Bus">Section&nbsp;8.8.2, &#8220;Control Bus&#8221;</a> for more details.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="new-adapters" href="#new-adapters"></a>H.9.3&nbsp;New Channel Adapters and Gateways</h3></div></div></div>

<p>We have added several new Channel Adapters and Messaging Gateways in Spring Integration 2.0.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-ip" href="#new-ip"></a>TCP/UDP Adapters</h4></div></div></div>

<p>We have added Channel Adapters for receiving and sending messages over the TCP and UDP internet protocols.
See <a class="xref" href="ip.html" title="31.&nbsp;TCP and UDP Support">Chapter&nbsp;31, <i>TCP and UDP Support</i></a> for more details.
Also, you can checkout the following blog: <a class="ulink" href="http://blog.springsource.com/2010/03/29/using-udp-and-tcp-adapters-in-spring-integration-2-0-m3/" target="_top">TCP/UDP support</a></p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-twitter" href="#new-twitter"></a>Twitter Adapters</h4></div></div></div>

<p>Twitter adapters provides support for sending and receiving Twitter Status updates as well as Direct Messages.
You can also perform Twitter Searches with an inbound Channel Adapter.
See <a class="xref" href="twitter.html" title="32.&nbsp;Twitter Support">Chapter&nbsp;32, <i>Twitter Support</i></a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-xmpp" href="#new-xmpp"></a>XMPP Adapters</h4></div></div></div>

<p>The new XMPP adapters support both Chat Messages and Presence events.
See <a class="xref" href="xmpp.html" title="36.&nbsp;XMPP Support">Chapter&nbsp;36, <i>XMPP Support</i></a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-ftp" href="#new-ftp"></a>FTP/FTPS Adapters</h4></div></div></div>

<p>Inbound and outbound File transfer support over FTP/FTPS is now available.
See <a class="xref" href="ftp.html" title="15.&nbsp;FTP/FTPS Adapters">Chapter&nbsp;15, <i>FTP/FTPS Adapters</i></a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-sftp" href="#new-sftp"></a>SFTP Adapters</h4></div></div></div>

<p>Inbound and outbound File transfer support over SFTP is now available.
See <a class="xref" href="sftp.html" title="27.&nbsp;SFTP Adapters">Chapter&nbsp;27, <i>SFTP Adapters</i></a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-feed" href="#new-feed"></a>Feed Adapters</h4></div></div></div>

<p>We have also added Channel Adapters for receiving news feeds (ATOM/RSS).
See <a class="xref" href="feed.html" title="13.&nbsp;Feed Adapter">Chapter&nbsp;13, <i>Feed Adapter</i></a> for more details.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="new-other" href="#new-other"></a>H.9.4&nbsp;Other Additions</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-groovy" href="#new-groovy"></a>Groovy Support</h4></div></div></div>

<p>With Spring Integration 2.0 we&#8217;ve added Groovy support allowing you to use Groovy scripting language to provide integration and/or business logic.
See <a class="xref" href="messaging-endpoints-chapter.html#groovy" title="8.8&nbsp;Groovy support">Section&nbsp;8.8, &#8220;Groovy support&#8221;</a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-map-transformer" href="#new-map-transformer"></a>Map Transformers</h4></div></div></div>

<p>These symmetrical transformers convert payload objects to and from a Map.
See <a class="xref" href="messaging-transformation-chapter.html#transformer" title="7.1&nbsp;Transformer">Section&nbsp;7.1, &#8220;Transformer&#8221;</a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-json-transformer" href="#new-json-transformer"></a>JSON Transformers</h4></div></div></div>

<p>These symmetrical transformers convert payload objects to and from JSON.
See <a class="xref" href="messaging-transformation-chapter.html#transformer" title="7.1&nbsp;Transformer">Section&nbsp;7.1, &#8220;Transformer&#8221;</a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-serialize-transformer" href="#new-serialize-transformer"></a>Serialization Transformers</h4></div></div></div>

<p>These symmetrical transformers convert payload objects to and from byte arrays.
They also support the Serializer and Deserializer strategy interfaces that have been added as of Spring 3.0.5.
See <a class="xref" href="messaging-transformation-chapter.html#transformer" title="7.1&nbsp;Transformer">Section&nbsp;7.1, &#8220;Transformer&#8221;</a> for more details.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="new-refactoring" href="#new-refactoring"></a>H.9.5&nbsp;Framework Refactoring</h3></div></div></div>

<p>The core API went through some significant refactoring to make it simpler and more usable.
Although we anticipate that the impact to the end user should be minimal, please read through this document to find what was changed.
Especially, visit <a class="xref" href="messaging-routing-chapter.html#dynamic-routers" title="6.1.5&nbsp;Dynamic Routers">Section&nbsp;6.1.5, &#8220;Dynamic Routers&#8221;</a> , <a class="xref" href="messaging-endpoints-chapter.html#gateway" title="8.4&nbsp;Messaging Gateways">Section&nbsp;8.4, &#8220;Messaging Gateways&#8221;</a>, <a class="xref" href="http.html#http-outbound" title="17.3&nbsp;Http Outbound Components">Section&nbsp;17.3, &#8220;Http Outbound Components&#8221;</a>, <a class="xref" href="messaging-construction-chapter.html#message" title="5.1&nbsp;Message">Section&nbsp;5.1, &#8220;Message&#8221;</a>, and <a class="xref" href="messaging-routing-chapter.html#aggregator" title="6.4&nbsp;Aggregator">Section&nbsp;6.4, &#8220;Aggregator&#8221;</a> for more details.
If you are depending directly on some of the core components (Message, MessageHeaders, MessageChannel, MessageBuilder, etc.), you will notice that you need to update any import statements.
We restructured some packaging to provide the flexibility we needed for extending the domain model while avoiding any cyclical dependencies (it is a policy of the framework to avoid such "tangles").</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="new-infrastructure" href="#new-infrastructure"></a>H.9.6&nbsp;New Source Control Management and Build Infrastructure</h3></div></div></div>

<p>With Spring Integration 2.0 we have switched our build environment to use Git for source control.
To access our repository simply follow this URL: <a class="ulink" href="http://git.springsource.org/spring-integration" target="_top">http://git.springsource.org/spring-integration</a>.
We have also switched our build system to <a class="ulink" href="http://gradle.org/" target="_top">Gradle</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="new-samples" href="#new-samples"></a>H.9.7&nbsp;New Spring Integration Samples</h3></div></div></div>

<p>With Spring Integration 2.0 we have decoupled the samples from our main release distribution.
Please read this blog to get more info <a class="ulink" href="http://blog.springsource.com/2010/09/29/new-spring-integration-samples/" target="_top">New Spring Integration Samples</a> We have also created many new samples, including samples for every new Adapter.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="new-sts" href="#new-sts"></a>H.9.8&nbsp;Spring Tool Suite Visual Editor for Spring Integration</h3></div></div></div>

<p>There is an amazing new visual editor for Spring Integration included within the latest version of SpringSource Tool Suite.
If you are not already using STS, please download it here:</p>
<p><a class="ulink" href="https://spring.io/tools/sts" target="_top">Spring Tool Suite</a></p>
</div>
</div>
</div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="resources.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="spring-integration-appendices.html">Up</a></td><td width="40%" align="right">&nbsp;</td></tr><tr><td width="40%" align="left" valign="top">Appendix&nbsp;G.&nbsp;Additional Resources&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;</td></tr></table></div></body></html>