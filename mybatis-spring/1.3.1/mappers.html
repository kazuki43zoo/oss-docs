<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 26 July 2018 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Hunter Presnall" />
    <meta name="author" content="Eduardo Macarron" />
    <meta name="Date-Revision-yyyymmdd" content="20180726" />
    <meta http-equiv="Content-Language" content="en" />
    <title>mybatis-spring &#x2013; MyBatis-Spring | Injecting Mappers</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>mybatis-spring</h2>
</div>
</div>
        <div class="pull-right"><a href="../" id="bannerRight" title="MyBatis logo"><img src="http://mybatis.github.io/images/mybatis-logo.png"  alt="MyBatis logo"/></a></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 26 July 2018<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.3.1</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Reference Documentation</li>
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a>  </li>
    <li><a href="getting-started.html" title="Getting Started"><span class="none"></span>Getting Started</a>  </li>
    <li><a href="factorybean.html" title="SqlSessionFactoryBean"><span class="none"></span>SqlSessionFactoryBean</a>  </li>
    <li><a href="transactions.html" title="Transactions"><span class="icon-chevron-right"></span>Transactions</a>  </li>
    <li><a href="sqlsession.html" title="Using an SqlSession"><span class="icon-chevron-right"></span>Using an SqlSession</a>  </li>
    <li class="active"><a href="#"><span class="icon-chevron-down"></span>Injecting Mappers</a>

      <ul class="nav nav-list">
    <li><a href="mappers.html#register" title="Registering a mapper"><span class="none"></span>Registering a mapper</a>  </li>
    <li><a href="mappers.html#scan" title="Scanning for mappers"><span class="none"></span>Scanning for mappers</a>  </li>
      </ul>
  </li>
    <li><a href="boot.html" title="Spring Boot"><span class="none"></span>Spring Boot</a>  </li>
    <li><a href="using-api.html" title="Using the MyBatis API"><span class="none"></span>Using the MyBatis API</a>  </li>
    <li><a href="batch.html" title="Spring Batch"><span class="none"></span>Spring Batch</a>  </li>
    <li><a href="sample.html" title="Sample Code"><span class="none"></span>Sample Code</a>  </li>
          <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a>  </li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >


  
    <div class="section">
<h2><a name="Injecting_Mappers"></a>Injecting Mappers</h2>
      
<p>
        Rather than code data access objects (DAOs) manually using
        <tt>SqlSessionDaoSupport</tt> or
        <tt>SqlSessionTemplate</tt>, Mybatis-Spring can create a 
        thread safe mapper that you can inject directly into other beans:
      </p>

      
<div class="source"><pre class="prettyprint">&lt;bean id=&quot;fooService&quot; class=&quot;org.mybatis.spring.sample.mapper.FooServiceImpl&quot;&gt;
  &lt;property name=&quot;userMapper&quot; ref=&quot;userMapper&quot; /&gt;
&lt;/bean&gt;</pre></div>
 
      
<p>
         Once injected, the mapper is ready to be used in application logic:
      </p>
         
<div class="source"><pre class="prettyprint">public class FooServiceImpl implements FooService {

  private UserMapper userMapper;

  public void setUserMapper(UserMapper userMapper) {
    this.userMapper = userMapper;
  }

  public User doSomeBusinessStuff(String userId) {
    return this.userMapper.getUser(userId);
  }
}</pre></div>
       
<p>
         Notice that there are no <tt>SqlSession</tt> or MyBatis
         references in this code. Nor is there any need to create, open or close
         the session, MyBatis-Spring will take care of that.
       </p>

	<a name="register"></a>
<div class="section" id="register">
<h3><a name="Registering_a_mapper"></a>Registering a mapper</h3>
	  
<p>
	    The way you register a mapper depends on whether you are using a classic XML configuration
	    or the new 3.0+ Java Config (a.k.a. @Configuration).</p>
	
      
<div class="section">
<h4><a name="With_XML_Config"></a>With XML Config</h4>
      
      
<p>
        A mapper is registered to Spring by including a <tt>MapperFactoryBean</tt> in your XML
        config file like follows: 
      </p>
        
<div class="source"><pre class="prettyprint">&lt;bean id=&quot;userMapper&quot; class=&quot;org.mybatis.spring.mapper.MapperFactoryBean&quot;&gt;
  &lt;property name=&quot;mapperInterface&quot; value=&quot;org.mybatis.spring.sample.mapper.UserMapper&quot; /&gt;
  &lt;property name=&quot;sqlSessionFactory&quot; ref=&quot;sqlSessionFactory&quot; /&gt;
&lt;/bean&gt;</pre></div>

      
<p>
        If the UserMapper has a corresponding MyBatis XML mapper file 
        in the same classpath location as the mapper interface, it will be
        parsed automatically by the <tt>MapperFactoryBean</tt>. There
        is no need to specify the mapper in a MyBatis configuration file unless
        the mapper XML files are in a different classpath location. See the
        <tt>SqlSessionFactoryBean's</tt>
        <tt><a href="factorybean.html">configLocation</a></tt>
        property for more information.
      </p>

      
<p>
        Note that <tt>MapperFactoryBean</tt> requires either an
        <tt>SqlSessionFactory</tt> or an <tt>SqlSessionTemplate</tt>.
        These can be set through the respective <tt>sqlSessionFactory</tt> and
        <tt>sqlSessionTemplate</tt> properties.
        If both properties are set, the <tt>SqlSessionFactory</tt> is ignored.
        Since the <tt>SqlSessionTemplate</tt> is required to have a session
        factory set, that factory will be used by <tt>MapperFactoryBean</tt>.
      </p>
      
       </div>
<div class="section">
<h4><a name="With_Java_Config"></a>With Java Config</h4>
       
       
<p>
         When using Spring Java Config you can get a mapper directly out 
         of an <tt>SqlSessionTemplate</tt> like follows: 
       </p>
        

<div class="source"><pre class="prettyprint">    @Bean
    public SqlSessionFactory sqlSessionFactory() throws Exception {
      SqlSessionFactoryBean sqlSessionFactory = new SqlSessionFactoryBean();
      sqlSessionFactory.setDataSource(dataSource());
      return (SqlSessionFactory) sqlSessionFactory.getObject();
    }

    @Bean
    public UserMapper userMapper() throws Exception {
      SqlSessionTemplate sessionTemplate = new SqlSessionTemplate(sqlSessionFactory());
      return sessionTemplate.getMapper(UserMapper.class);
    }
</pre></div>

       
<p>
         Note that you can not return a mapper got from the MyBatis default <tt>SqlSession</tt> because
         it would not be thread safe and will only live until the <tt>SqlSession</tt>
         it was created from is closed. You must use an 
         <tt><a href="sqlsession.html#SqlSessionTemplate">SqlSessionTemplate</a></tt> instead, 
         as shown in the sample.
       </p>
    </div></div>

    <a name="scan"></a>
<div class="section" id="scan">
<h3><a name="Scanning_for_mappers"></a>Scanning for mappers</h3>
      
<p>
        There is no need to register all your mappers one by one.
        Instead, you can let MyBatis-Spring scan your classpath for them.
      </p>
      
      
<p>
        There are three different ways to do it:
      </p>
      
<ul>
        
<li>Using the <tt>&lt;mybatis:scan/&gt;</tt> element.</li>
        
<li>Using the annotation <tt>@MapperScan</tt></li>
        
<li>Using a classic Spring xml file and registering the <tt>MapperScannerConfigurer</tt></li>
      </ul>
      
      
<p>Both <tt>&lt;mybatis:scan/&gt;</tt> and <tt>@MapperScan</tt> are features introduced in MyBatis-Spring 1.2.0.
      <tt>@MapperScan</tt> requires Spring 3.1+.</p> 

      
<div class="section">
<h4><a name="amybatis:scan"></a>&lt;mybatis:scan/&gt;</h4>
      
      
<p>
        The <tt>&lt;mybatis:scan/&gt;</tt> XML element will search for mappers 
        in a very similar way than the Spring built-in element <tt>&lt;context:component-scan/&gt;</tt>
        searches for beans. 
      </p>
      
      
<p>Follows below a sample XML configuration:</p>

        
<div class="source"><pre class="prettyprint">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xmlns:mybatis=&quot;http://mybatis.org/schema/mybatis-spring&quot;
  xsi:schemaLocation=&quot;
  http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
  http://mybatis.org/schema/mybatis-spring http://mybatis.org/schema/mybatis-spring.xsd&quot;&gt;
 
  &lt;mybatis:scan base-package=&quot;org.mybatis.spring.sample.mapper&quot; /&gt;

&lt;/beans&gt;</pre></div>

      
<p>
        The <tt>base-package</tt> attribute lets you set the base package
        for your mapper interface files. You can set more than one package by
        using a semicolon or comma as a separator. Mappers will be searched for
        recursively starting in the specified package(s).
      </p>

      
<p>
        Notice that there is no need to specify a <tt>SqlSessionFactory</tt> or
        <tt>SqlSessionTemplate</tt> as an attribute in the <tt>&lt;mybatis:scan/&gt;</tt>
        element because it will create <tt>MapperFactoryBean</tt>s that can be autowired. 
        But if you are using more than one <tt>DataSource</tt> autowire may not work for you. 
        In this case you can use the <tt>factory-ref</tt> or
        <tt>template-ref</tt> attributes to set the right bean name to use.
      </p>

      
<p>
        <tt>&lt;mybatis:scan/&gt;</tt> supports filtering the mappers
        created by either specifying a marker interface or an annotation. The
        <tt>annotation</tt> property specifies an annotation to
        search for. The <tt>marker-interface</tt> attribute specifies a
        parent interface to search for. If both properties are specified, mappers
        are added for interfaces that match <b>either</b> criteria.
        By default, these two properties are null, so all interfaces in the given
        base package(s) will be loaded as mappers.
      </p>

      
<p>
        Discovered mappers will be named using Spring default naming strategy for
        autodetected components (see section 3.14.4 of the Spring manual).
        That is, if no annotation is found, it will use the uncapitalized non-qualified class
        name of the mapper. But if either a @Component or a JSR-330 @Named annotation is
        found it will get the name from the annotation.
        Notice that you can set the <tt>annotation</tt> attribute
        to <tt>org.springframework.stereotype.Component</tt>,
        <tt>javax.inject.Named</tt> (if you have JSE 6) or to your own annotation
        (that must be itself annotated) so the annotation will work both as a marker
        and as a name provider.
      </p>

      
<p>
        <span class="label important">NOTE</span> <tt>&lt;context:component-scan/&gt;</tt> 
        won't be able to scan and register mappers. Mappers are interfaces and, in order to register them to 
        Spring, the scanner must know how to create a <tt>MapperFactoryBean</tt> for each interface
        it finds. 
      </p>

      </div>
<div class="section">
<h4><a name="aMapperScan"></a>@MapperScan</h4>
      
      
<p>
        If you are using the Spring Java Configuration (a.k.a @Configuration) you would 
        prefer to use the <tt>@MapperScan</tt> rather than the 
        <tt>&lt;mybatis:scan/&gt;</tt>.  
      </p>
      
      
<p>The <tt>@MapperScan</tt> annotation is used as follows:</p>
   
   
<div class="source"><pre class="prettyprint">@Configuration
@MapperScan(&quot;org.mybatis.spring.sample.mapper&quot;)
public class AppConfig {

  @Bean
  public DataSource dataSource() {
    return new EmbeddedDatabaseBuilder().addScript(&quot;schema.sql&quot;).build()
  }

  @Bean
  public SqlSessionFactory sqlSessionFactory() throws Exception {
    SqlSessionFactoryBean sessionFactory = new SqlSessionFactoryBean();
    sessionFactory.setDataSource(dataSource());
    return sessionFactory.getObject();
  }
}
</pre></div>
	
	  
<p>The annotation works in the same exact way than <tt>&lt;mybatis:scan/&gt;</tt> we
	  saw in the previous section. It also lets you specify a marker interface or an annotation class
	  through its properties <tt>markerInterface</tt> and <tt>annotationClass</tt>. 
	  You can also provide an specific <tt>SqlSessionFactory</tt> or <tt>SqlSessionTemplate</tt>
	  by using its properties <tt>sqlSessionFactory</tt> and <tt>sqlSessionTemplate</tt>.
	  </p>
     
      </div>
<div class="section">
<h4><a name="MapperScannerConfigurer"></a>MapperScannerConfigurer</h4>
        
      
<p>
        The <tt>MapperScannerConfigurer</tt> is a <tt>BeanDefinitionRegistryPostProcessor</tt> that
        can be included in a classic xml application context as a normal bean.
        To set up a <tt>MapperScannerConfigurer</tt> add the following to the Spring configuration:
      </p>
        
<div class="source"><pre class="prettyprint">&lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;
  &lt;property name=&quot;basePackage&quot; value=&quot;org.mybatis.spring.sample.mapper&quot; /&gt;
&lt;/bean&gt;</pre></div>

      
<p>
        If you need to specify an specific <tt>sqlSessionFactory</tt> or <tt>sqlSessionTemplate</tt>
        note that <b>bean names</b> are required,
        not bean references, thus the <tt>value</tt> attribute is used instead of the
        usual <tt>ref</tt>:
      </p>
      
<div class="source"><pre class="prettyprint">&lt;property name=&quot;sqlSessionFactoryBeanName&quot; value=&quot;sqlSessionFactory&quot; /&gt;</pre></div>
    
      
<p>
        <span class="label important">NOTE</span> <tt>sqlSessionFactoryBean</tt> and 
        <tt>sqlSessionTemplateBean</tt> properties were the only option available up to MyBatis-Spring 1.0.2 
        but given that the <tt>MapperScannerConfigurer</tt> runs earlier in the startup 
        process that <tt>PropertyPlaceholderConfigurer</tt> there were frequent errors. 
        For that purpose that properties have been deprecated and the new properties 
        <tt>sqlSessionFactoryBeanName</tt> and <tt>sqlSessionTemplateBeanName</tt> 
        are recommended.
      </p>
      </div></div>
    </div>
  

        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2010&#x2013;2018
<a href="http://www.mybatis.org/">MyBatis.org</a>.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    </body>
</html>
